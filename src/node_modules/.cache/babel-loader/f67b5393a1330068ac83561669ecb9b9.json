{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{createRef}from'react';import{connect}from\"react-redux\";import{Row,Col,Card,CardBody,CardFooter}from'reactstrap';import{HotTable}from'@handsontable/react';import Handsontable from'handsontable';import{groupingMap}from'../matrixDataMap';import{columnLogic}from'../matrixColumnLogicMap';import PaginationMatrix from\"../components/Pagination\";import Header from'../components/Header';import Sidebar from'../components/Sidebar';import Toolbar from'../components/ToolbarMatrix';import ModalImport from'../components/ModalImport';import Spinner from'../components/Spinner';import EmptyDataset from'../components/EmptyDataset';import{editOnToggle,spinnerToggle}from\"../redux/actions\";import{confirmAlert}from'react-confirm-alert';import'react-confirm-alert/src/react-confirm-alert.css';// For export File\nimport XLSX from'xlsx';import{saveAs}from'file-saver';// Rest api module import\nimport RestApiModule from'../RestApiModule';// Alert module\nimport AlertModule from'../AlertModule';var Matrix=/*#__PURE__*/function(_React$Component){_inherits(Matrix,_React$Component);var _super=_createSuper(Matrix);function Matrix(props){var _this;_classCallCheck(this,Matrix);_this=_super.call(this,props);_this._isMounted=false;_this.restApi=new RestApiModule();_this.alert=new AlertModule();_this.hotTableComponent=createRef();_this.hot=null;_this.handsontableData=null;_this.handsontableDataBackup=null;_this.errorMessages=null;_this.errorBoxTitle=null;_this.columnHeaders=[];_this.titles=[];_this.columns=[];_this.handleColumnHeaders();_this.selectedRowCoords={r:null,c:null};_this.editedRowCoords={r:null,c:null};_this.validatedCell={r:null,c:null};_this.rowValidation=true;_this.filter=null;_this.mandatoryColumns=null;_this.isDuplicate=false;_this.submitProcessFail=false;//this.itemPerPage = +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE;\n_this.state={isDataExistsInDB:false,newRowAdded:false,activePage:1,itemPerPage:+process.env.REACT_APP_MATRIX_ITEM_PER_PAGE,totalCountOfData:0,exportDataAsExcelFile:null};return _this;}_createClass(Matrix,[{key:\"componentDidMount\",value:function componentDidMount(){this._isMounted=true;if(this.props.user){// get mandatory columns from map file\nthis.mandatoryColumns=this.mandatoryColumnExtractor();this.setStateAsync({permittedColumns:this.props.user.role.permittedColumns});this.hot=this.hotTableComponent.current.hotInstance;this.dataLoad();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"calculatePagination\",value:function calculatePagination(total){if(total){var pageCount=+total/this.state.itemPerPage;this.setStateAsync({totalCountOfData:total,pageCount:pageCount});}}},{key:\"dataCountOfSelectedRegion\",value:function dataCountOfSelectedRegion(){var _this2=this;var _this$props=this.props,token=_this$props.token,region=_this$props.region,radioSite=_this$props.radioSite;if(region){this.restApi.callApi('getMatrixDataCount',{token:token,region:region,radioSite:radioSite}).then(function(response){_this2.calculatePagination(response.ConnectivityCount[0].Count);});}}},{key:\"dataLoad\",value:function(){var _dataLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(filterChanged){var _this3=this;var _this$props2,token,region,radioSite;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!this._isMounted){_context2.next=9;break;}_this$props2=this.props,token=_this$props2.token,region=_this$props2.region,radioSite=_this$props2.radioSite;// that means filtered options changed, so we reset the activePage number to 1\nif(filterChanged){this.setStateAsync({activePage:1,itemPerPage:filterChanged===\"radioSite\"?100:+process.env.REACT_APP_MATRIX_ITEM_PER_PAGE});}if(!region){_context2.next=9;break;}this.props.setSpinner();// get count of data\n_context2.next=7;return this.dataCountOfSelectedRegion();case 7://reset selected row data\nthis.resetSelectedRow();this.restApi.callApi('getMatrixData',{token:token,region:region,radioSite:radioSite,count:this.state.itemPerPage.toString(),page_index:this.state.activePage.toString()}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var ConnectivityMatrix,exec_status;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://console.log(response)\n// mock test\n//response.exec_status = \"error\";\nConnectivityMatrix=response.ConnectivityMatrix,exec_status=response.exec_status;// If data doesnt exist in EAI DB we should set a flag to manage toolbar actions\nif(!(exec_status===\"success\"&&ConnectivityMatrix.length>0)){_context.next=11;break;}_this3.setStateAsync({isDataExistsInDB:true});_this3.handsontableData=ConnectivityMatrix;// store the copy of data\n_this3.hot.loadData(_this3.handsontableData);_this3.paginationRowNumbers();/* Filter for show active rows only*/_this3.filter=_this3.hot.getPlugin('filters');_context.next=9;return _this3.revisionRowFilter();case 9:_context.next=12;break;case 11:_this3.setStateAsync({isDataExistsInDB:false});case 12:// remove spinner from screen\n_this3.props.setSpinner();case 13:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref.apply(this,arguments);};}()).catch(function(err){// err state. If need we can give message to user.\n// Error handling is managed by RestApiModule.\n// We don't need to do extra development in here\n// Somehow if this block executed, we can only change the flag to false.\n_this3.setStateAsync({isDataExistsInDB:false});// remove spinner from screen\n_this3.props.setSpinner();});case 9:case\"end\":return _context2.stop();}}},_callee2,this);}));function dataLoad(_x){return _dataLoad.apply(this,arguments);}return dataLoad;}()},{key:\"setStateAsync\",value:function setStateAsync(state){var _this4=this;return new Promise(function(resolve){_this4.setState(state,resolve);});}},{key:\"handlePageChange\",value:function(){var _handlePageChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(pageNumber){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.setStateAsync({activePage:pageNumber});case 2:this.dataLoad();case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function handlePageChange(_x3){return _handlePageChange.apply(this,arguments);}return handlePageChange;}()},{key:\"paginationRowNumbers\",value:function paginationRowNumbers(){// break the handsontable row headers mechanism to show to user exact row numbers while paginating\nvar _this$state=this.state,activePage=_this$state.activePage,itemPerPage=_this$state.itemPerPage;var startPoint=(activePage-1)*itemPerPage+1;var newNumbers=Array.from(Array(itemPerPage),function(_,i){return startPoint+i;});this.hot.updateSettings({rowHeaders:newNumbers});}},{key:\"isRowCanBeEditable\",value:function isRowCanBeEditable(r,restriction){var etatRule=this.ruleExtractor(\"etatCheckValue\");var archivedRule=this.ruleExtractor(\"archivedCheckValue\");var etatDataAtCell=this.hot.getDataAtRowProp(r,\"etat\");var archivedDataAtCell=this.hot.getDataAtRowProp(r,\"archived\");var checkEtatValue=etatRule.isValue.includes(etatDataAtCell);var checkArchivedValue=archivedRule.isValue.includes(archivedDataAtCell);var response=checkEtatValue&&checkArchivedValue;if(!response){var language=this.props.language;var message,title=\"\";switch(restriction){case'Lock':title=language.lockModeRestrictionTitle;message=language.lockModeRestriction;break;case'Edit':default:title=language.editModeRestrictionTitle;message=language.editModeRestriction;break;}this.alert.showMessage(\"warning\",title,message,false);}return response;}// click event handle for edit button\n},{key:\"handleEditClick\",value:function handleEditClick(){var _this5=this;var _this$selectedRowCoor=this.selectedRowCoords,r=_this$selectedRowCoor.r,c=_this$selectedRowCoor.c;if(r===null&&c===null)return;if(this.isRowCanBeEditable(r)){// Lock mechanism controls\nvar dto=this.prepareDTOforLockMechanism(r,false);this.restApi.callApi('lock',dto).then(function(response){var json=response.resultLock;var user=_this5.props.user;// can I continue to edit ?\nvar continueToEdit=json.islock&&json.uname===user.name;if(continueToEdit){// create backup data before editing;\n_this5.handsontableDataBackup=JSON.parse(JSON.stringify(_this5.handsontableData));// Change edit mode on redux\n_this5.props.setEdit();_this5.setCellProperties(r,c);_this5.editedRowCoords.r=r;_this5.editedRowCoords.c=c;}else{_this5.showMessageForLockMechanism(true,json);}});}}// click handle for add new row\n},{key:\"handleNewRowClick\",value:function(){var _handleNewRowClick=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.setStateAsync({newRowAdded:true});case 2:this.editedRowCoords.r=0;this.editedRowCoords.c=0;this.isDuplicate=false;// create backup data before editing;\nthis.handsontableDataBackup=JSON.parse(JSON.stringify(this.handsontableData));this.props.setEdit();this.hot.alter('insert_row',0,1);this.setCellProperties(0,null);// set initial value for newly adding rows\nif(this.state.newRowAdded&&!this.isDuplicate){this.setInitialValueOfColumn();}case 10:case\"end\":return _context4.stop();}}},_callee4,this);}));function handleNewRowClick(){return _handleNewRowClick.apply(this,arguments);}return handleNewRowClick;}()},{key:\"handleDuplicateRowClick\",value:function(){var _handleDuplicateRowClick=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _this$selectedRowCoor2,r,c,data,radioSiteColumnIndex,lockStatusColumnIndex,lockUserColumnIndex,lockTimeColumnIndex,passThisColumns,colCount,x;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this$selectedRowCoor2=this.selectedRowCoords,r=_this$selectedRowCoor2.r,c=_this$selectedRowCoor2.c;if(!(r===null&&c===null)){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:// get existing data at row\ndata=this.hot.getDataAtRow(r);this.isDuplicate=true;_context5.next=7;return this.handleNewRowClick();case 7:// find radio Site column for special case. we need empty radio site for duplicated row\nradioSiteColumnIndex=this.findIndexOfColumn(0,'radioSite');lockStatusColumnIndex=this.findIndexOfColumn(0,'LOCK_STATUS');lockUserColumnIndex=this.findIndexOfColumn(0,'USER_NAME');lockTimeColumnIndex=this.findIndexOfColumn(0,'LOCK_TIME');passThisColumns=[radioSiteColumnIndex,lockStatusColumnIndex,lockUserColumnIndex,lockTimeColumnIndex];// get column count for iteration\ncolCount=this.hot.countCols();// iterate the columns\nx=0;case 14:if(!(x<=colCount)){_context5.next=21;break;}if(!(x in passThisColumns)){_context5.next=17;break;}return _context5.abrupt(\"continue\",18);case 17:// set data\nthis.hot.setDataAtCell(0,x,data[x]);case 18:x++;_context5.next=14;break;case 21:case\"end\":return _context5.stop();}}},_callee5,this);}));function handleDuplicateRowClick(){return _handleDuplicateRowClick.apply(this,arguments);}return handleDuplicateRowClick;}()},{key:\"handleCancelClick\",value:function handleCancelClick(){var _this6=this;if(!this.state.newRowAdded){var _this$editedRowCoords=this.editedRowCoords,r=_this$editedRowCoords.r,c=_this$editedRowCoords.c;if(r===null&&c===null)return;// Lock mechanism controls\nvar dto=this.prepareDTOforLockMechanism(r,false);// In all circumstances call implicit unlock\nthis.restApi.callApi('unlock',dto);}this.setStateAsync({newRowAdded:false}).then(function(){_this6.cancelEdit();});}},{key:\"handleSaveClick\",value:function handleSaveClick(){this.saveAction();}},{key:\"handleSaveHistoryClick\",value:function handleSaveHistoryClick(){this.saveAction(true);}},{key:\"checkIsRadioSiteExists\",value:function checkIsRadioSiteExists(token,radioSite){var _this7=this;return new Promise(function(res,rej){var language=_this7.props.language;// if the save action doing on new row add we should check if radio site is exists\n// then we need to show message to the user to continue or not.\n_this7.restApi.callApi('isRadioSiteExists',{token:token,radioSite:radioSite}).then(function(radioResponse){if(radioResponse.isExist===true){// get confirmation from user to continue\n_this7.alert.getConfirmation(\"warning\",language.radioSiteExistsWithSameNameTitle,language.radioSiteExistsWithSameNameText).then(function(confirmation){res({confirmation:confirmation,isExists:radioResponse.isExist});});}else{// if radio site not exist we should return false\nres({confirmation:null,isExists:radioResponse.isExist});}}).catch(function(err){rej(err);});});}// save action for row edited or new\n},{key:\"saveAction\",value:function saveAction(revision){var _this8=this;var _this$props3=this.props,language=_this$props3.language,token=_this$props3.token;var isRevision=revision?revision:false;this.restApi.callApi('getImportStatus',{token:token}).then(function(importStatusResponse){var isImportOngoing=importStatusResponse.isImportOngoing;var _this8$editedRowCoord=_this8.editedRowCoords,r=_this8$editedRowCoord.r,c=_this8$editedRowCoord.c;if(!isImportOngoing.isLock){// there isn't an import action ongoing\nif(_this8.rowValidation){if(r!==null||r!==undefined){// data would send to API\nvar data=_this8.hot.getDataAtRow(r);data=_this8.columns.reduce(function(newRowData,item,index){Object.assign(newRowData,data[index]!==null?_defineProperty({},item.data,data[index]):_defineProperty({},item.data,\"\"));return newRowData;},{});var mandatoryColumnsFilled=_this8.checkMandatoryColumnsFilled(data);if(mandatoryColumnsFilled){var isNewRow=_this8.state.newRowAdded;// radio Site exists check\nif(isNewRow){_this8.checkIsRadioSiteExists(token,data['radioSite']).then(function(isExistsResponse){var confirm=isExistsResponse.confirmation;if(confirm||confirm===null){// it means, user didn't click cancel on messagebox.\n// confirm = null means there isnt exist radio site in db\n_this8.saveIt(token,data,isNewRow,isExistsResponse.isExists,r,c);}});}else{_this8.saveIt(token,data,isNewRow,isRevision,r,c);}}else{var title=language.mandatoryDataTitle;var text=language.mandatoryDataText;text=text.replace(\"{columns}\",_this8.mandatoryColumns.join(',<br>'));_this8.alert.showMessage(\"error\",title,text,false);}}}else{var _language=_this8.props.language;_this8.alert.showMessage(\"error\",_language.validationMessageBoxTitle,_language.validationErrorGeneralMessage,false);}}else{var message=language.importSection.ongoingImportText.replace('{username}',isImportOngoing.uname);_this8.alert.showMessage('warning',language.importSection.ongoingImportTitle,message,false);// import is ongoing we need to reload the data\n_this8.resetRow(r);_this8.props.setEdit();_this8.dataLoad();}});}},{key:\"saveIt\",value:function saveIt(token,row,isNewRow,isRevision,r,c){var _this9=this;var _this$props4=this.props,setSpinner=_this$props4.setSpinner,setEdit=_this$props4.setEdit;setSpinner();// Call backend to save row\nthis.restApi.callApi(\"saveRow\",{token:token,row:row,isNewRow:isNewRow,isRevision:isRevision}).then(function(response){var language=_this9.props.language;var _response$result=response.result,processed=_response$result.processed,log=_response$result.log;var message=log.split('\\n').join('<br>');setSpinner();if(processed){_this9.alert.showMessage(\"success\",language.saveActionSuccessTitle,message,false);_this9.selectedRowCoords.c=c;_this9.selectedRowCoords.r=r;_this9.editedRowCoords.r=null;_this9.editedRowCoords.c=null;// Reset new row state if its true\nif(_this9.state.newRowAdded)_this9.setState({newRowAdded:false});setEdit();// set it's not edit mode anymore\n_this9.resetRow(r);// this method will return the edit view to normal\n_this9.dataLoad();// load the data again from db.\n}else{// something not suitable for BE,\n// FE just showing a message to user.\n_this9.alert.showMessage(\"error\",language.saveActionFailTitle,message,false);// this will make the row re-editable if get error from backend\n_this9.setCellProperties(r,c);}}).catch(function(){// we have unexpected error from BE\n// Stopping edit mode, stop everything, back to one step previous\nsetSpinner();//this.cancelEdit();\n//this.resetRow(r);\n});}},{key:\"revisionRowFilter\",value:function(){var _revisionRowFilter=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var colIndex,showRevision,arg;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!this._isMounted){_context6.next=7;break;}colIndex=this.findIndexOfColumn(0,'archived');showRevision=this.props.showRevision;arg=showRevision?'':'NO';// this param is for filtering on handsontable\nif(showRevision){this.filter.removeConditions(colIndex);}else{this.filter.addCondition(colIndex,'contains',arg);}_context6.next=7;return this.filter.filter();case 7:case\"end\":return _context6.stop();}}},_callee6,this);}));function revisionRowFilter(){return _revisionRowFilter.apply(this,arguments);}return revisionRowFilter;}()},{key:\"setCellProperties\",value:function setCellProperties(r,c){var colCount=this.hot.countCols();var col=c!==null?c:0;for(var x=0;x<=colCount;x++){var _this$hot$getCellMeta=this.hot.getCellMeta(r,x),prop=_this$hot$getCellMeta.prop,readOnly=_this$hot$getCellMeta.readOnly,readOnlyInEditMode=_this$hot$getCellMeta.readOnlyInEditMode;if(typeof prop!==\"string\")continue;// if prop has got readyOnly attribute with value \"true\", write permission will restricted\n// if prop hasn't got readOnly attribute it would be false by default. So we need to check if\n// this action is adding new row or editing existing row.\n// if action is editing a row then we should check readOnlyInEditMode attribute of prop.\n// if it's exist we should get opposite value because if we add this attribute to prop it value should be \"true\"\n// it means this property can not be writable in edit mode\n// if readOnlyInEditMode attribute is not exist in prop there isn't extra attribute checking for this cell\n// can be writable or not. So we can put \"true\" value to associated variable.\nvar writable=readOnly?!readOnly:!this.state.newRowAdded?!readOnlyInEditMode:!readOnly;if(writable){if(this.state.permittedColumns.indexOf(prop)>=0){var type=this.hot.getDataType(r,x);// get cell type from loaded map\n// this 2 row for initiate the rules on editing row.\n//const value = this.hot.getDataAtCell(r, x);\n//this.columnEvents(r, prop, value);\ncol=col===0?x:col;// when add new row find first editable col.\nthis.hot.setCellMeta(r,x,\"editor\",type);this.hot.setCellMeta(r,x,\"className\",'bg-warning text-dark');}}}this.hot.render();this.hot.selectCell(r,col);}},{key:\"findIndexOfColumn\",value:function findIndexOfColumn(r,propName){var colCount=this.hot.countCols();for(var c=0;c<=colCount;c++){var _this$hot$getCellMeta2=this.hot.getCellMeta(r,c),prop=_this$hot$getCellMeta2.prop;if(prop===propName){return c;}}}// Before save action mandatory columns are must be filled\n},{key:\"checkMandatoryColumnsFilled\",value:function checkMandatoryColumnsFilled(rowData){var checkData=this.mandatoryColumns.reduce(function(data,columnId){data.push(rowData[columnId]);return data;},[]);return checkData.every(function(data){return data!==undefined&&data!==\"\"&&data!==null;});}// Finished initial value setter\n},{key:\"setInitialValueOfColumn\",value:function setInitialValueOfColumn(){var _this10=this;this.columns.map(function(item){if(item.hasOwnProperty('initialValue')){_this10.hot.setDataAtRowProp(0,item.data,item.initialValue);}return true;});}// Finished, cancel edit return back to last backup data\n},{key:\"cancelEdit\",value:function cancelEdit(){this.handsontableData=JSON.parse(JSON.stringify(this.handsontableDataBackup));this.hot.loadData(this.handsontableData);this.hot.render();// Change edit mode on redux\nthis.props.setEdit();}// reset row finished\n},{key:\"resetRow\",value:function resetRow(r){var colCount=this.hot.countCols();for(var x=0;x<=colCount;x++){this.hot.setCellMeta(r,x,\"editor\",false);this.hot.setCellMeta(r,x,\"className\",'bg-primary text-white');}this.hot.render();this.setState({newRowAdded:false});}// reset seleted rows for some reason such as change region, change active page\n},{key:\"resetSelectedRow\",value:function resetSelectedRow(){this.selectedRowCoords.r=null;this.selectedRowCoords.c=null;this.editedRowCoords.r=null;this.editedRowCoords.c=null;this.validatedCell.r=null;this.validatedCell.c=null;this.hot.deselectCell();}// disable moves finished\n},{key:\"disableMoves\",value:function disableMoves(){return false;}// Finished ip validation rule\n},{key:\"ipValidate\",value:function ipValidate(value,callback){var pat=/^(?:\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b|null)$/;this.rowValidation=pat.test(value);callback(this.rowValidation);if(!this.rowValidation)this.showMessage(this.errorBoxTitle,this.errorMessages.invalidIP,true,true);}// Finished numeric value validation\n},{key:\"numericValidate\",value:function numericValidate(value,callback){var pat=/^\\d+$/;this.rowValidation=pat.test(value);callback(this.rowValidation);if(!this.rowValidation)this.showMessage(this.errorBoxTitle,this.errorMessages.invalidNumber,true,true);}// Finished validation message box\n},{key:\"showMessage\",value:function showMessage(title,message,validatorClose,isMandatoryColumn){var _this11=this;confirmAlert({title:'Validation Warning',message:message,closeOnEscape:false,closeOnClickOutside:false,customUI:function customUI(_ref4){var onClose=_ref4.onClose;var closeAction=function closeAction(){if(validatorClose){if(isMandatoryColumn){var _this11$validatedCell=_this11.validatedCell,r=_this11$validatedCell.r,c=_this11$validatedCell.c;_this11.hot.selectCell(r,c);if(_this11.hot.getActiveEditor()!==undefined){var existingValueInCell=_this11.hot.getDataAtCell(r,c);_this11.hot.getActiveEditor().beginEditing();_this11.hot.getActiveEditor().setValue(existingValueInCell);}}onClose();}else{_this11.cancelEdit();onClose();}};return/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header\"},title,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"close\",onClick:closeAction,\"aria-label\":\"Close\"},/*#__PURE__*/React.createElement(\"span\",{\"aria-hidden\":\"true\"},\"\\xD7\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:'card-text text-danger'},message)),/*#__PURE__*/React.createElement(\"div\",{className:\"card-footer\"},/*#__PURE__*/React.createElement(\"button\",{className:'btn btn-warning',onClick:closeAction},\"Ok\")));}});}// Finished column header groups\n},{key:\"handleColumnHeaders\",value:function handleColumnHeaders(){var _this12=this;// Create a copy of map file\nvar headerMap=JSON.parse(JSON.stringify(groupingMap));// Set the header groups for table\nvar headerGrouping=headerMap.filter(function(item){item.colspan=item.columns.length;return typeof item.columns===\"object\";});// set each and every column defaults\nvar cols=headerMap.map(function(item){return item.columns.map(function(c){_this12.titles.push(c.label);c.color=item.color;c.editor=false;// default readonly\nif(typeof c.validator!==\"undefined\"){if(c.validator==='ipValidator'){c.validator=function(value,callback){_this12.ipValidate(value,callback);};}if(c.validator==='isNumeric'){c.validator=function(value,callback){_this12.numericValidate(value,callback);};}}if(typeof c.type!==\"undefined\"){if(c.type==='dropdown'){_this12.setPickList(c.data).then(function(list){c.source=list;});}}if(typeof c.rerenderer!==\"undefined\"){c.renderer=_this12.iconForLockStatusInCell.bind(_this12);delete c.rerenderer;}return c;});});console.log(this.columns);// spread the columns into single object\ncols.map(function(c){console.log(c);_this12.columns=[].concat(_toConsumableArray(_this12.columns),_toConsumableArray(c));});// Pushing header group const to related vars\nthis.columnHeaders.push(headerGrouping);this.columnHeaders.push(this.titles);console.log(this.columnHeaders);console.log(this.columns);}// Finished colouring header\n},{key:\"headerColoring\",value:function headerColoring(col,TH){var TR=TH.parentNode;var THEAD=TR.parentNode;var b=THEAD.childNodes.length;var n=Array.prototype.indexOf.call(THEAD.childNodes,TR);var headerLevel=-1*b+n;function applyClass(elem,className){if(!Handsontable.dom.hasClass(elem,className))Handsontable.dom.addClass(elem,className);}if(headerLevel===-1||headerLevel===-2){if(col in this.columns){var color=this.columns[col].color;if(color)applyClass(TH,color);}}}// Finished pick list setter function\n},{key:\"setPickList\",value:function setPickList(name){var _this13=this;return new Promise(function(res,rej){var value=\"\".concat(name,\"Picklist_value\");var key=\"\".concat(name,\"Picklist\");_this13.restApi.callApi('getPickList',{token:_this13.props.token,pickListName:key}).then(function(response){if(response.pickList.length>0){var list=response.pickList.map(function(item){return item[value];});res(list);}}).catch(function(error){console.log(error);});});}// Read the rule from imported rule file\n},{key:\"mandatoryColumnExtractor\",value:function mandatoryColumnExtractor(){return groupingMap.reduce(function(fullArr,item){var cols=item.columns.reduce(function(arr,col){if(col.mandatory)arr.push(col.data);return arr;},[]);return[].concat(_toConsumableArray(fullArr),_toConsumableArray(cols));},[]);}// Read the rule from imported rule file\n},{key:\"ruleExtractor\",value:function ruleExtractor(columnId){return columnLogic.find(function(item){return item.id===columnId;});}// Generic attributes validations and rule runner\n},{key:\"columnEvents\",value:function(){var _columnEvents=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(r,c,newV){var _this14=this;var properties,methodCaller,rules,executeRules,paramName,additionalParams,ruleChain,dto,additionalDTO;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.validatedCell.r=r;this.validatedCell.c=c;properties=this.ruleExtractor(c);if(properties){methodCaller=properties.methodCaller,rules=properties.rules,executeRules=properties.executeRules,paramName=properties.paramName,additionalParams=properties.additionalParams,ruleChain=properties.ruleChain;if(methodCaller){// we understand that this logic needs to call api\n// default dto\ndto=_defineProperty({token:this.props.token},paramName,this.hot.getDataAtRowProp(r,c));if(typeof additionalParams!=='undefined'&&typeof additionalParams==='object'){// create addition parameter to bind exact one\nadditionalDTO=additionalParams.map(function(prop){return _defineProperty({},prop,_this14.hot.getDataAtRowProp(r,prop));});// dto with additional parameters\ndto=Object.assign.apply(Object,[{},dto].concat(_toConsumableArray(additionalDTO)));}// method caller and logic execution\n//await this.genericCL(methodCaller, dto);\nthis.restApi.callApi(methodCaller,dto).then(function(response){if(typeof response.isExist!=='undefined'){if(!response.isExist){// value is not exist in DB, show message\n// add this row, if column is mandatory, user must fill this cell with correct value\nvar isMandatoryColumn=_this14.mandatoryColumns.includes(c);// show message and execute logic\n_this14.showMessage(_this14.errorBoxTitle,_this14.errorMessages[c],true,isMandatoryColumn);_this14.rowValidation=false;// row has error\nreturn false;}else{// value is exist in DB, check other rules associated with that one\nif(executeRules&&executeRules.length>0){executeRules.map(function(props){var propId=props.propId;var data=_this14.hot.getDataAtRowProp(r,propId);_this14.columnEvents(r,propId,data);});}_this14.rowValidation=true;// row passed all validation\n}if(ruleChain&&ruleChain.length>0){_this14.ruleChainHandle(ruleChain,dto,r);}}else{rules[0].changedValue=response.List.map(function(i){return i.value;});_this14.staticRules(r,null,rules);}});}else{this.staticRules(r,newV,rules);}}case 4:case\"end\":return _context7.stop();}}},_callee7,this);}));function columnEvents(_x4,_x5,_x6){return _columnEvents.apply(this,arguments);}return columnEvents;}()},{key:\"ruleChainHandle\",value:function ruleChainHandle(ruleChain,dto,r){var _this15=this;ruleChain.map(function(item){if(item.parentResponse){_this15.restApi.callApi(item.methodCaller,dto).then(function(response){var exec_status=response.exec_status;if(item.responseType===\"string\"){var value=response[item.parsingKey];if(exec_status===\"success\"){_this15.staticRules(r,value,item.rules);}}if(item.responseType===\"object\"){var obj=response[item.parsingKey];var list=obj.reduce(function(arr,i){return[].concat(_toConsumableArray(arr),[i[item.parsingKey]]);},[]);_this15.hot.setCellMeta(r,_this15.hot.propToCol(item.parsingKey),'source',list);_this15.hot.setDataAtRowProp(r,item.parsingKey,list[0]);}});}});}},{key:\"staticRules\",value:function staticRules(r,value,rules){var _this16=this;if(rules){rules.map(function(item){if(item.columnValue&&value){if(item.columnValue===value){// status changes\n_this16.hot.setDataAtRowProp(r,item.changedId,item.changedValue);}}else if(!item.columnValue&&value){_this16.hot.setDataAtRowProp(r,item.changedId,value);}else{_this16.hot.setCellMeta(r,_this16.hot.propToCol(item.changedId),'source',item.changedValue);}});}}},{key:\"handleExport\",value:function handleExport(){var _this17=this;var _this$props5=this.props,token=_this$props5.token,region=_this$props5.region,radioSite=_this$props5.radioSite;this.props.setSpinner();this.restApi.callApi('exportData',{region:region,token:token,radioSite:radioSite}).then(function(response){var today=new Date();//const todayDate =  '_' + today.getDate() +  (today.toLocaleString('default', { month: 'long' })) + today.getFullYear();\nvar todayDate='_'+today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate()+'T'+today.getHours()+'.'+today.getMinutes();var ws=XLSX.utils.json_to_sheet(response.ExportedExcelAsJSON);var wb={Sheets:{'data':ws},SheetNames:['data']};var excelBuffer=XLSX.write(wb,{bookType:'xlsx',type:'array'});var data=new Blob([excelBuffer],{type:'xlsx'});// saveAs(data, `DataMatrix${todayDate}.xlsx`);\nsaveAs(data,\"Exported_RANConn\".concat(todayDate,\".xlsx\"));_this17.props.setSpinner();}).catch(function(error){console.log(error);_this17.props.setSpinner();});}},{key:\"handleLockClick\",value:function handleLockClick(){var _this18=this;var r=this.selectedRowCoords.r;if(r===null)return;if(this.isRowCanBeEditable(r,'Lock')){var dto=this.prepareDTOforLockMechanism(r,true);this.restApi.callApi('lock',dto).then(function(response){_this18.showMessageForLockMechanism(true,response.resultLock);_this18.dataLoad();});}}},{key:\"handleUnlockClick\",value:function handleUnlockClick(){var _this19=this;var r=this.selectedRowCoords.r;if(r===null)return;if(this.isRowCanBeEditable(r,'Lock')){var dto=this.prepareDTOforLockMechanism(r,true);this.restApi.callApi('unlock',dto).then(function(response){_this19.showMessageForLockMechanism(false,response.resultUnlock);_this19.dataLoad();});}}},{key:\"prepareDTOforLockMechanism\",value:function prepareDTOforLockMechanism(r,isExplicit){var token=this.props.token;// get existing data at row\nvar data=this.hot.getDataAtRow(r);var radioSiteColumnIndex=this.findIndexOfColumn(0,'radioSite');var revisionNumberColumnIndex=this.findIndexOfColumn(0,'revisionNumber');var radioSite=data[radioSiteColumnIndex].toString();var revisionNumber=data[revisionNumberColumnIndex].toString();return{token:token,radioSite:radioSite,revisionNumber:revisionNumber,isExplicit:isExplicit};}},{key:\"showMessageForLockMechanism\",value:function showMessageForLockMechanism(messageForLock,result){var _this$props$language=this.props.language,lockMechanism=_this$props$language.lockMechanism,unlockMechanism=_this$props$language.unlockMechanism;var title=messageForLock?lockMechanism.title:unlockMechanism.title;var message=messageForLock?lockMechanism[result.code.toString()]:unlockMechanism[result.code.toString()];message=message?message.replace(\"{uname}\",result.uname).replace(\"{time}\",new Date(result.time).toLocaleString()):\"Undefined\";this.alert.showMessage('info',title,message,false);}},{key:\"iconForLockStatusInCell\",value:function iconForLockStatusInCell(instance,td,row,col,prop,value){var language=this.props.language;switch(value){case\"Locked_Current_User\":{var message=language.lockStatusMessages.Locked_Current_User;td.innerHTML='<strong class=\"icon icon-lock-locked text-danger\" title=\"'+message+'\" />';}break;case\"Locked_Other_User\":{var _message=language.lockStatusMessages.Locked_Other_User;td.innerHTML='<strong class=\"text-danger\" title=\"'+_message+'\">'+'<i class=\"icon icon-lock-locked\"></i>'+'<i class=\"icon icon-avatar\"></i>'+'</strong>';}break;default:{var _message2=language.lockStatusMessages.Not_Locked;td.innerHTML='<strong class=\"icon icon-lock-unlocked\" title=\"'+_message2+'\" />';}break;}td.classList.add(\"text-center\");return td;}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){return nextState.isDataExistsInDB!==this.state.isDataExistsInDB||nextState.activePage!==this.state.activePage||nextState.totalCountOfData!==this.state.totalCountOfData||nextState.newRowAdded!==this.state.newRowAdded||nextState.maximize!==this.props.maximize;}},{key:\"render\",value:function render(){var _this20=this;var _this$props6=this.props,maximize=_this$props6.maximize,language=_this$props6.language,contentCSS=_this$props6.contentCSS,showRevision=_this$props6.showRevision;if(language){this.errorBoxTitle=language.validationMessageBoxTitle;this.errorMessages=language.validationErrorMessages;}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(Row,{className:\"h-100\"},/*#__PURE__*/React.createElement(Sidebar,{maximize:maximize}),/*#__PURE__*/React.createElement(Col,{className:contentCSS},/*#__PURE__*/React.createElement(Toolbar,{wrapper:'toolbar mt-2',isDataExist:this.state.isDataExistsInDB,newRowAdded:this.state.newRowAdded,export:this.handleExport.bind(this),lock:this.handleLockClick.bind(this),unlock:this.handleUnlockClick.bind(this),new:this.handleNewRowClick.bind(this),duplicate:this.handleDuplicateRowClick.bind(this),edit:this.handleEditClick.bind(this),cancel:this.handleCancelClick.bind(this),save:this.handleSaveClick.bind(this),\"save-history\":this.handleSaveHistoryClick.bind(this),revision:this.revisionRowFilter.bind(this),handleRegionChange:this.dataLoad.bind(this),handleRadioSiteChange:this.dataLoad.bind(this)}),/*#__PURE__*/React.createElement(Card,{className:'mt-1 fixedCard'},/*#__PURE__*/React.createElement(CardBody,null,/*#__PURE__*/React.createElement(HotTable,{ref:this.hotTableComponent,id:'hot',licenseKey:'non-commercial-and-evaluation',nestedHeaders:this.columnHeaders,columns:this.columns,stretchH:'all',dropdownMenu:true,filters:true,manualColumnResize:true,width:'100%',height:'100%',fixedColumnsLeft:0,columnSorting:true,currentRowClassName:['bg-primary','text-white'],enterBeginsEditing:false,outsideClickDeselects:false,enterMoves:this.disableMoves(),fillHandle:this.disableMoves(),afterSelectionEnd:function afterSelectionEnd(r,c){_this20.selectedRowCoords.r=r;_this20.selectedRowCoords.c=c;},afterValidate:function afterValidate(isValid,value,row,prop){// this is check dropdown values are proper or not.\n_this20.validatedCell.r=row;_this20.validatedCell.c=prop;},afterGetColHeader:function afterGetColHeader(col,TH){_this20.headerColoring(col,TH);},afterCreateRow:function afterCreateRow(index,amount,source){//console.log(index, amount, source)\n},afterRenderer:function afterRenderer(td,r){if(showRevision){var v=_this20.hot.getDataAtRowProp(r,'archived');if(['YES','Yes','yes'].includes(v)){td.classList.add('revision-row');}}},afterChange:function afterChange(changes){// TODO: check esc button when its clicked\nif(changes){var _changes$=_slicedToArray(changes[0],4),r=_changes$[0],c=_changes$[1],oldV=_changes$[2],newV=_changes$[3];// check cell value if it's different previous one and\n// if row still has error -> we need that because\n// if user doesnt change value at second time, validation rule not execute.\nif(oldV!==newV||!_this20.rowValidation)_this20.columnEvents(r,c,newV);}}}),!this.state.isDataExistsInDB&&/*#__PURE__*/React.createElement(EmptyDataset,{page:'matrix'}))))),/*#__PURE__*/React.createElement(ModalImport,{loadAfterImport:this.dataLoad.bind(this)}),/*#__PURE__*/React.createElement(Spinner,null));}}]);return Matrix;}(React.Component);function mapStateToProps(state){return{token:state.token,user:state.user,language:state.language,maximize:state.maximize,contentCSS:state.contentCSS,region:state.region,radioSite:state.radioSite,spinnerToggle:state.spinnerToggle,showRevision:state.showRevision};}function mapDispatchToProps(dispatch){return{setEdit:function setEdit(){return dispatch(editOnToggle());},setSpinner:function setSpinner(){return dispatch(spinnerToggle());}};}export default connect(mapStateToProps,mapDispatchToProps)(Matrix);","map":{"version":3,"sources":["C:/Users/soperasyon27/Desktop/FE/src18mart/src/src/views/Matrix.jsx"],"names":["React","createRef","connect","Row","Col","Card","CardBody","CardFooter","HotTable","Handsontable","groupingMap","columnLogic","PaginationMatrix","Header","Sidebar","Toolbar","ModalImport","Spinner","EmptyDataset","editOnToggle","spinnerToggle","confirmAlert","XLSX","saveAs","RestApiModule","AlertModule","Matrix","props","_isMounted","restApi","alert","hotTableComponent","hot","handsontableData","handsontableDataBackup","errorMessages","errorBoxTitle","columnHeaders","titles","columns","handleColumnHeaders","selectedRowCoords","r","c","editedRowCoords","validatedCell","rowValidation","filter","mandatoryColumns","isDuplicate","submitProcessFail","state","isDataExistsInDB","newRowAdded","activePage","itemPerPage","process","env","REACT_APP_MATRIX_ITEM_PER_PAGE","totalCountOfData","exportDataAsExcelFile","user","mandatoryColumnExtractor","setStateAsync","permittedColumns","role","current","hotInstance","dataLoad","total","pageCount","token","region","radioSite","callApi","then","response","calculatePagination","ConnectivityCount","Count","filterChanged","setSpinner","dataCountOfSelectedRegion","resetSelectedRow","count","toString","page_index","ConnectivityMatrix","exec_status","length","loadData","paginationRowNumbers","getPlugin","revisionRowFilter","catch","err","Promise","resolve","setState","pageNumber","startPoint","newNumbers","Array","from","_","i","updateSettings","rowHeaders","restriction","etatRule","ruleExtractor","archivedRule","etatDataAtCell","getDataAtRowProp","archivedDataAtCell","checkEtatValue","isValue","includes","checkArchivedValue","language","message","title","lockModeRestrictionTitle","lockModeRestriction","editModeRestrictionTitle","editModeRestriction","showMessage","isRowCanBeEditable","dto","prepareDTOforLockMechanism","json","resultLock","continueToEdit","islock","uname","name","JSON","parse","stringify","setEdit","setCellProperties","showMessageForLockMechanism","alter","setInitialValueOfColumn","data","getDataAtRow","handleNewRowClick","radioSiteColumnIndex","findIndexOfColumn","lockStatusColumnIndex","lockUserColumnIndex","lockTimeColumnIndex","passThisColumns","colCount","countCols","x","setDataAtCell","cancelEdit","saveAction","res","rej","radioResponse","isExist","getConfirmation","radioSiteExistsWithSameNameTitle","radioSiteExistsWithSameNameText","confirmation","isExists","revision","isRevision","importStatusResponse","isImportOngoing","isLock","undefined","reduce","newRowData","item","index","Object","assign","mandatoryColumnsFilled","checkMandatoryColumnsFilled","isNewRow","checkIsRadioSiteExists","isExistsResponse","confirm","saveIt","mandatoryDataTitle","text","mandatoryDataText","replace","join","validationMessageBoxTitle","validationErrorGeneralMessage","importSection","ongoingImportText","ongoingImportTitle","resetRow","row","result","processed","log","split","saveActionSuccessTitle","saveActionFailTitle","colIndex","showRevision","arg","removeConditions","addCondition","col","getCellMeta","prop","readOnly","readOnlyInEditMode","writable","indexOf","type","getDataType","setCellMeta","render","selectCell","propName","rowData","checkData","columnId","push","every","map","hasOwnProperty","setDataAtRowProp","initialValue","deselectCell","value","callback","pat","test","invalidIP","invalidNumber","validatorClose","isMandatoryColumn","closeOnEscape","closeOnClickOutside","customUI","onClose","closeAction","getActiveEditor","existingValueInCell","getDataAtCell","beginEditing","setValue","headerMap","headerGrouping","colspan","cols","label","color","editor","validator","ipValidate","numericValidate","setPickList","list","source","rerenderer","renderer","iconForLockStatusInCell","bind","console","TH","TR","parentNode","THEAD","b","childNodes","n","prototype","call","headerLevel","applyClass","elem","className","dom","hasClass","addClass","key","pickListName","pickList","error","fullArr","arr","mandatory","find","id","newV","properties","methodCaller","rules","executeRules","paramName","additionalParams","ruleChain","additionalDTO","propId","columnEvents","ruleChainHandle","changedValue","List","staticRules","parentResponse","responseType","parsingKey","obj","propToCol","columnValue","changedId","today","Date","todayDate","getFullYear","getMonth","getDate","getHours","getMinutes","ws","utils","json_to_sheet","ExportedExcelAsJSON","wb","Sheets","SheetNames","excelBuffer","write","bookType","Blob","resultUnlock","isExplicit","revisionNumberColumnIndex","revisionNumber","messageForLock","lockMechanism","unlockMechanism","code","time","toLocaleString","instance","td","lockStatusMessages","Locked_Current_User","innerHTML","Locked_Other_User","Not_Locked","classList","add","nextProps","nextState","nextContext","maximize","contentCSS","validationErrorMessages","handleExport","handleLockClick","handleUnlockClick","handleDuplicateRowClick","handleEditClick","handleCancelClick","handleSaveClick","handleSaveHistoryClick","disableMoves","isValid","headerColoring","amount","v","changes","oldV","Component","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"uiDAAA,MAAOA,CAAAA,KAAP,EAAeC,SAAf,KAA+B,OAA/B,CACA,OAAQC,OAAR,KAAsB,aAAtB,CACA,OAAQC,GAAR,CAAaC,GAAb,CAAkBC,IAAlB,CAAwBC,QAAxB,CAAkCC,UAAlC,KAAmD,YAAnD,CAEA,OAAQC,QAAR,KAAuB,qBAAvB,CACA,MAAOC,CAAAA,YAAP,KAAyB,cAAzB,CACA,OAAQC,WAAR,KAA0B,kBAA1B,CACA,OAAQC,WAAR,KAA0B,yBAA1B,CAEA,MAAOC,CAAAA,gBAAP,KAA6B,0BAA7B,CAEA,MAAOC,CAAAA,MAAP,KAAmB,sBAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,MAAOC,CAAAA,OAAP,KAAoB,6BAApB,CACA,MAAOC,CAAAA,WAAP,KAAwB,2BAAxB,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,MAAOC,CAAAA,YAAP,KAAyB,4BAAzB,CAEA,OAAQC,YAAR,CAAsBC,aAAtB,KAA0C,kBAA1C,CAEA,OAASC,YAAT,KAA6B,qBAA7B,CACA,MAAO,iDAAP,CAEA;AACA,MAAOC,CAAAA,IAAP,KAAiB,MAAjB,CACA,OAAQC,MAAR,KAAqB,YAArB,CAEA;AACA,MAAOC,CAAAA,aAAP,KAA0B,kBAA1B,CAEA;AACA,MAAOC,CAAAA,WAAP,KAAwB,gBAAxB,C,GAEMC,CAAAA,M,4GAGF,gBAAYC,KAAZ,CAAmB,wCACf,uBAAMA,KAAN,EADe,MAFnBC,UAEmB,CAFN,KAEM,CAGf,MAAKC,OAAL,CAAe,GAAIL,CAAAA,aAAJ,EAAf,CACA,MAAKM,KAAL,CAAa,GAAIL,CAAAA,WAAJ,EAAb,CAEA,MAAKM,iBAAL,CAAyB9B,SAAS,EAAlC,CACA,MAAK+B,GAAL,CAAW,IAAX,CACA,MAAKC,gBAAL,CAAwB,IAAxB,CACA,MAAKC,sBAAL,CAA8B,IAA9B,CAEA,MAAKC,aAAL,CAAqB,IAArB,CACA,MAAKC,aAAL,CAAqB,IAArB,CACA,MAAKC,aAAL,CAAqB,EAArB,CACA,MAAKC,MAAL,CAAc,EAAd,CACA,MAAKC,OAAL,CAAe,EAAf,CACA,MAAKC,mBAAL,GAEA,MAAKC,iBAAL,CAAyB,CAACC,CAAC,CAAE,IAAJ,CAAUC,CAAC,CAAE,IAAb,CAAzB,CACA,MAAKC,eAAL,CAAuB,CAACF,CAAC,CAAE,IAAJ,CAAUC,CAAC,CAAE,IAAb,CAAvB,CACA,MAAKE,aAAL,CAAqB,CAACH,CAAC,CAAE,IAAJ,CAAUC,CAAC,CAAE,IAAb,CAArB,CACA,MAAKG,aAAL,CAAqB,IAArB,CACA,MAAKC,MAAL,CAAc,IAAd,CACA,MAAKC,gBAAL,CAAwB,IAAxB,CACA,MAAKC,WAAL,CAAmB,KAAnB,CACA,MAAKC,iBAAL,CAAyB,KAAzB,CAGA;AACA,MAAKC,KAAL,CAAa,CACTC,gBAAgB,CAAE,KADT,CAETC,WAAW,CAAE,KAFJ,CAGTC,UAAU,CAAE,CAHH,CAITC,WAAW,CAAE,CAACC,OAAO,CAACC,GAAR,CAAYC,8BAJjB,CAKTC,gBAAgB,CAAE,CALT,CAMTC,qBAAqB,CAAE,IANd,CAAb,CA7Be,aAqClB,C,gFAEmB,CAChB,KAAKhC,UAAL,CAAkB,IAAlB,CAEA,GAAI,KAAKD,KAAL,CAAWkC,IAAf,CAAqB,CAEjB;AACA,KAAKb,gBAAL,CAAwB,KAAKc,wBAAL,EAAxB,CAEA,KAAKC,aAAL,CAAmB,CAACC,gBAAgB,CAAE,KAAKrC,KAAL,CAAWkC,IAAX,CAAgBI,IAAhB,CAAqBD,gBAAxC,CAAnB,EACA,KAAKhC,GAAL,CAAW,KAAKD,iBAAL,CAAuBmC,OAAvB,CAA+BC,WAA1C,CAEA,KAAKC,QAAL,GACH,CACJ,C,mEAEsB,CACnB,KAAKxC,UAAL,CAAkB,KAAlB,CACH,C,gEAEmByC,K,CAAO,CAEvB,GAAIA,KAAJ,CAAW,CACP,GAAMC,CAAAA,SAAS,CAAG,CAACD,KAAD,CAAS,KAAKlB,KAAL,CAAWI,WAAtC,CACA,KAAKQ,aAAL,CAAmB,CAACJ,gBAAgB,CAAEU,KAAnB,CAA0BC,SAAS,CAATA,SAA1B,CAAnB,EACH,CACJ,C,6EAE2B,iCAEW,KAAK3C,KAFhB,CAEjB4C,KAFiB,aAEjBA,KAFiB,CAEVC,MAFU,aAEVA,MAFU,CAEFC,SAFE,aAEFA,SAFE,CAIxB,GAAID,MAAJ,CAAY,CACR,KAAK3C,OAAL,CAAa6C,OAAb,CAAqB,oBAArB,CAA2C,CACvCH,KAAK,CAALA,KADuC,CAEvCC,MAAM,CAANA,MAFuC,CAGvCC,SAAS,CAATA,SAHuC,CAA3C,EAIGE,IAJH,CAIQ,SAAAC,QAAQ,CAAI,CAChB,MAAI,CAACC,mBAAL,CAAyBD,QAAQ,CAACE,iBAAT,CAA2B,CAA3B,EAA8BC,KAAvD,EACH,CAND,EAOH,CACJ,C,2HAEcC,a,kLAEP,KAAKpD,U,uCAC8B,KAAKD,K,CAAjC4C,K,cAAAA,K,CAAOC,M,cAAAA,M,CAAQC,S,cAAAA,S,CAEtB;AACA,GAAIO,aAAJ,CAAmB,CAEf,KAAKjB,aAAL,CAAmB,CACfT,UAAU,CAAE,CADG,CAEfC,WAAW,CAAGyB,aAAa,GAAK,WAAnB,CAAkC,GAAlC,CAAwC,CAACxB,OAAO,CAACC,GAAR,CAAYC,8BAFnD,CAAnB,EAIH,C,IAEGc,M,0BACA,KAAK7C,KAAL,CAAWsD,UAAX,GAEA;uBACM,MAAKC,yBAAL,E,QAEN;AACA,KAAKC,gBAAL,GAEA,KAAKtD,OAAL,CAAa6C,OAAb,CAAqB,eAArB,CAAsC,CAClCH,KAAK,CAALA,KADkC,CAElCC,MAAM,CAANA,MAFkC,CAGlCC,SAAS,CAATA,SAHkC,CAIlCW,KAAK,CAAE,KAAKjC,KAAL,CAAWI,WAAX,CAAuB8B,QAAvB,EAJ2B,CAKlCC,UAAU,CAAE,KAAKnC,KAAL,CAAWG,UAAX,CAAsB+B,QAAtB,EALsB,CAAtC,EAMGV,IANH,0FAMQ,iBAAOC,QAAP,qJACJ;AAEA;AACA;AAEOW,kBANH,CAMsCX,QANtC,CAMGW,kBANH,CAMuBC,WANvB,CAMsCZ,QANtC,CAMuBY,WANvB,CAQJ;AARI,KASAA,WAAW,GAAK,SAAhB,EACAD,kBAAkB,CAACE,MAAnB,CAA4B,CAV5B,2BAYA,MAAI,CAAC1B,aAAL,CAAmB,CAACX,gBAAgB,CAAE,IAAnB,CAAnB,EAEA,MAAI,CAACnB,gBAAL,CAAwBsD,kBAAxB,CAA4C;AAC5C,MAAI,CAACvD,GAAL,CAAS0D,QAAT,CAAkB,MAAI,CAACzD,gBAAvB,EAEA,MAAI,CAAC0D,oBAAL,GAEA,qCACA,MAAI,CAAC5C,MAAL,CAAc,MAAI,CAACf,GAAL,CAAS4D,SAAT,CAAmB,SAAnB,CAAd,CApBA,sBAsBM,CAAA,MAAI,CAACC,iBAAL,EAtBN,uCA0BA,MAAI,CAAC9B,aAAL,CAAmB,CAACX,gBAAgB,CAAE,KAAnB,CAAnB,EA1BA,QA6BJ;AACA,MAAI,CAACzB,KAAL,CAAWsD,UAAX,GA9BI,uDANR,iEAsCGa,KAtCH,CAsCS,SAAAC,GAAG,CAAI,CACZ;AACA;AACA;AAEA;AACA,MAAI,CAAChC,aAAL,CAAmB,CAACX,gBAAgB,CAAE,KAAnB,CAAnB,EAEA;AACA,MAAI,CAACzB,KAAL,CAAWsD,UAAX,GACH,CAhDD,E,qMAqDE9B,K,CAAO,iBACjB,MAAO,IAAI6C,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAa,CAC5B,MAAI,CAACC,QAAL,CAAc/C,KAAd,CAAqB8C,OAArB,EACH,CAFM,CAAP,CAGH,C,2IAEsBE,U,6IAIb,MAAKpC,aAAL,CAAmB,CAACT,UAAU,CAAE6C,UAAb,CAAnB,C,QACN,KAAK/B,QAAL,G,6OAGmB,CACnB;AADmB,gBAEe,KAAKjB,KAFpB,CAEZG,UAFY,aAEZA,UAFY,CAEAC,WAFA,aAEAA,WAFA,CAInB,GAAM6C,CAAAA,UAAU,CAAG,CAAC9C,UAAU,CAAG,CAAd,EAAmBC,WAApB,CAAmC,CAArD,CACA,GAAM8C,CAAAA,UAAU,CAAGC,KAAK,CAACC,IAAN,CAAWD,KAAK,CAAC/C,WAAD,CAAhB,CAA+B,SAACiD,CAAD,CAAIC,CAAJ,QAAUL,CAAAA,UAAU,CAAGK,CAAvB,EAA/B,CAAnB,CAEA,KAAKzE,GAAL,CAAS0E,cAAT,CAAwB,CACpBC,UAAU,CAAEN,UADQ,CAAxB,EAGH,C,8DAEkB3D,C,CAAGkE,W,CAAa,CAE/B,GAAMC,CAAAA,QAAQ,CAAG,KAAKC,aAAL,CAAmB,gBAAnB,CAAjB,CACA,GAAMC,CAAAA,YAAY,CAAG,KAAKD,aAAL,CAAmB,oBAAnB,CAArB,CACA,GAAME,CAAAA,cAAc,CAAG,KAAKhF,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6B,MAA7B,CAAvB,CACA,GAAMwE,CAAAA,kBAAkB,CAAG,KAAKlF,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6B,UAA7B,CAA3B,CAEA,GAAMyE,CAAAA,cAAc,CAAGN,QAAQ,CAACO,OAAT,CAAiBC,QAAjB,CAA0BL,cAA1B,CAAvB,CACA,GAAMM,CAAAA,kBAAkB,CAAGP,YAAY,CAACK,OAAb,CAAqBC,QAArB,CAA8BH,kBAA9B,CAA3B,CAEA,GAAMtC,CAAAA,QAAQ,CAAIuC,cAAc,EAAIG,kBAApC,CAEA,GAAI,CAAC1C,QAAL,CAAe,IACJ2C,CAAAA,QADI,CACQ,KAAK5F,KADb,CACJ4F,QADI,CAEX,GAAIC,CAAAA,OAAJ,CAAaC,KAAK,CAAG,EAArB,CAEA,OAAQb,WAAR,EACI,IAAK,MAAL,CAAca,KAAK,CAAGF,QAAQ,CAACG,wBAAjB,CAA2CF,OAAO,CAAGD,QAAQ,CAACI,mBAAnB,CAAwC,MACjG,IAAK,MAAL,CACA,QAAUF,KAAK,CAAGF,QAAQ,CAACK,wBAAjB,CAA2CJ,OAAO,CAAGD,QAAQ,CAACM,mBAAnB,CAAwC,MAHjG,CAKA,KAAK/F,KAAL,CAAWgG,WAAX,CAAuB,SAAvB,CAAkCL,KAAlC,CAAyCD,OAAzC,CAAkD,KAAlD,EACH,CAED,MAAO5C,CAAAA,QAAP,CACH,CAED;yDACkB,2CAEC,KAAKnC,iBAFN,CAEPC,CAFO,uBAEPA,CAFO,CAEJC,CAFI,uBAEJA,CAFI,CAGd,GAAID,CAAC,GAAK,IAAN,EAAcC,CAAC,GAAK,IAAxB,CAA8B,OAE9B,GAAI,KAAKoF,kBAAL,CAAwBrF,CAAxB,CAAJ,CAAgC,CAE5B;AACA,GAAMsF,CAAAA,GAAG,CAAG,KAAKC,0BAAL,CAAgCvF,CAAhC,CAAmC,KAAnC,CAAZ,CAEA,KAAKb,OAAL,CAAa6C,OAAb,CAAqB,MAArB,CAA6BsD,GAA7B,EAAkCrD,IAAlC,CAAuC,SAAAC,QAAQ,CAAI,CAC/C,GAAMsD,CAAAA,IAAI,CAAGtD,QAAQ,CAACuD,UAAtB,CAD+C,GAExCtE,CAAAA,IAFwC,CAEhC,MAAI,CAAClC,KAF2B,CAExCkC,IAFwC,CAI/C;AACA,GAAMuE,CAAAA,cAAc,CAAGF,IAAI,CAACG,MAAL,EAAeH,IAAI,CAACI,KAAL,GAAezE,IAAI,CAAC0E,IAA1D,CAEA,GAAIH,cAAJ,CAAoB,CAEhB;AACA,MAAI,CAAClG,sBAAL,CAA8BsG,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,MAAI,CAACzG,gBAApB,CAAX,CAA9B,CAEA;AACA,MAAI,CAACN,KAAL,CAAWgH,OAAX,GAEA,MAAI,CAACC,iBAAL,CAAuBlG,CAAvB,CAA0BC,CAA1B,EACA,MAAI,CAACC,eAAL,CAAqBF,CAArB,CAAyBA,CAAzB,CACA,MAAI,CAACE,eAAL,CAAqBD,CAArB,CAAyBA,CAAzB,CAEH,CAZD,IAYO,CACH,MAAI,CAACkG,2BAAL,CAAiC,IAAjC,CAAuCX,IAAvC,EACH,CACJ,CAtBD,EAwBH,CACJ,CAED;0RAGU,MAAKnE,aAAL,CAAmB,CAACV,WAAW,CAAG,IAAf,CAAnB,C,QACN,KAAKT,eAAL,CAAqBF,CAArB,CAAyB,CAAzB,CACA,KAAKE,eAAL,CAAqBD,CAArB,CAAyB,CAAzB,CACA,KAAKM,WAAL,CAAmB,KAAnB,CAEA;AACA,KAAKf,sBAAL,CAA8BsG,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKzG,gBAApB,CAAX,CAA9B,CAEA,KAAKN,KAAL,CAAWgH,OAAX,GACA,KAAK3G,GAAL,CAAS8G,KAAT,CAAe,YAAf,CAA6B,CAA7B,CAAgC,CAAhC,EACA,KAAKF,iBAAL,CAAuB,CAAvB,CAA0B,IAA1B,EAEA;AACA,GAAI,KAAKzF,KAAL,CAAWE,WAAX,EAA0B,CAAC,KAAKJ,WAApC,CAAiD,CAC7C,KAAK8F,uBAAL,GACH,C,mmBAKc,KAAKtG,iB,CAAbC,C,wBAAAA,C,CAAGC,C,wBAAAA,C,MACND,CAAC,GAAK,IAAN,EAAcC,CAAC,GAAK,I,oEAExB;AACMqG,I,CAAO,KAAKhH,GAAL,CAASiH,YAAT,CAAsBvG,CAAtB,C,CAEb,KAAKO,WAAL,CAAmB,IAAnB,C,uBACM,MAAKiG,iBAAL,E,QAEN;AACMC,oB,CAAuB,KAAKC,iBAAL,CAAuB,CAAvB,CAAyB,WAAzB,C,CACvBC,qB,CAAwB,KAAKD,iBAAL,CAAuB,CAAvB,CAAyB,aAAzB,C,CACxBE,mB,CAAsB,KAAKF,iBAAL,CAAuB,CAAvB,CAAyB,WAAzB,C,CACtBG,mB,CAAsB,KAAKH,iBAAL,CAAuB,CAAvB,CAAyB,WAAzB,C,CAEtBI,e,CAAkB,CACpBL,oBADoB,CAEpBE,qBAFoB,CAGpBC,mBAHoB,CAIpBC,mBAJoB,C,CAMxB;AACME,Q,CAAW,KAAKzH,GAAL,CAAS0H,SAAT,E,CAEjB;AACSC,C,CAAI,C,cAAGA,CAAC,EAAIF,Q,iCAGbE,CAAC,GAAIH,CAAAA,e,2EAET;AACA,KAAKxH,GAAL,CAAS4H,aAAT,CAAuB,CAAvB,CAA0BD,CAA1B,CAA6BX,IAAI,CAACW,CAAD,CAAjC,E,QAN2BA,CAAC,E,mRAUhB,iBAEhB,GAAI,CAAC,KAAKxG,KAAL,CAAWE,WAAhB,CAA6B,2BAEV,KAAKT,eAFK,CAElBF,CAFkB,uBAElBA,CAFkB,CAEfC,CAFe,uBAEfA,CAFe,CAGzB,GAAID,CAAC,GAAK,IAAN,EAAcC,CAAC,GAAK,IAAxB,CAA8B,OAE9B;AACA,GAAMqF,CAAAA,GAAG,CAAG,KAAKC,0BAAL,CAAgCvF,CAAhC,CAAmC,KAAnC,CAAZ,CAEA;AACA,KAAKb,OAAL,CAAa6C,OAAb,CAAqB,QAArB,CAA+BsD,GAA/B,EACH,CACD,KAAKjE,aAAL,CAAmB,CAACV,WAAW,CAAG,KAAf,CAAnB,EAA0CsB,IAA1C,CAA+C,UAAM,CACjD,MAAI,CAACkF,UAAL,GACH,CAFD,EAGH,C,yDAEiB,CACd,KAAKC,UAAL,GACH,C,uEAEwB,CACrB,KAAKA,UAAL,CAAgB,IAAhB,EACH,C,sEAEsBvF,K,CAAOE,S,CAAW,iBAErC,MAAO,IAAIuB,CAAAA,OAAJ,CAAY,SAAC+D,GAAD,CAAMC,GAAN,CAAc,IAEtBzC,CAAAA,QAFsB,CAEV,MAAI,CAAC5F,KAFK,CAEtB4F,QAFsB,CAI7B;AACA;AACA,MAAI,CAAC1F,OAAL,CAAa6C,OAAb,CAAqB,mBAArB,CAA0C,CACtCH,KAAK,CAALA,KADsC,CAEtCE,SAAS,CAATA,SAFsC,CAA1C,EAGGE,IAHH,CAGQ,SAAAsF,aAAa,CAAI,CAErB,GAAIA,aAAa,CAACC,OAAd,GAA0B,IAA9B,CAAoC,CAEhC;AACA,MAAI,CAACpI,KAAL,CAAWqI,eAAX,CACI,SADJ,CAEI5C,QAAQ,CAAC6C,gCAFb,CAGI7C,QAAQ,CAAC8C,+BAHb,EAIE1F,IAJF,CAIO,SAAA2F,YAAY,CAAI,CACnBP,GAAG,CAAC,CACAO,YAAY,CAAZA,YADA,CAEAC,QAAQ,CAAEN,aAAa,CAACC,OAFxB,CAAD,CAAH,CAIH,CATD,EAUH,CAbD,IAaO,CACH;AACAH,GAAG,CAAC,CACAO,YAAY,CAAE,IADd,CAEAC,QAAQ,CAAEN,aAAa,CAACC,OAFxB,CAAD,CAAH,CAIH,CACJ,CAzBD,EAyBGpE,KAzBH,CAyBS,SAAAC,GAAG,CAAI,CACZiE,GAAG,CAACjE,GAAD,CAAH,CACH,CA3BD,EA6BH,CAnCM,CAAP,CAoCH,CAED;8CACWyE,Q,CAAU,kCAES,KAAK7I,KAFd,CAEV4F,QAFU,cAEVA,QAFU,CAEAhD,KAFA,cAEAA,KAFA,CAGjB,GAAMkG,CAAAA,UAAU,CAAGD,QAAQ,CAAGA,QAAH,CAAc,KAAzC,CAEA,KAAK3I,OAAL,CAAa6C,OAAb,CAAqB,iBAArB,CAAwC,CACpCH,KAAK,CAALA,KADoC,CAAxC,EAEGI,IAFH,CAEQ,SAAA+F,oBAAoB,CAAI,IAErBC,CAAAA,eAFqB,CAEFD,oBAFE,CAErBC,eAFqB,2BAGb,MAAI,CAAC/H,eAHQ,CAGrBF,CAHqB,uBAGrBA,CAHqB,CAGlBC,CAHkB,uBAGlBA,CAHkB,CAM5B,GAAI,CAACgI,eAAe,CAACC,MAArB,CAA6B,CACzB;AAEA,GAAI,MAAI,CAAC9H,aAAT,CAAwB,CAEpB,GAAIJ,CAAC,GAAK,IAAN,EAAcA,CAAC,GAAKmI,SAAxB,CAAmC,CAC/B;AACA,GAAI7B,CAAAA,IAAI,CAAG,MAAI,CAAChH,GAAL,CAASiH,YAAT,CAAsBvG,CAAtB,CAAX,CAEAsG,IAAI,CAAG,MAAI,CAACzG,OAAL,CAAauI,MAAb,CAAoB,SAACC,UAAD,CAAaC,IAAb,CAAmBC,KAAnB,CAA6B,CAEpDC,MAAM,CAACC,MAAP,CAAcJ,UAAd,CACK/B,IAAI,CAACiC,KAAD,CAAJ,GAAgB,IAAjB,oBACQD,IAAI,CAAChC,IADb,CACoBA,IAAI,CAACiC,KAAD,CADxB,qBAEQD,IAAI,CAAChC,IAFb,CAEoB,EAFpB,CADJ,EAKA,MAAO+B,CAAAA,UAAP,CACH,CARM,CAQJ,EARI,CAAP,CAUA,GAAMK,CAAAA,sBAAsB,CAAG,MAAI,CAACC,2BAAL,CAAiCrC,IAAjC,CAA/B,CAEA,GAAIoC,sBAAJ,CAA4B,IAEHE,CAAAA,QAFG,CAES,MAAI,CAACnI,KAFd,CAEhBE,WAFgB,CAIxB;AACA,GAAIiI,QAAJ,CAAc,CAEV,MAAI,CAACC,sBAAL,CAA4BhH,KAA5B,CAAmCyE,IAAI,CAAC,WAAD,CAAvC,EACKrE,IADL,CACU,SAAA6G,gBAAgB,CAAI,CAEtB,GAAMC,CAAAA,OAAO,CAAGD,gBAAgB,CAAClB,YAAjC,CACA,GAAImB,OAAO,EAAIA,OAAO,GAAK,IAA3B,CAAgC,CAC5B;AACA;AACA,MAAI,CAACC,MAAL,CAAYnH,KAAZ,CAAmByE,IAAnB,CAAyBsC,QAAzB,CAAmCE,gBAAgB,CAACjB,QAApD,CAA8D7H,CAA9D,CAAiEC,CAAjE,EACH,CACR,CATD,EAWH,CAbD,IAaO,CAEH,MAAI,CAAC+I,MAAL,CAAYnH,KAAZ,CAAmByE,IAAnB,CAAyBsC,QAAzB,CAAmCb,UAAnC,CAA+C/H,CAA/C,CAAkDC,CAAlD,EACH,CAEJ,CAvBD,IAuBO,CAEH,GAAM8E,CAAAA,KAAK,CAAGF,QAAQ,CAACoE,kBAAvB,CACA,GAAIC,CAAAA,IAAI,CAAGrE,QAAQ,CAACsE,iBAApB,CAEAD,IAAI,CAAGA,IAAI,CAACE,OAAL,CAAa,WAAb,CAA0B,MAAI,CAAC9I,gBAAL,CAAsB+I,IAAtB,CAA2B,OAA3B,CAA1B,CAAP,CAEA,MAAI,CAACjK,KAAL,CAAWgG,WAAX,CAAuB,OAAvB,CAAgCL,KAAhC,CAAuCmE,IAAvC,CAA6C,KAA7C,EACH,CACJ,CAEJ,CApDD,IAoDO,IAEIrE,CAAAA,SAFJ,CAEgB,MAAI,CAAC5F,KAFrB,CAEI4F,QAFJ,CAGH,MAAI,CAACzF,KAAL,CAAWgG,WAAX,CAAuB,OAAvB,CACIP,SAAQ,CAACyE,yBADb,CAEIzE,SAAQ,CAAC0E,6BAFb,CAGI,KAHJ,EAIH,CAEJ,CAhED,IAgEO,CACH,GAAMzE,CAAAA,OAAO,CAAGD,QAAQ,CAAC2E,aAAT,CAAuBC,iBAAvB,CAAyCL,OAAzC,CAAiD,YAAjD,CAA+DnB,eAAe,CAACrC,KAA/E,CAAhB,CAEA,MAAI,CAACxG,KAAL,CAAWgG,WAAX,CACI,SADJ,CAEIP,QAAQ,CAAC2E,aAAT,CAAuBE,kBAF3B,CAGI5E,OAHJ,CAII,KAJJ,EAMA;AACA,MAAI,CAAC6E,QAAL,CAAc3J,CAAd,EACA,MAAI,CAACf,KAAL,CAAWgH,OAAX,GACA,MAAI,CAACvE,QAAL,GACH,CACJ,CAtFD,EAuFH,C,sCAEMG,K,CAAO+H,G,CAAKhB,Q,CAAUb,U,CAAY/H,C,CAAGC,C,CAAG,kCAEb,KAAKhB,KAFQ,CAEpCsD,UAFoC,cAEpCA,UAFoC,CAExB0D,OAFwB,cAExBA,OAFwB,CAI3C1D,UAAU,GAEV;AACA,KAAKpD,OAAL,CAAa6C,OAAb,CAAqB,SAArB,CAAgC,CAC5BH,KAAK,CAALA,KAD4B,CAE5B+H,GAAG,CAAHA,GAF4B,CAG5BhB,QAAQ,CAARA,QAH4B,CAI5Bb,UAAU,CAAVA,UAJ4B,CAAhC,EAMA9F,IANA,CAMK,SAAAC,QAAQ,CAAI,IAEN2C,CAAAA,QAFM,CAEM,MAAI,CAAC5F,KAFX,CAEN4F,QAFM,sBAIY3C,QAAQ,CAAC2H,MAJrB,CAINC,SAJM,kBAINA,SAJM,CAIKC,GAJL,kBAIKA,GAJL,CAMb,GAAMjF,CAAAA,OAAO,CAAGiF,GAAG,CAACC,KAAJ,CAAU,IAAV,EAAgBX,IAAhB,CAAqB,MAArB,CAAhB,CAEA9G,UAAU,GAEV,GAAIuH,SAAJ,CAAe,CACX,MAAI,CAAC1K,KAAL,CAAWgG,WAAX,CAAuB,SAAvB,CACIP,QAAQ,CAACoF,sBADb,CAEInF,OAFJ,CAGI,KAHJ,EAMA,MAAI,CAAC/E,iBAAL,CAAuBE,CAAvB,CAA2BA,CAA3B,CACA,MAAI,CAACF,iBAAL,CAAuBC,CAAvB,CAA2BA,CAA3B,CACA,MAAI,CAACE,eAAL,CAAqBF,CAArB,CAAyB,IAAzB,CACA,MAAI,CAACE,eAAL,CAAqBD,CAArB,CAAyB,IAAzB,CAEA;AACA,GAAI,MAAI,CAACQ,KAAL,CAAWE,WAAf,CACI,MAAI,CAAC6C,QAAL,CAAc,CAAE7C,WAAW,CAAG,KAAhB,CAAd,EAEJsF,OAAO,GAAI;AACX,MAAI,CAAC0D,QAAL,CAAc3J,CAAd,EAAkB;AAClB,MAAI,CAAC0B,QAAL,GAAiB;AAEpB,CApBD,IAoBO,CACH;AACA;AACA,MAAI,CAACtC,KAAL,CAAWgG,WAAX,CAAuB,OAAvB,CACIP,QAAQ,CAACqF,mBADb,CAEIpF,OAFJ,CAGI,KAHJ,EAMA;AACA,MAAI,CAACoB,iBAAL,CAAuBlG,CAAvB,CAA0BC,CAA1B,EAEH,CACJ,CAjDD,EAiDGmD,KAjDH,CAiDS,UAAM,CACX;AACA;AACAb,UAAU,GACV;AACA;AACH,CAvDD,EAwDH,C,qSAGO,KAAKrD,U,0BACCiL,Q,CAAW,KAAKzD,iBAAL,CAAuB,CAAvB,CAAyB,UAAzB,C,CACV0D,Y,CAAgB,KAAKnL,K,CAArBmL,Y,CAEDC,G,CAAMD,YAAY,CAAG,EAAH,CAAQ,I,CAAM;AAEtC,GAAIA,YAAJ,CAAkB,CACd,KAAK/J,MAAL,CAAYiK,gBAAZ,CAA6BH,QAA7B,EACH,CAFD,IAEO,CACH,KAAK9J,MAAL,CAAYkK,YAAZ,CAAyBJ,QAAzB,CAAmC,UAAnC,CAA+CE,GAA/C,EACH,C,uBACK,MAAKhK,MAAL,CAAYA,MAAZ,E,uOAIIL,C,CAAGC,C,CAAG,CAEpB,GAAM8G,CAAAA,QAAQ,CAAG,KAAKzH,GAAL,CAAS0H,SAAT,EAAjB,CACA,GAAIwD,CAAAA,GAAG,CAAGvK,CAAC,GAAK,IAAN,CAAaA,CAAb,CAAiB,CAA3B,CAEA,IAAK,GAAIgH,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAIF,QAArB,CAA+BE,CAAC,EAAhC,CAAoC,2BACa,KAAK3H,GAAL,CAASmL,WAAT,CAAqBzK,CAArB,CAAuBiH,CAAvB,CADb,CACzByD,IADyB,uBACzBA,IADyB,CACnBC,QADmB,uBACnBA,QADmB,CACTC,kBADS,uBACTA,kBADS,CAGhC,GAAI,MAAOF,CAAAA,IAAP,GAAgB,QAApB,CAA8B,SAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAMG,CAAAA,QAAQ,CAAGF,QAAQ,CAAG,CAACA,QAAJ,CAAe,CAAC,KAAKlK,KAAL,CAAWE,WAAZ,CAA0B,CAACiK,kBAA3B,CAAgD,CAACD,QAAzF,CAEA,GAAIE,QAAJ,CAAc,CACV,GAAI,KAAKpK,KAAL,CAAWa,gBAAX,CAA4BwJ,OAA5B,CAAoCJ,IAApC,GAA6C,CAAjD,CAAoD,CAEhD,GAAMK,CAAAA,IAAI,CAAG,KAAKzL,GAAL,CAAS0L,WAAT,CAAqBhL,CAArB,CAAwBiH,CAAxB,CAAb,CAAyC;AAEzC;AACA;AACA;AAEAuD,GAAG,CAAGA,GAAG,GAAK,CAAR,CAAYvD,CAAZ,CAAgBuD,GAAtB,CAA2B;AAE3B,KAAKlL,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwBiH,CAAxB,CAA2B,QAA3B,CAAqC8D,IAArC,EACA,KAAKzL,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwBiH,CAAxB,CAA2B,WAA3B,CAAwC,sBAAxC,EACH,CACJ,CACJ,CACD,KAAK3H,GAAL,CAAS4L,MAAT,GACA,KAAK5L,GAAL,CAAS6L,UAAT,CAAoBnL,CAApB,CAAuBwK,GAAvB,EACH,C,4DAEiBxK,C,CAAGoL,Q,CAAU,CAC3B,GAAMrE,CAAAA,QAAQ,CAAG,KAAKzH,GAAL,CAAS0H,SAAT,EAAjB,CACA,IAAK,GAAI/G,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAI8G,QAArB,CAA+B9G,CAAC,EAAhC,CAAoC,4BACjB,KAAKX,GAAL,CAASmL,WAAT,CAAqBzK,CAArB,CAAuBC,CAAvB,CADiB,CACzByK,IADyB,wBACzBA,IADyB,CAEhC,GAAIA,IAAI,GAAKU,QAAb,CAAuB,CACnB,MAAOnL,CAAAA,CAAP,CACH,CACJ,CACJ,CAED;gFAC4BoL,O,CAAS,CAEjC,GAAMC,CAAAA,SAAS,CAAG,KAAKhL,gBAAL,CAAsB8H,MAAtB,CAA6B,SAAC9B,IAAD,CAAOiF,QAAP,CAAoB,CAC/DjF,IAAI,CAACkF,IAAL,CAAUH,OAAO,CAACE,QAAD,CAAjB,EACA,MAAOjF,CAAAA,IAAP,CACH,CAHiB,CAGf,EAHe,CAAlB,CAKA,MAAOgF,CAAAA,SAAS,CAACG,KAAV,CAAgB,SAAAnF,IAAI,CAAI,CAC3B,MAAOA,CAAAA,IAAI,GAAK6B,SAAT,EAAsB7B,IAAI,GAAK,EAA/B,EAAqCA,IAAI,GAAK,IAArD,CACH,CAFM,CAAP,CAGH,CAED;yEAC0B,kBACtB,KAAKzG,OAAL,CAAa6L,GAAb,CAAiB,SAACpD,IAAD,CAAU,CACvB,GAAIA,IAAI,CAACqD,cAAL,CAAoB,cAApB,CAAJ,CAAyC,CACrC,OAAI,CAACrM,GAAL,CAASsM,gBAAT,CAA0B,CAA1B,CAA6BtD,IAAI,CAAChC,IAAlC,CAAwCgC,IAAI,CAACuD,YAA7C,EACH,CACD,MAAO,KAAP,CACH,CALD,EAMH,CAED;+CACa,CACT,KAAKtM,gBAAL,CAAwBuG,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKxG,sBAApB,CAAX,CAAxB,CACA,KAAKF,GAAL,CAAS0D,QAAT,CAAkB,KAAKzD,gBAAvB,EACA,KAAKD,GAAL,CAAS4L,MAAT,GAEA;AACA,KAAKjM,KAAL,CAAWgH,OAAX,GACH,CAED;0CACSjG,C,CAAG,CACR,GAAM+G,CAAAA,QAAQ,CAAG,KAAKzH,GAAL,CAAS0H,SAAT,EAAjB,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAIF,QAArB,CAA+BE,CAAC,EAAhC,CAAoC,CAEhC,KAAK3H,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwBiH,CAAxB,CAA2B,QAA3B,CAAqC,KAArC,EACA,KAAK3H,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwBiH,CAAxB,CAA2B,WAA3B,CAAwC,uBAAxC,EACH,CACD,KAAK3H,GAAL,CAAS4L,MAAT,GACA,KAAK1H,QAAL,CAAc,CAAE7C,WAAW,CAAG,KAAhB,CAAd,EACH,CAED;2DACmB,CAEf,KAAKZ,iBAAL,CAAuBC,CAAvB,CAA2B,IAA3B,CACA,KAAKD,iBAAL,CAAuBE,CAAvB,CAA2B,IAA3B,CACA,KAAKC,eAAL,CAAqBF,CAArB,CAAyB,IAAzB,CACA,KAAKE,eAAL,CAAqBD,CAArB,CAAyB,IAAzB,CACA,KAAKE,aAAL,CAAmBH,CAAnB,CAAuB,IAAvB,CACA,KAAKG,aAAL,CAAmBF,CAAnB,CAAuB,IAAvB,CAEA,KAAKX,GAAL,CAASwM,YAAT,GACH,CAED;mDACe,CACX,MAAO,MAAP,CACH,CAED;8CACWC,K,CAAOC,Q,CAAU,CAExB,GAAMC,CAAAA,GAAG,CAAG,0GAAZ,CAEA,KAAK7L,aAAL,CAAqB6L,GAAG,CAACC,IAAJ,CAASH,KAAT,CAArB,CACAC,QAAQ,CAAC,KAAK5L,aAAN,CAAR,CACA,GAAI,CAAC,KAAKA,aAAV,CACI,KAAKgF,WAAL,CAAiB,KAAK1F,aAAtB,CAAqC,KAAKD,aAAL,CAAmB0M,SAAxD,CAAmE,IAAnE,CAAyE,IAAzE,EACP,CAED;wDACgBJ,K,CAAOC,Q,CAAU,CAE7B,GAAMC,CAAAA,GAAG,CAAG,OAAZ,CAEA,KAAK7L,aAAL,CAAqB6L,GAAG,CAACC,IAAJ,CAASH,KAAT,CAArB,CACAC,QAAQ,CAAC,KAAK5L,aAAN,CAAR,CACA,GAAI,CAAC,KAAKA,aAAV,CACI,KAAKgF,WAAL,CAAiB,KAAK1F,aAAtB,CAAqC,KAAKD,aAAL,CAAmB2M,aAAxD,CAAuE,IAAvE,CAA6E,IAA7E,EACP,CAED;gDACYrH,K,CAAOD,O,CAASuH,c,CAAgBC,iB,CAAmB,kBAC3D3N,YAAY,CAAC,CACToG,KAAK,CAAE,oBADE,CAETD,OAAO,CAAEA,OAFA,CAGTyH,aAAa,CAAE,KAHN,CAITC,mBAAmB,CAAE,KAJZ,CAKTC,QAAQ,CAAE,wBAAiB,IAAdC,CAAAA,OAAc,OAAdA,OAAc,CAEvB,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACtB,GAAIN,cAAJ,CAAoB,CAChB,GAAIC,iBAAJ,CAAuB,2BACJ,OAAI,CAACnM,aADD,CACZH,CADY,uBACZA,CADY,CACTC,CADS,uBACTA,CADS,CAEnB,OAAI,CAACX,GAAL,CAAS6L,UAAT,CAAoBnL,CAApB,CAAuBC,CAAvB,EAEA,GAAI,OAAI,CAACX,GAAL,CAASsN,eAAT,KAA+BzE,SAAnC,CAA8C,CAE1C,GAAM0E,CAAAA,mBAAmB,CAAG,OAAI,CAACvN,GAAL,CAASwN,aAAT,CAAuB9M,CAAvB,CAA0BC,CAA1B,CAA5B,CAEA,OAAI,CAACX,GAAL,CAASsN,eAAT,GAA2BG,YAA3B,GACA,OAAI,CAACzN,GAAL,CAASsN,eAAT,GAA2BI,QAA3B,CAAoCH,mBAApC,EACH,CACJ,CACDH,OAAO,GAEV,CAfD,IAeO,CACH,OAAI,CAACvF,UAAL,GACAuF,OAAO,GACV,CACJ,CApBD,CAqBA,mBACI,2BAAK,SAAS,CAAC,MAAf,eACI,2BAAK,SAAS,CAAC,aAAf,EACK3H,KADL,cAGI,8BAAQ,IAAI,CAAC,QAAb,CAAsB,SAAS,CAAC,OAAhC,CACQ,OAAO,CAAE4H,WADjB,CAEQ,aAAW,OAFnB,eAGI,4BAAM,cAAY,MAAlB,SAHJ,CAHJ,CADJ,cAWI,2BAAK,SAAS,CAAC,WAAf,eACI,2BAAK,SAAS,CAAE,uBAAhB,EAA0C7H,OAA1C,CADJ,CAXJ,cAcI,2BAAK,SAAS,CAAC,aAAf,eACI,8BAAQ,SAAS,CAAE,iBAAnB,CAAsC,OAAO,CAAE6H,WAA/C,OADJ,CAdJ,CADJ,CAsBH,CAlDQ,CAAD,CAAZ,CAoDH,CAED;iEACsB,kBAElB;AACA,GAAMM,CAAAA,SAAS,CAAGnH,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAehI,WAAf,CAAX,CAAlB,CAEA;AACA,GAAMkP,CAAAA,cAAc,CAAGD,SAAS,CAAC5M,MAAV,CAAiB,SAACiI,IAAD,CAAU,CAC9CA,IAAI,CAAC6E,OAAL,CAAe7E,IAAI,CAACzI,OAAL,CAAakD,MAA5B,CACA,MAAO,OAAOuF,CAAAA,IAAI,CAACzI,OAAZ,GAAwB,QAA/B,CACH,CAHsB,CAAvB,CAKA;AACA,GAAMuN,CAAAA,IAAI,CAAGH,SAAS,CAACvB,GAAV,CAAc,SAACpD,IAAD,CAAU,CAEjC,MAAOA,CAAAA,IAAI,CAACzI,OAAL,CAAa6L,GAAb,CAAiB,SAAAzL,CAAC,CAAI,CAEzB,OAAI,CAACL,MAAL,CAAY4L,IAAZ,CAAiBvL,CAAC,CAACoN,KAAnB,EAEApN,CAAC,CAACqN,KAAF,CAAUhF,IAAI,CAACgF,KAAf,CAEArN,CAAC,CAACsN,MAAF,CAAW,KAAX,CAAkB;AAElB,GAAI,MAAOtN,CAAAA,CAAC,CAACuN,SAAT,GAAuB,WAA3B,CAAwC,CAEpC,GAAIvN,CAAC,CAACuN,SAAF,GAAgB,aAApB,CAAmC,CAC/BvN,CAAC,CAACuN,SAAF,CAAc,SAACzB,KAAD,CAAQC,QAAR,CAAqB,CAC/B,OAAI,CAACyB,UAAL,CAAgB1B,KAAhB,CAAuBC,QAAvB,EACH,CAFD,CAGH,CAED,GAAI/L,CAAC,CAACuN,SAAF,GAAgB,WAApB,CAAiC,CAC7BvN,CAAC,CAACuN,SAAF,CAAc,SAACzB,KAAD,CAAQC,QAAR,CAAqB,CAC/B,OAAI,CAAC0B,eAAL,CAAqB3B,KAArB,CAA4BC,QAA5B,EACH,CAFD,CAGH,CACJ,CAED,GAAI,MAAO/L,CAAAA,CAAC,CAAC8K,IAAT,GAAkB,WAAtB,CAAmC,CAC/B,GAAI9K,CAAC,CAAC8K,IAAF,GAAW,UAAf,CAA2B,CACvB,OAAI,CAAC4C,WAAL,CAAiB1N,CAAC,CAACqG,IAAnB,EAAyBrE,IAAzB,CAA8B,SAAC2L,IAAD,CAAU,CACpC3N,CAAC,CAAC4N,MAAF,CAAWD,IAAX,CACH,CAFD,EAGH,CACJ,CAED,GAAI,MAAO3N,CAAAA,CAAC,CAAC6N,UAAT,GAAwB,WAA5B,CAAyC,CACrC7N,CAAC,CAAC8N,QAAF,CAAa,OAAI,CAACC,uBAAL,CAA6BC,IAA7B,CAAkC,OAAlC,CAAb,CACA,MAAOhO,CAAAA,CAAC,CAAC6N,UAAT,CACH,CAED,MAAO7N,CAAAA,CAAP,CACH,CArCM,CAAP,CAsCH,CAxCY,CAAb,CAyCAiO,OAAO,CAACnE,GAAR,CAAY,KAAKlK,OAAjB,EAEA;AACAuN,IAAI,CAAC1B,GAAL,CAAS,SAACzL,CAAD,CAAO,CACZiO,OAAO,CAACnE,GAAR,CAAY9J,CAAZ,EACA,OAAI,CAACJ,OAAL,8BAAmB,OAAI,CAACA,OAAxB,qBAAoCI,CAApC,GACH,CAHD,EAOA;AACA,KAAKN,aAAL,CAAmB6L,IAAnB,CAAwB0B,cAAxB,EACA,KAAKvN,aAAL,CAAmB6L,IAAnB,CAAwB,KAAK5L,MAA7B,EAEAsO,OAAO,CAACnE,GAAR,CAAY,KAAKpK,aAAjB,EACAuO,OAAO,CAACnE,GAAR,CAAY,KAAKlK,OAAjB,EACH,CAED;sDACe2K,G,CAAK2D,E,CAAI,CAEpB,GAAMC,CAAAA,EAAE,CAAGD,EAAE,CAACE,UAAd,CACA,GAAMC,CAAAA,KAAK,CAAGF,EAAE,CAACC,UAAjB,CAEA,GAAME,CAAAA,CAAC,CAAGD,KAAK,CAACE,UAAN,CAAiBzL,MAA3B,CACA,GAAM0L,CAAAA,CAAC,CAAG7K,KAAK,CAAC8K,SAAN,CAAgB5D,OAAhB,CAAwB6D,IAAxB,CAA6BL,KAAK,CAACE,UAAnC,CAA+CJ,EAA/C,CAAV,CACA,GAAMQ,CAAAA,WAAW,CAAI,CAAC,CAAF,CAAOL,CAAP,CAAWE,CAA/B,CAEA,QAASI,CAAAA,UAAT,CAAoBC,IAApB,CAA0BC,SAA1B,CAAqC,CACjC,GAAI,CAAChR,YAAY,CAACiR,GAAb,CAAiBC,QAAjB,CAA0BH,IAA1B,CAAgCC,SAAhC,CAAL,CACIhR,YAAY,CAACiR,GAAb,CAAiBE,QAAjB,CAA0BJ,IAA1B,CAAgCC,SAAhC,EACP,CAED,GAAIH,WAAW,GAAK,CAAC,CAAjB,EAAsBA,WAAW,GAAK,CAAC,CAA3C,CAA8C,CAE1C,GAAIpE,GAAG,GAAI,MAAK3K,OAAhB,CAAyB,IAEdyN,CAAAA,KAFc,CAEL,KAAKzN,OAAL,CAAa2K,GAAb,CAFK,CAEd8C,KAFc,CAGrB,GAAIA,KAAJ,CAAWuB,UAAU,CAACV,EAAD,CAAKb,KAAL,CAAV,CACd,CACJ,CACJ,CAED;gDACYzH,I,CAAM,kBACd,MAAO,IAAIvC,CAAAA,OAAJ,CAAa,SAAC+D,GAAD,CAAMC,GAAN,CAAc,CAE9B,GAAMyE,CAAAA,KAAK,WAAMlG,IAAN,kBAAX,CACA,GAAMsJ,CAAAA,GAAG,WAAMtJ,IAAN,YAAT,CAEA,OAAI,CAAC1G,OAAL,CAAa6C,OAAb,CAAqB,aAArB,CAAoC,CAChCH,KAAK,CAAE,OAAI,CAAC5C,KAAL,CAAW4C,KADc,CAEhCuN,YAAY,CAAED,GAFkB,CAApC,EAIGlN,IAJH,CAIQ,SAACC,QAAD,CAAc,CAElB,GAAIA,QAAQ,CAACmN,QAAT,CAAkBtM,MAAlB,CAA2B,CAA/B,CAAkC,CAC7B,GAAM6K,CAAAA,IAAI,CAAG1L,QAAQ,CAACmN,QAAT,CAAkB3D,GAAlB,CAAsB,SAACpD,IAAD,CAAU,CAC1C,MAAOA,CAAAA,IAAI,CAACyD,KAAD,CAAX,CACH,CAFa,CAAb,CAGD1E,GAAG,CAACuG,IAAD,CAAH,CACH,CACJ,CAZD,EAYGxK,KAZH,CAYS,SAACkM,KAAD,CAAW,CAChBpB,OAAO,CAACnE,GAAR,CAAYuF,KAAZ,EACH,CAdD,EAeH,CApBM,CAAP,CAqBH,CAED;2EAC2B,CACvB,MAAOtR,CAAAA,WAAW,CAACoK,MAAZ,CAAmB,SAACmH,OAAD,CAAUjH,IAAV,CAAmB,CACzC,GAAM8E,CAAAA,IAAI,CAAG9E,IAAI,CAACzI,OAAL,CAAauI,MAAb,CAAoB,SAACoH,GAAD,CAAMhF,GAAN,CAAc,CAC3C,GAAIA,GAAG,CAACiF,SAAR,CAAmBD,GAAG,CAAChE,IAAJ,CAAShB,GAAG,CAAClE,IAAb,EACnB,MAAOkJ,CAAAA,GAAP,CACH,CAHY,CAGV,EAHU,CAAb,CAIA,mCAAWD,OAAX,qBAAuBnC,IAAvB,GACH,CANM,CAMJ,EANI,CAAP,CAOH,CAED;oDACc7B,Q,CAAU,CACpB,MAAOtN,CAAAA,WAAW,CAACyR,IAAZ,CAAiB,SAACpH,IAAD,CAAU,CAC9B,MAAOA,CAAAA,IAAI,CAACqH,EAAL,GAAYpE,QAAnB,CACH,CAFM,CAAP,CAGH,CAED;mIACmBvL,C,CAAGC,C,CAAG2P,I,6OAErB,KAAKzP,aAAL,CAAmBH,CAAnB,CAAuBA,CAAvB,CACA,KAAKG,aAAL,CAAmBF,CAAnB,CAAuBA,CAAvB,CAEM4P,U,CAAa,KAAKzL,aAAL,CAAmBnE,CAAnB,C,CACnB,GAAI4P,UAAJ,CAAgB,CACLC,YADK,CACwED,UADxE,CACLC,YADK,CACSC,KADT,CACwEF,UADxE,CACSE,KADT,CACgBC,YADhB,CACwEH,UADxE,CACgBG,YADhB,CAC8BC,SAD9B,CACwEJ,UADxE,CAC8BI,SAD9B,CACyCC,gBADzC,CACwEL,UADxE,CACyCK,gBADzC,CAC2DC,SAD3D,CACwEN,UADxE,CAC2DM,SAD3D,CAGZ,GAAIL,YAAJ,CAAkB,CACd;AAEA;AACIxK,GAJU,kBAKVzD,KAAK,CAAE,KAAK5C,KAAL,CAAW4C,KALR,EAMToO,SANS,CAMG,KAAK3Q,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6BC,CAA7B,CANH,EASd,GAAI,MAAOiQ,CAAAA,gBAAP,GAA4B,WAA5B,EACA,MAAOA,CAAAA,gBAAP,GAA4B,QADhC,CAC0C,CAEtC;AACME,aAHgC,CAGhBF,gBAAgB,CAACxE,GAAjB,CAAqB,SAAChB,IAAD,CAAU,CACjD,0BAASA,IAAT,CAAgB,OAAI,CAACpL,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6B0K,IAA7B,CAAhB,EACH,CAFqB,CAHgB,CAOtC;AACApF,GAAG,CAAGkD,MAAM,CAACC,MAAP,OAAAD,MAAM,EAAQ,EAAR,CAAYlD,GAAZ,4BAAoB8K,aAApB,GAAZ,CACH,CAED;AACA;AACA,KAAKjR,OAAL,CAAa6C,OAAb,CAAqB8N,YAArB,CAAmCxK,GAAnC,EAAwCrD,IAAxC,CAA6C,SAACC,QAAD,CAAc,CAEvD,GAAI,MAAOA,CAAAA,QAAQ,CAACsF,OAAhB,GAA4B,WAAhC,CAA6C,CAEzC,GAAI,CAACtF,QAAQ,CAACsF,OAAd,CAAuB,CACnB;AAEA;AACA,GAAM8E,CAAAA,iBAAiB,CAAG,OAAI,CAAChM,gBAAL,CAAsBqE,QAAtB,CAA+B1E,CAA/B,CAA1B,CACA;AACA,OAAI,CAACmF,WAAL,CAAiB,OAAI,CAAC1F,aAAtB,CAAqC,OAAI,CAACD,aAAL,CAAmBQ,CAAnB,CAArC,CAA4D,IAA5D,CAAkEqM,iBAAlE,EAEA,OAAI,CAAClM,aAAL,CAAqB,KAArB,CAA4B;AAC5B,MAAO,MAAP,CAEH,CAXD,IAWO,CACH;AACA,GAAI4P,YAAY,EAAIA,YAAY,CAACjN,MAAb,CAAsB,CAA1C,CAA6C,CACzCiN,YAAY,CAACtE,GAAb,CAAiB,SAAAzM,KAAK,CAAI,IAEfoR,CAAAA,MAFe,CAELpR,KAFK,CAEfoR,MAFe,CAGtB,GAAM/J,CAAAA,IAAI,CAAG,OAAI,CAAChH,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6BqQ,MAA7B,CAAb,CAEA,OAAI,CAACC,YAAL,CAAkBtQ,CAAlB,CAAqBqQ,MAArB,CAA6B/J,IAA7B,EACH,CAND,EAOH,CACD,OAAI,CAAClG,aAAL,CAAqB,IAArB,CAA2B;AAC9B,CAED,GAAI+P,SAAS,EAAIA,SAAS,CAACpN,MAAV,CAAmB,CAApC,CAAuC,CACnC,OAAI,CAACwN,eAAL,CAAqBJ,SAArB,CAAgC7K,GAAhC,CAAqCtF,CAArC,EACH,CACJ,CA9BD,IA8BO,CACH+P,KAAK,CAAC,CAAD,CAAL,CAASS,YAAT,CAAwBtO,QAAQ,CAACuO,IAAT,CAAc/E,GAAd,CAAkB,SAAA3H,CAAC,CAAI,CAAC,MAAOA,CAAAA,CAAC,CAACgI,KAAT,CAAe,CAAvC,CAAxB,CACA,OAAI,CAAC2E,WAAL,CAAiB1Q,CAAjB,CAAoB,IAApB,CAA0B+P,KAA1B,EACH,CACJ,CApCD,EAsCH,CA7DD,IA6DO,CACH,KAAKW,WAAL,CAAiB1Q,CAAjB,CAAoB4P,IAApB,CAA0BG,KAA1B,EACH,CACJ,C,8NAGWI,S,CAAW7K,G,CAAKtF,C,CAAG,kBAE/BmQ,SAAS,CAACzE,GAAV,CAAc,SAAApD,IAAI,CAAI,CAClB,GAAIA,IAAI,CAACqI,cAAT,CAAyB,CACrB,OAAI,CAACxR,OAAL,CAAa6C,OAAb,CAAqBsG,IAAI,CAACwH,YAA1B,CAAwCxK,GAAxC,EAA6CrD,IAA7C,CAAkD,SAAAC,QAAQ,CAAI,IAClDY,CAAAA,WADkD,CAClCZ,QADkC,CAClDY,WADkD,CAG1D,GAAIwF,IAAI,CAACsI,YAAL,GAAsB,QAA1B,CAAoC,CAChC,GAAM7E,CAAAA,KAAK,CAAG7J,QAAQ,CAACoG,IAAI,CAACuI,UAAN,CAAtB,CACA,GAAI/N,WAAW,GAAK,SAApB,CAA+B,CAC3B,OAAI,CAAC4N,WAAL,CAAiB1Q,CAAjB,CAAoB+L,KAApB,CAA2BzD,IAAI,CAACyH,KAAhC,EACH,CACJ,CAED,GAAIzH,IAAI,CAACsI,YAAL,GAAsB,QAA1B,CAAoC,CAChC,GAAME,CAAAA,GAAG,CAAG5O,QAAQ,CAACoG,IAAI,CAACuI,UAAN,CAApB,CAEA,GAAMjD,CAAAA,IAAI,CAAGkD,GAAG,CAAC1I,MAAJ,CAAW,SAACoH,GAAD,CAAMzL,CAAN,CAAY,CAChC,mCAAWyL,GAAX,GAAgBzL,CAAC,CAACuE,IAAI,CAACuI,UAAN,CAAjB,GACH,CAFY,CAEV,EAFU,CAAb,CAIA,OAAI,CAACvR,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwB,OAAI,CAACV,GAAL,CAASyR,SAAT,CAAmBzI,IAAI,CAACuI,UAAxB,CAAxB,CAA6D,QAA7D,CAAuEjD,IAAvE,EACA,OAAI,CAACtO,GAAL,CAASsM,gBAAT,CAA0B5L,CAA1B,CAA6BsI,IAAI,CAACuI,UAAlC,CAA8CjD,IAAI,CAAC,CAAD,CAAlD,EACH,CACJ,CApBD,EAqBH,CACJ,CAxBD,EAyBH,C,gDAEW5N,C,CAAG+L,K,CAAOgE,K,CAAO,kBACzB,GAAIA,KAAJ,CAAW,CACPA,KAAK,CAACrE,GAAN,CAAU,SAACpD,IAAD,CAAU,CAChB,GAAIA,IAAI,CAAC0I,WAAL,EAAoBjF,KAAxB,CAA+B,CAC3B,GAAIzD,IAAI,CAAC0I,WAAL,GAAqBjF,KAAzB,CAAgC,CAC5B;AACA,OAAI,CAACzM,GAAL,CAASsM,gBAAT,CAA0B5L,CAA1B,CAA6BsI,IAAI,CAAC2I,SAAlC,CAA6C3I,IAAI,CAACkI,YAAlD,EACH,CACJ,CALD,IAKO,IAAI,CAAClI,IAAI,CAAC0I,WAAN,EAAqBjF,KAAzB,CAAgC,CAEnC,OAAI,CAACzM,GAAL,CAASsM,gBAAT,CAA0B5L,CAA1B,CAA6BsI,IAAI,CAAC2I,SAAlC,CAA6ClF,KAA7C,EAEH,CAJM,IAIA,CACH,OAAI,CAACzM,GAAL,CAAS2L,WAAT,CAAqBjL,CAArB,CAAwB,OAAI,CAACV,GAAL,CAASyR,SAAT,CAAmBzI,IAAI,CAAC2I,SAAxB,CAAxB,CAA4D,QAA5D,CAAsE3I,IAAI,CAACkI,YAA3E,EACH,CACJ,CAbD,EAcH,CACJ,C,mDAEc,mCACwB,KAAKvR,KAD7B,CACJ4C,KADI,cACJA,KADI,CACGC,MADH,cACGA,MADH,CACWC,SADX,cACWA,SADX,CAEX,KAAK9C,KAAL,CAAWsD,UAAX,GAEA,KAAKpD,OAAL,CAAa6C,OAAb,CAAqB,YAArB,CAAmC,CAC/BF,MAAM,CAANA,MAD+B,CAE/BD,KAAK,CAALA,KAF+B,CAG/BE,SAAS,CAATA,SAH+B,CAAnC,EAIGE,IAJH,CAIQ,SAAAC,QAAQ,CAAI,CAChB,GAAMgP,CAAAA,KAAK,CAAG,GAAIC,CAAAA,IAAJ,EAAd,CACA;AAEA,GAAMC,CAAAA,SAAS,CAAG,IAAMF,KAAK,CAACG,WAAN,EAAN,CAA4B,GAA5B,EAAmCH,KAAK,CAACI,QAAN,GAAiB,CAApD,EAAyD,GAAzD,CAA+DJ,KAAK,CAACK,OAAN,EAA/D,CAAiF,GAAjF,CAAuFL,KAAK,CAACM,QAAN,EAAvF,CAA0G,GAA1G,CAAgHN,KAAK,CAACO,UAAN,EAAlI,CAEA,GAAMC,CAAAA,EAAE,CAAG9S,IAAI,CAAC+S,KAAL,CAAWC,aAAX,CAAyB1P,QAAQ,CAAC2P,mBAAlC,CAAX,CACA,GAAMC,CAAAA,EAAE,CAAG,CAAEC,MAAM,CAAE,CAAE,OAAQL,EAAV,CAAV,CAA0BM,UAAU,CAAE,CAAC,MAAD,CAAtC,CAAX,CACA,GAAMC,CAAAA,WAAW,CAAGrT,IAAI,CAACsT,KAAL,CAAWJ,EAAX,CAAe,CAAEK,QAAQ,CAAE,MAAZ,CAAoBpH,IAAI,CAAE,OAA1B,CAAf,CAApB,CACA,GAAMzE,CAAAA,IAAI,CAAG,GAAI8L,CAAAA,IAAJ,CAAS,CAACH,WAAD,CAAT,CAAwB,CAAClH,IAAI,CAAE,MAAP,CAAxB,CAAb,CAED;AACClM,MAAM,CAACyH,IAAD,2BAA0B8K,SAA1B,UAAN,CACA,OAAI,CAACnS,KAAL,CAAWsD,UAAX,GAEH,CAnBD,EAmBGa,KAnBH,CAmBS,SAACkM,KAAD,CAAW,CAChBpB,OAAO,CAACnE,GAAR,CAAYuF,KAAZ,EACA,OAAI,CAACrQ,KAAL,CAAWsD,UAAX,GAEH,CAvBD,EAwBH,C,yDAEiB,qBAEPvC,CAAAA,CAFO,CAEF,KAAKD,iBAFH,CAEPC,CAFO,CAGd,GAAIA,CAAC,GAAK,IAAV,CAAgB,OAEhB,GAAI,KAAKqF,kBAAL,CAAwBrF,CAAxB,CAA2B,MAA3B,CAAJ,CAAwC,CACpC,GAAMsF,CAAAA,GAAG,CAAG,KAAKC,0BAAL,CAAgCvF,CAAhC,CAAmC,IAAnC,CAAZ,CAEA,KAAKb,OAAL,CAAa6C,OAAb,CAAqB,MAArB,CAA6BsD,GAA7B,EAAkCrD,IAAlC,CAAuC,SAAAC,QAAQ,CAAI,CAC/C,OAAI,CAACiE,2BAAL,CAAiC,IAAjC,CAAuCjE,QAAQ,CAACuD,UAAhD,EACA,OAAI,CAAC/D,QAAL,GACH,CAHD,EAIH,CACJ,C,6DAEmB,qBACT1B,CAAAA,CADS,CACJ,KAAKD,iBADD,CACTC,CADS,CAEhB,GAAIA,CAAC,GAAK,IAAV,CAAgB,OAEhB,GAAI,KAAKqF,kBAAL,CAAwBrF,CAAxB,CAA2B,MAA3B,CAAJ,CAAwC,CACpC,GAAMsF,CAAAA,GAAG,CAAG,KAAKC,0BAAL,CAAgCvF,CAAhC,CAAmC,IAAnC,CAAZ,CAEA,KAAKb,OAAL,CAAa6C,OAAb,CAAqB,QAArB,CAA+BsD,GAA/B,EAAoCrD,IAApC,CAAyC,SAAAC,QAAQ,CAAI,CACjD,OAAI,CAACiE,2BAAL,CAAiC,KAAjC,CAAwCjE,QAAQ,CAACmQ,YAAjD,EACA,OAAI,CAAC3Q,QAAL,GACH,CAHD,EAIH,CACJ,C,8EAE0B1B,C,CAAGsS,U,CAAY,IAC/BzQ,CAAAA,KAD+B,CACtB,KAAK5C,KADiB,CAC/B4C,KAD+B,CAGtC;AACA,GAAMyE,CAAAA,IAAI,CAAG,KAAKhH,GAAL,CAASiH,YAAT,CAAsBvG,CAAtB,CAAb,CACA,GAAMyG,CAAAA,oBAAoB,CAAG,KAAKC,iBAAL,CAAuB,CAAvB,CAAyB,WAAzB,CAA7B,CACA,GAAM6L,CAAAA,yBAAyB,CAAG,KAAK7L,iBAAL,CAAuB,CAAvB,CAAyB,gBAAzB,CAAlC,CAEA,GAAM3E,CAAAA,SAAS,CAAGuE,IAAI,CAACG,oBAAD,CAAJ,CAA2B9D,QAA3B,EAAlB,CACA,GAAM6P,CAAAA,cAAc,CAAGlM,IAAI,CAACiM,yBAAD,CAAJ,CAAgC5P,QAAhC,EAAvB,CAEA,MAAO,CACHd,KAAK,CAALA,KADG,CAEHE,SAAS,CAATA,SAFG,CAGHyQ,cAAc,CAAdA,cAHG,CAIHF,UAAU,CAAVA,UAJG,CAAP,CAMH,C,gFAE2BG,c,CAAgB5I,M,CAAQ,0BAEP,KAAK5K,KAAL,CAAW4F,QAFJ,CAEzC6N,aAFyC,sBAEzCA,aAFyC,CAE1BC,eAF0B,sBAE1BA,eAF0B,CAIhD,GAAM5N,CAAAA,KAAK,CAAG0N,cAAc,CAAGC,aAAa,CAAC3N,KAAjB,CAAyB4N,eAAe,CAAC5N,KAArE,CACA,GAAID,CAAAA,OAAO,CAAG2N,cAAc,CAAGC,aAAa,CAAC7I,MAAM,CAAC+I,IAAP,CAAYjQ,QAAZ,EAAD,CAAhB,CAA2CgQ,eAAe,CAAC9I,MAAM,CAAC+I,IAAP,CAAYjQ,QAAZ,EAAD,CAAtF,CAEAmC,OAAO,CAAGA,OAAO,CACXA,OAAO,CAACsE,OAAR,CAAgB,SAAhB,CAA2BS,MAAM,CAACjE,KAAlC,EAAyCwD,OAAzC,CAAiD,QAAjD,CAA2D,GAAI+H,CAAAA,IAAJ,CAAStH,MAAM,CAACgJ,IAAhB,EAAsBC,cAAtB,EAA3D,CADW,CAEX,WAFN,CAIA,KAAK1T,KAAL,CAAWgG,WAAX,CAAuB,MAAvB,CAA+BL,KAA/B,CAAsCD,OAAtC,CAA+C,KAA/C,EACH,C,wEAEuBiO,Q,CAAUC,E,CAAIpJ,G,CAAKY,G,CAAKE,I,CAAMqB,K,CAAO,IAElDlH,CAAAA,QAFkD,CAEtC,KAAK5F,KAFiC,CAElD4F,QAFkD,CAIzD,OAAQkH,KAAR,EACI,IAAK,qBAAL,CAA6B,CACzB,GAAMjH,CAAAA,OAAO,CAAGD,QAAQ,CAACoO,kBAAT,CAA4BC,mBAA5C,CACAF,EAAE,CAACG,SAAH,CAAe,4DAA4DrO,OAA5D,CAAoE,MAAnF,CACH,CAAC,MAEF,IAAK,mBAAL,CAA2B,CACvB,GAAMA,CAAAA,QAAO,CAAGD,QAAQ,CAACoO,kBAAT,CAA4BG,iBAA5C,CACAJ,EAAE,CAACG,SAAH,CAAe,sCAAsCrO,QAAtC,CAA8C,IAA9C,CACX,uCADW,CAEX,kCAFW,CAGX,WAHJ,CAIH,CAAC,MAEF,QAAS,CACL,GAAMA,CAAAA,SAAO,CAAGD,QAAQ,CAACoO,kBAAT,CAA4BI,UAA5C,CACAL,EAAE,CAACG,SAAH,CAAe,kDAAkDrO,SAAlD,CAA0D,MAAzE,CACH,CAAC,MAjBN,CAoBAkO,EAAE,CAACM,SAAH,CAAaC,GAAb,CAAiB,aAAjB,EACA,MAAOP,CAAAA,EAAP,CACH,C,oEAEqBQ,S,CAAWC,S,CAAWC,W,CAAa,CACrD,MAAOD,CAAAA,SAAS,CAAC/S,gBAAV,GAA+B,KAAKD,KAAL,CAAWC,gBAA1C,EACH+S,SAAS,CAAC7S,UAAV,GAAyB,KAAKH,KAAL,CAAWG,UADjC,EAEH6S,SAAS,CAACxS,gBAAV,GAA+B,KAAKR,KAAL,CAAWQ,gBAFvC,EAGHwS,SAAS,CAAC9S,WAAV,GAA0B,KAAKF,KAAL,CAAWE,WAHlC,EAIH8S,SAAS,CAACE,QAAV,GAAuB,KAAK1U,KAAL,CAAW0U,QAJtC,CAKH,C,uCAEQ,mCACkD,KAAK1U,KADvD,CACE0U,QADF,cACEA,QADF,CACY9O,QADZ,cACYA,QADZ,CACsB+O,UADtB,cACsBA,UADtB,CACkCxJ,YADlC,cACkCA,YADlC,CAGL,GAAIvF,QAAJ,CAAc,CACV,KAAKnF,aAAL,CAAqBmF,QAAQ,CAACyE,yBAA9B,CACA,KAAK7J,aAAL,CAAqBoF,QAAQ,CAACgP,uBAA9B,CACH,CAED,mBACI,qDACI,oBAAC,MAAD,MADJ,cAEI,oBAAC,GAAD,EAAK,SAAS,CAAC,OAAf,eACI,oBAAC,OAAD,EAAS,QAAQ,CAAEF,QAAnB,EADJ,cAEI,oBAAC,GAAD,EAAK,SAAS,CAAEC,UAAhB,eACI,oBAAC,OAAD,EACI,OAAO,CAAE,cADb,CAEI,WAAW,CAAE,KAAKnT,KAAL,CAAWC,gBAF5B,CAGI,WAAW,CAAE,KAAKD,KAAL,CAAWE,WAH5B,CAII,MAAM,CAAE,KAAKmT,YAAL,CAAkB7F,IAAlB,CAAuB,IAAvB,CAJZ,CAKI,IAAI,CAAE,KAAK8F,eAAL,CAAqB9F,IAArB,CAA0B,IAA1B,CALV,CAMI,MAAM,CAAE,KAAK+F,iBAAL,CAAuB/F,IAAvB,CAA4B,IAA5B,CANZ,CAOI,GAAG,CAAE,KAAKzH,iBAAL,CAAuByH,IAAvB,CAA4B,IAA5B,CAPT,CAQI,SAAS,CAAE,KAAKgG,uBAAL,CAA6BhG,IAA7B,CAAkC,IAAlC,CARf,CASI,IAAI,CAAE,KAAKiG,eAAL,CAAqBjG,IAArB,CAA0B,IAA1B,CATV,CAUI,MAAM,CAAE,KAAKkG,iBAAL,CAAuBlG,IAAvB,CAA4B,IAA5B,CAVZ,CAWI,IAAI,CAAE,KAAKmG,eAAL,CAAqBnG,IAArB,CAA0B,IAA1B,CAXV,CAYI,eAAc,KAAKoG,sBAAL,CAA4BpG,IAA5B,CAAiC,IAAjC,CAZlB,CAaI,QAAQ,CAAE,KAAK9K,iBAAL,CAAuB8K,IAAvB,CAA4B,IAA5B,CAbd,CAcI,kBAAkB,CAAE,KAAKvM,QAAL,CAAcuM,IAAd,CAAmB,IAAnB,CAdxB,CAeI,qBAAqB,CAAE,KAAKvM,QAAL,CAAcuM,IAAd,CAAmB,IAAnB,CAf3B,EADJ,cAmBI,oBAAC,IAAD,EAAM,SAAS,CAAE,gBAAjB,eACI,oBAAC,QAAD,mBACI,oBAAC,QAAD,EAAU,GAAG,CAAE,KAAK5O,iBAApB,CAAuC,EAAE,CAAE,KAA3C,CACE,UAAU,CAAE,+BADd,CAEE,aAAa,CAAE,KAAKM,aAFtB,CAGE,OAAO,CAAE,KAAKE,OAHhB,CAIE,QAAQ,CAAE,KAJZ,CAKE,YAAY,CAAE,IALhB,CAME,OAAO,CAAE,IANX,CAOE,kBAAkB,CAAE,IAPtB,CAQE,KAAK,CAAE,MART,CASE,MAAM,CAAE,MATV,CAUE,gBAAgB,CAAE,CAVpB,CAWE,aAAa,CAAE,IAXjB,CAYE,mBAAmB,CAAE,CAAC,YAAD,CAAe,YAAf,CAZvB,CAaE,kBAAkB,CAAE,KAbtB,CAcE,qBAAqB,CAAE,KAdzB,CAeE,UAAU,CAAE,KAAKyU,YAAL,EAfd,CAgBE,UAAU,CAAE,KAAKA,YAAL,EAhBd,CAiBE,iBAAiB,CAAE,2BAACtU,CAAD,CAAIC,CAAJ,CAAU,CACzB,OAAI,CAACF,iBAAL,CAAuBC,CAAvB,CAA2BA,CAA3B,CACA,OAAI,CAACD,iBAAL,CAAuBE,CAAvB,CAA2BA,CAA3B,CACH,CApBH,CAqBE,aAAa,CAAE,uBAACsU,OAAD,CAAUxI,KAAV,CAAiBnC,GAAjB,CAAsBc,IAAtB,CAA+B,CAC1C;AACA,OAAI,CAACvK,aAAL,CAAmBH,CAAnB,CAAuB4J,GAAvB,CACA,OAAI,CAACzJ,aAAL,CAAmBF,CAAnB,CAAuByK,IAAvB,CACH,CAzBH,CA0BE,iBAAiB,CAAE,2BAACF,GAAD,CAAM2D,EAAN,CAAa,CAC5B,OAAI,CAACqG,cAAL,CAAoBhK,GAApB,CAAyB2D,EAAzB,EACH,CA5BH,CA6BE,cAAc,CAAE,wBAAC5F,KAAD,CAAQkM,MAAR,CAAgB5G,MAAhB,CAA2B,CACvC;AACH,CA/BH,CAgCE,aAAa,CAAE,uBAACmF,EAAD,CAAKhT,CAAL,CAAW,CACtB,GAAIoK,YAAJ,CAAkB,CACd,GAAMsK,CAAAA,CAAC,CAAG,OAAI,CAACpV,GAAL,CAASiF,gBAAT,CAA0BvE,CAA1B,CAA6B,UAA7B,CAAV,CACA,GAAI,CAAC,KAAD,CAAQ,KAAR,CAAe,KAAf,EAAsB2E,QAAtB,CAA+B+P,CAA/B,CAAJ,CAAuC,CACnC1B,EAAE,CAACM,SAAH,CAAaC,GAAb,CAAiB,cAAjB,EACH,CACJ,CACJ,CAvCH,CAwCE,WAAW,CAAE,qBAACoB,OAAD,CAAa,CACtB;AACA,GAAIA,OAAJ,CAAa,8BACkBA,OAAO,CAAC,CAAD,CADzB,IACF3U,CADE,cACCC,CADD,cACI2U,IADJ,cACUhF,IADV,cAET;AACA;AACA;AACA,GAAIgF,IAAI,GAAKhF,IAAT,EAAiB,CAAC,OAAI,CAACxP,aAA3B,CACE,OAAI,CAACkQ,YAAL,CAAkBtQ,CAAlB,CAAqBC,CAArB,CAAwB2P,IAAxB,EACL,CACJ,CAlDH,EADJ,CAsDK,CAAC,KAAKnP,KAAL,CAAWC,gBAAZ,eACG,oBAAC,YAAD,EAAc,IAAI,CAAE,QAApB,EAvDR,CADJ,CAnBJ,CAFJ,CAFJ,cA+FI,oBAAC,WAAD,EAAa,eAAe,CAAE,KAAKgB,QAAL,CAAcuM,IAAd,CAAmB,IAAnB,CAA9B,EA/FJ,cAgGI,oBAAC,OAAD,MAhGJ,CADJ,CAoGH,C,oBA3tCgB3Q,KAAK,CAACuX,S,EA8tC3B,QAASC,CAAAA,eAAT,CAAyBrU,KAAzB,CAAgC,CAC5B,MAAO,CACHoB,KAAK,CAAEpB,KAAK,CAACoB,KADV,CAEHV,IAAI,CAAEV,KAAK,CAACU,IAFT,CAGH0D,QAAQ,CAAEpE,KAAK,CAACoE,QAHb,CAIH8O,QAAQ,CAAElT,KAAK,CAACkT,QAJb,CAKHC,UAAU,CAAEnT,KAAK,CAACmT,UALf,CAMH9R,MAAM,CAAErB,KAAK,CAACqB,MANX,CAOHC,SAAS,CAAEtB,KAAK,CAACsB,SAPd,CAQHrD,aAAa,CAAE+B,KAAK,CAAC/B,aARlB,CASH0L,YAAY,CAAE3J,KAAK,CAAC2J,YATjB,CAAP,CAWH,CAED,QAAS2K,CAAAA,kBAAT,CAA4BC,QAA5B,CAAsC,CAClC,MAAO,CACH/O,OAAO,CAAE,yBAAM+O,CAAAA,QAAQ,CAACvW,YAAY,EAAb,CAAd,EADN,CAEH8D,UAAU,CAAE,4BAAMyS,CAAAA,QAAQ,CAACtW,aAAa,EAAd,CAAd,EAFT,CAAP,CAKH,CAED,cAAelB,CAAAA,OAAO,CAACsX,eAAD,CAAkBC,kBAAlB,CAAP,CAA6C/V,MAA7C,CAAf","sourcesContent":["import React, {createRef} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport {Row, Col, Card, CardBody, CardFooter} from 'reactstrap';\r\n\r\nimport {HotTable} from '@handsontable/react';\r\nimport Handsontable from 'handsontable';\r\nimport {groupingMap} from '../matrixDataMap';\r\nimport {columnLogic} from '../matrixColumnLogicMap';\r\n\r\nimport PaginationMatrix from \"../components/Pagination\"\r\n\r\nimport Header from '../components/Header';\r\nimport Sidebar from '../components/Sidebar';\r\nimport Toolbar from '../components/ToolbarMatrix';\r\nimport ModalImport from '../components/ModalImport';\r\nimport Spinner from '../components/Spinner';\r\nimport EmptyDataset from '../components/EmptyDataset';\r\n\r\nimport {editOnToggle, spinnerToggle} from \"../redux/actions\";\r\n\r\nimport { confirmAlert } from 'react-confirm-alert';\r\nimport 'react-confirm-alert/src/react-confirm-alert.css';\r\n\r\n// For export File\r\nimport XLSX from 'xlsx'\r\nimport {saveAs} from 'file-saver';\r\n\r\n// Rest api module import\r\nimport RestApiModule from '../RestApiModule'\r\n\r\n// Alert module\r\nimport AlertModule from '../AlertModule'\r\n\r\nclass Matrix extends React.Component {\r\n    _isMounted = false;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.restApi = new RestApiModule();\r\n        this.alert = new AlertModule();\r\n\r\n        this.hotTableComponent = createRef();\r\n        this.hot = null;\r\n        this.handsontableData = null;\r\n        this.handsontableDataBackup = null;\r\n\r\n        this.errorMessages = null;\r\n        this.errorBoxTitle = null;\r\n        this.columnHeaders = [];\r\n        this.titles = [];\r\n        this.columns = [];\r\n        this.handleColumnHeaders();\r\n\r\n        this.selectedRowCoords = {r: null, c: null};\r\n        this.editedRowCoords = {r: null, c: null};\r\n        this.validatedCell = {r: null, c: null};\r\n        this.rowValidation = true;\r\n        this.filter = null;\r\n        this.mandatoryColumns = null;\r\n        this.isDuplicate = false;\r\n        this.submitProcessFail = false;\r\n\r\n\r\n        //this.itemPerPage = +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE;\r\n        this.state = {\r\n            isDataExistsInDB: false,\r\n            newRowAdded: false,\r\n            activePage: 1,\r\n            itemPerPage: +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE,\r\n            totalCountOfData: 0,\r\n            exportDataAsExcelFile: null\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        this._isMounted = true;\r\n\r\n        if (this.props.user) {\r\n\r\n            // get mandatory columns from map file\r\n            this.mandatoryColumns = this.mandatoryColumnExtractor();\r\n\r\n            this.setStateAsync({permittedColumns: this.props.user.role.permittedColumns});\r\n            this.hot = this.hotTableComponent.current.hotInstance;\r\n\r\n            this.dataLoad();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this._isMounted = false;\r\n    }\r\n\r\n    calculatePagination(total) {\r\n\r\n        if (total) {\r\n            const pageCount = +total / this.state.itemPerPage;\r\n            this.setStateAsync({totalCountOfData: total, pageCount})\r\n        }\r\n    }\r\n\r\n    dataCountOfSelectedRegion() {\r\n\r\n        const {token, region, radioSite} = this.props;\r\n\r\n        if (region) {\r\n            this.restApi.callApi('getMatrixDataCount', {\r\n                token,\r\n                region,\r\n                radioSite\r\n            }).then(response => {\r\n                this.calculatePagination(response.ConnectivityCount[0].Count)\r\n            })\r\n        }\r\n    }\r\n\r\n    async dataLoad(filterChanged) {\r\n\r\n        if (this._isMounted) {\r\n            const {token, region, radioSite} = this.props;\r\n\r\n            // that means filtered options changed, so we reset the activePage number to 1\r\n            if (filterChanged) {\r\n\r\n                this.setStateAsync({\r\n                    activePage: 1,\r\n                    itemPerPage: (filterChanged === \"radioSite\") ? 100 : +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE\r\n                });\r\n            }\r\n\r\n            if (region) {\r\n                this.props.setSpinner();\r\n\r\n                // get count of data\r\n                await this.dataCountOfSelectedRegion()\r\n\r\n                //reset selected row data\r\n                this.resetSelectedRow()\r\n\r\n                this.restApi.callApi('getMatrixData', {\r\n                    token,\r\n                    region,\r\n                    radioSite,\r\n                    count: this.state.itemPerPage.toString(),\r\n                    page_index: this.state.activePage.toString()\r\n                }).then(async (response) => {\r\n                    //console.log(response)\r\n\r\n                    // mock test\r\n                    //response.exec_status = \"error\";\r\n\r\n                    const {ConnectivityMatrix, exec_status} = response;\r\n\r\n                    // If data doesnt exist in EAI DB we should set a flag to manage toolbar actions\r\n                    if (exec_status === \"success\" &&\r\n                        ConnectivityMatrix.length > 0) {\r\n\r\n                        this.setStateAsync({isDataExistsInDB: true});\r\n\r\n                        this.handsontableData = ConnectivityMatrix; // store the copy of data\r\n                        this.hot.loadData(this.handsontableData);\r\n\r\n                        this.paginationRowNumbers();\r\n\r\n                        /* Filter for show active rows only*/\r\n                        this.filter = this.hot.getPlugin('filters');\r\n\r\n                        await this.revisionRowFilter();\r\n\r\n                    } else {\r\n\r\n                        this.setStateAsync({isDataExistsInDB: false});\r\n                    }\r\n\r\n                    // remove spinner from screen\r\n                    this.props.setSpinner();\r\n\r\n                }).catch(err => {\r\n                    // err state. If need we can give message to user.\r\n                    // Error handling is managed by RestApiModule.\r\n                    // We don't need to do extra development in here\r\n\r\n                    // Somehow if this block executed, we can only change the flag to false.\r\n                    this.setStateAsync({isDataExistsInDB: false});\r\n\r\n                    // remove spinner from screen\r\n                    this.props.setSpinner();\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    setStateAsync(state) {\r\n        return new Promise((resolve) => {\r\n            this.setState(state, resolve)\r\n        });\r\n    }\r\n\r\n    async handlePageChange(pageNumber) {\r\n        //console.log(pageNumber);\r\n        // TODO: call api to retrieve data for matrix page\r\n        // data will provided by page number\r\n        await this.setStateAsync({activePage: pageNumber});\r\n        this.dataLoad();\r\n    }\r\n\r\n    paginationRowNumbers() {\r\n        // break the handsontable row headers mechanism to show to user exact row numbers while paginating\r\n        const {activePage, itemPerPage} = this.state;\r\n\r\n        const startPoint =((activePage - 1) * itemPerPage) + 1;\r\n        const newNumbers = Array.from(Array(itemPerPage), (_, i) => startPoint + i)\r\n\r\n        this.hot.updateSettings({\r\n            rowHeaders: newNumbers\r\n        })\r\n    }\r\n\r\n    isRowCanBeEditable(r, restriction) {\r\n\r\n        const etatRule = this.ruleExtractor(\"etatCheckValue\");\r\n        const archivedRule = this.ruleExtractor(\"archivedCheckValue\");\r\n        const etatDataAtCell = this.hot.getDataAtRowProp(r, \"etat\");\r\n        const archivedDataAtCell = this.hot.getDataAtRowProp(r, \"archived\");\r\n\r\n        const checkEtatValue = etatRule.isValue.includes(etatDataAtCell)\r\n        const checkArchivedValue = archivedRule.isValue.includes(archivedDataAtCell)\r\n\r\n        const response = (checkEtatValue && checkArchivedValue);\r\n\r\n        if (!response) {\r\n            const {language} = this.props;\r\n            let message, title = \"\";\r\n\r\n            switch (restriction) {\r\n                case 'Lock' : title = language.lockModeRestrictionTitle; message = language.lockModeRestriction; break;\r\n                case 'Edit' :\r\n                default : title = language.editModeRestrictionTitle; message = language.editModeRestriction; break;\r\n            }\r\n            this.alert.showMessage(\"warning\", title, message, false);\r\n        }\r\n\r\n        return response;\r\n    }\r\n\r\n    // click event handle for edit button\r\n    handleEditClick() {\r\n\r\n        const {r, c} = this.selectedRowCoords;\r\n        if (r === null && c === null) return;\r\n\r\n        if (this.isRowCanBeEditable(r)) {\r\n\r\n            // Lock mechanism controls\r\n            const dto = this.prepareDTOforLockMechanism(r, false);\r\n\r\n            this.restApi.callApi('lock', dto).then(response => {\r\n                const json = response.resultLock;\r\n                const {user} = this.props;\r\n\r\n                // can I continue to edit ?\r\n                const continueToEdit = json.islock && json.uname === user.name;\r\n\r\n                if (continueToEdit) {\r\n\r\n                    // create backup data before editing;\r\n                    this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData));\r\n\r\n                    // Change edit mode on redux\r\n                    this.props.setEdit();\r\n\r\n                    this.setCellProperties(r, c);\r\n                    this.editedRowCoords.r = r;\r\n                    this.editedRowCoords.c = c;\r\n\r\n                } else {\r\n                    this.showMessageForLockMechanism(true, json)\r\n                }\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n    // click handle for add new row\r\n    async handleNewRowClick() {\r\n\r\n        await this.setStateAsync({newRowAdded : true});\r\n        this.editedRowCoords.r = 0;\r\n        this.editedRowCoords.c = 0;\r\n        this.isDuplicate = false;\r\n\r\n        // create backup data before editing;\r\n        this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData));\r\n\r\n        this.props.setEdit();\r\n        this.hot.alter('insert_row', 0, 1);\r\n        this.setCellProperties(0, null);\r\n\r\n        // set initial value for newly adding rows\r\n        if (this.state.newRowAdded && !this.isDuplicate) {\r\n            this.setInitialValueOfColumn();\r\n        }\r\n    }\r\n\r\n    async handleDuplicateRowClick() {\r\n\r\n        const {r, c} = this.selectedRowCoords;\r\n        if (r === null && c === null) return;\r\n\r\n        // get existing data at row\r\n        const data = this.hot.getDataAtRow(r);\r\n\r\n        this.isDuplicate = true;\r\n        await this.handleNewRowClick();\r\n\r\n        // find radio Site column for special case. we need empty radio site for duplicated row\r\n        const radioSiteColumnIndex = this.findIndexOfColumn(0,'radioSite');\r\n        const lockStatusColumnIndex = this.findIndexOfColumn(0,'LOCK_STATUS');\r\n        const lockUserColumnIndex = this.findIndexOfColumn(0,'USER_NAME');\r\n        const lockTimeColumnIndex = this.findIndexOfColumn(0,'LOCK_TIME');\r\n\r\n        const passThisColumns = [\r\n            radioSiteColumnIndex,\r\n            lockStatusColumnIndex,\r\n            lockUserColumnIndex,\r\n            lockTimeColumnIndex]\r\n\r\n        // get column count for iteration\r\n        const colCount = this.hot.countCols();\r\n\r\n        // iterate the columns\r\n        for (let x = 0; x <= colCount; x++) {\r\n\r\n            // if column is this list, pass it, data will not copy from exist row\r\n            if (x in passThisColumns) continue;\r\n\r\n            // set data\r\n            this.hot.setDataAtCell(0, x, data[x])\r\n        }\r\n    }\r\n\r\n    handleCancelClick() {\r\n\r\n        if (!this.state.newRowAdded) {\r\n\r\n            const {r, c} = this.editedRowCoords;\r\n            if (r === null && c === null) return;\r\n\r\n            // Lock mechanism controls\r\n            const dto = this.prepareDTOforLockMechanism(r, false);\r\n\r\n            // In all circumstances call implicit unlock\r\n            this.restApi.callApi('unlock', dto);\r\n        }\r\n        this.setStateAsync({newRowAdded : false}).then(() => {\r\n            this.cancelEdit();\r\n        });\r\n    }\r\n\r\n    handleSaveClick() {\r\n        this.saveAction();\r\n    }\r\n\r\n    handleSaveHistoryClick() {\r\n        this.saveAction(true)\r\n    }\r\n\r\n    checkIsRadioSiteExists(token, radioSite) {\r\n\r\n        return new Promise((res, rej) => {\r\n\r\n            const {language} = this.props;\r\n\r\n            // if the save action doing on new row add we should check if radio site is exists\r\n            // then we need to show message to the user to continue or not.\r\n            this.restApi.callApi('isRadioSiteExists', {\r\n                token,\r\n                radioSite\r\n            }).then(radioResponse => {\r\n\r\n                if (radioResponse.isExist === true) {\r\n\r\n                    // get confirmation from user to continue\r\n                    this.alert.getConfirmation(\r\n                        \"warning\",\r\n                        language.radioSiteExistsWithSameNameTitle,\r\n                        language.radioSiteExistsWithSameNameText\r\n                    ).then(confirmation => {\r\n                        res({\r\n                            confirmation,\r\n                            isExists: radioResponse.isExist\r\n                        })\r\n                    })\r\n                } else {\r\n                    // if radio site not exist we should return false\r\n                    res({\r\n                        confirmation: null,\r\n                        isExists: radioResponse.isExist\r\n                    })\r\n                }\r\n            }).catch(err => {\r\n                rej(err)\r\n            })\r\n\r\n        })\r\n    }\r\n\r\n    // save action for row edited or new\r\n    saveAction(revision) {\r\n\r\n        const {language, token} = this.props;\r\n        const isRevision = revision ? revision : false;\r\n\r\n        this.restApi.callApi('getImportStatus', {\r\n            token\r\n        }).then(importStatusResponse => {\r\n\r\n            const {isImportOngoing} = importStatusResponse;\r\n            const {r, c} = this.editedRowCoords;\r\n\r\n\r\n            if (!isImportOngoing.isLock) {\r\n                // there isn't an import action ongoing\r\n\r\n                if (this.rowValidation) {\r\n\r\n                    if (r !== null || r !== undefined) {\r\n                        // data would send to API\r\n                        let data = this.hot.getDataAtRow(r);\r\n\r\n                        data = this.columns.reduce((newRowData, item, index) => {\r\n\r\n                            Object.assign(newRowData,\r\n                                (data[index] !== null)\r\n                                    ? {[item.data]: data[index]}\r\n                                    : {[item.data]: \"\"}\r\n                            );\r\n                            return newRowData;\r\n                        }, {});\r\n\r\n                        const mandatoryColumnsFilled = this.checkMandatoryColumnsFilled(data);\r\n\r\n                        if (mandatoryColumnsFilled) {\r\n\r\n                            const { newRowAdded: isNewRow} = this.state;\r\n\r\n                            // radio Site exists check\r\n                            if (isNewRow) {\r\n\r\n                                this.checkIsRadioSiteExists(token, data['radioSite'])\r\n                                    .then(isExistsResponse => {\r\n\r\n                                        const confirm = isExistsResponse.confirmation;\r\n                                        if (confirm || confirm === null){\r\n                                            // it means, user didn't click cancel on messagebox.\r\n                                            // confirm = null means there isnt exist radio site in db\r\n                                            this.saveIt(token, data, isNewRow, isExistsResponse.isExists, r, c)\r\n                                        }\r\n                                });\r\n\r\n                            } else {\r\n\r\n                                this.saveIt(token, data, isNewRow, isRevision, r, c)\r\n                            }\r\n\r\n                        } else {\r\n\r\n                            const title = language.mandatoryDataTitle;\r\n                            let text = language.mandatoryDataText;\r\n\r\n                            text = text.replace(\"{columns}\", this.mandatoryColumns.join(',<br>'));\r\n\r\n                            this.alert.showMessage(\"error\", title, text, false);\r\n                        }\r\n                    }\r\n\r\n                } else {\r\n\r\n                    const {language} = this.props;\r\n                    this.alert.showMessage(\"error\",\r\n                        language.validationMessageBoxTitle,\r\n                        language.validationErrorGeneralMessage,\r\n                        false)\r\n                }\r\n\r\n            } else {\r\n                const message = language.importSection.ongoingImportText.replace('{username}', isImportOngoing.uname);\r\n\r\n                this.alert.showMessage(\r\n                    'warning',\r\n                    language.importSection.ongoingImportTitle,\r\n                    message,\r\n                    false)\r\n\r\n                // import is ongoing we need to reload the data\r\n                this.resetRow(r);\r\n                this.props.setEdit();\r\n                this.dataLoad();\r\n            }\r\n        })\r\n    }\r\n\r\n    saveIt(token, row, isNewRow, isRevision, r, c) {\r\n\r\n        const {setSpinner, setEdit} = this.props;\r\n\r\n        setSpinner();\r\n\r\n        // Call backend to save row\r\n        this.restApi.callApi(\"saveRow\", {\r\n            token,\r\n            row,\r\n            isNewRow,\r\n            isRevision\r\n        }).\r\n        then(response => {\r\n\r\n            const {language} = this.props;\r\n\r\n            const {processed, log} = response.result;\r\n\r\n            const message = log.split('\\n').join('<br>');\r\n\r\n            setSpinner();\r\n\r\n            if (processed) {\r\n                this.alert.showMessage(\"success\",\r\n                    language.saveActionSuccessTitle,\r\n                    message,\r\n                    false\r\n                )\r\n\r\n                this.selectedRowCoords.c = c;\r\n                this.selectedRowCoords.r = r;\r\n                this.editedRowCoords.r = null;\r\n                this.editedRowCoords.c = null;\r\n\r\n                // Reset new row state if its true\r\n                if (this.state.newRowAdded)\r\n                    this.setState({ newRowAdded : false});\r\n\r\n                setEdit(); // set it's not edit mode anymore\r\n                this.resetRow(r); // this method will return the edit view to normal\r\n                this.dataLoad(); // load the data again from db.\r\n\r\n            } else {\r\n                // something not suitable for BE,\r\n                // FE just showing a message to user.\r\n                this.alert.showMessage(\"error\",\r\n                    language.saveActionFailTitle,\r\n                    message,\r\n                    false\r\n                )\r\n\r\n                // this will make the row re-editable if get error from backend\r\n                this.setCellProperties(r, c);\r\n\r\n            }\r\n        }).catch(() => {\r\n            // we have unexpected error from BE\r\n            // Stopping edit mode, stop everything, back to one step previous\r\n            setSpinner();\r\n            //this.cancelEdit();\r\n            //this.resetRow(r);\r\n        })\r\n    }\r\n\r\n    async revisionRowFilter() {\r\n        if (this._isMounted) {\r\n            const colIndex = this.findIndexOfColumn(0,'archived');\r\n            const {showRevision} = this.props;\r\n\r\n            const arg = showRevision ? '' : 'NO'; // this param is for filtering on handsontable\r\n\r\n            if (showRevision) {\r\n                this.filter.removeConditions(colIndex);\r\n            } else {\r\n                this.filter.addCondition(colIndex, 'contains', arg);\r\n            }\r\n            await this.filter.filter();\r\n        }\r\n    }\r\n\r\n    setCellProperties(r, c) {\r\n\r\n        const colCount = this.hot.countCols();\r\n        let col = c !== null ? c : 0;\r\n\r\n        for (let x = 0; x <= colCount; x++) {\r\n            const {prop, readOnly, readOnlyInEditMode} = this.hot.getCellMeta(r,x);\r\n\r\n            if (typeof prop !== \"string\") continue\r\n\r\n            // if prop has got readyOnly attribute with value \"true\", write permission will restricted\r\n            // if prop hasn't got readOnly attribute it would be false by default. So we need to check if\r\n            // this action is adding new row or editing existing row.\r\n            // if action is editing a row then we should check readOnlyInEditMode attribute of prop.\r\n            // if it's exist we should get opposite value because if we add this attribute to prop it value should be \"true\"\r\n            // it means this property can not be writable in edit mode\r\n            // if readOnlyInEditMode attribute is not exist in prop there isn't extra attribute checking for this cell\r\n            // can be writable or not. So we can put \"true\" value to associated variable.\r\n            const writable = readOnly ? !readOnly : !this.state.newRowAdded ? !readOnlyInEditMode : !readOnly;\r\n\r\n            if (writable) {\r\n                if (this.state.permittedColumns.indexOf(prop) >= 0) {\r\n\r\n                    const type = this.hot.getDataType(r, x); // get cell type from loaded map\r\n\r\n                    // this 2 row for initiate the rules on editing row.\r\n                    //const value = this.hot.getDataAtCell(r, x);\r\n                    //this.columnEvents(r, prop, value);\r\n\r\n                    col = col === 0 ? x : col; // when add new row find first editable col.\r\n\r\n                    this.hot.setCellMeta(r, x, \"editor\", type);\r\n                    this.hot.setCellMeta(r, x, \"className\", 'bg-warning text-dark');\r\n                }\r\n            }\r\n        }\r\n        this.hot.render();\r\n        this.hot.selectCell(r, col);\r\n    }\r\n\r\n    findIndexOfColumn(r, propName) {\r\n        const colCount = this.hot.countCols();\r\n        for (let c = 0; c <= colCount; c++) {\r\n            const {prop} = this.hot.getCellMeta(r,c);\r\n            if (prop === propName) {\r\n                return c;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Before save action mandatory columns are must be filled\r\n    checkMandatoryColumnsFilled(rowData) {\r\n\r\n        const checkData = this.mandatoryColumns.reduce((data, columnId) => {\r\n            data.push(rowData[columnId]);\r\n            return data;\r\n        }, []);\r\n\r\n        return checkData.every(data => {\r\n            return data !== undefined && data !== \"\" && data !== null\r\n        })\r\n    }\r\n\r\n    // Finished initial value setter\r\n    setInitialValueOfColumn() {\r\n        this.columns.map((item) => {\r\n            if (item.hasOwnProperty('initialValue')) {\r\n                this.hot.setDataAtRowProp(0, item.data, item.initialValue)\r\n            }\r\n            return true;\r\n        })\r\n    }\r\n\r\n    // Finished, cancel edit return back to last backup data\r\n    cancelEdit() {\r\n        this.handsontableData = JSON.parse(JSON.stringify(this.handsontableDataBackup));\r\n        this.hot.loadData(this.handsontableData);\r\n        this.hot.render();\r\n\r\n        // Change edit mode on redux\r\n        this.props.setEdit();\r\n    }\r\n\r\n    // reset row finished\r\n    resetRow(r) {\r\n        const colCount = this.hot.countCols();\r\n        for (let x = 0; x <= colCount; x++) {\r\n\r\n            this.hot.setCellMeta(r, x, \"editor\", false);\r\n            this.hot.setCellMeta(r, x, \"className\", 'bg-primary text-white');\r\n        }\r\n        this.hot.render();\r\n        this.setState({ newRowAdded : false});\r\n    }\r\n\r\n    // reset seleted rows for some reason such as change region, change active page\r\n    resetSelectedRow() {\r\n\r\n        this.selectedRowCoords.r = null\r\n        this.selectedRowCoords.c = null\r\n        this.editedRowCoords.r = null\r\n        this.editedRowCoords.c = null\r\n        this.validatedCell.r = null\r\n        this.validatedCell.c = null\r\n\r\n        this.hot.deselectCell();\r\n    }\r\n\r\n    // disable moves finished\r\n    disableMoves() {\r\n        return false;\r\n    }\r\n\r\n    // Finished ip validation rule\r\n    ipValidate(value, callback) {\r\n\r\n        const pat = /^(?:\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b|null)$/;\r\n\r\n        this.rowValidation = pat.test(value);\r\n        callback(this.rowValidation);\r\n        if (!this.rowValidation)\r\n            this.showMessage(this.errorBoxTitle, this.errorMessages.invalidIP, true, true);\r\n    }\r\n\r\n    // Finished numeric value validation\r\n    numericValidate(value, callback) {\r\n\r\n        const pat = /^\\d+$/;\r\n\r\n        this.rowValidation = pat.test(value);\r\n        callback(this.rowValidation);\r\n        if (!this.rowValidation)\r\n            this.showMessage(this.errorBoxTitle, this.errorMessages.invalidNumber, true, true);\r\n    }\r\n\r\n    // Finished validation message box\r\n    showMessage(title, message, validatorClose, isMandatoryColumn) {\r\n        confirmAlert({\r\n            title: 'Validation Warning',\r\n            message: message,\r\n            closeOnEscape: false,\r\n            closeOnClickOutside: false,\r\n            customUI: ({ onClose }) => {\r\n\r\n                const closeAction = () => {\r\n                    if (validatorClose) {\r\n                        if (isMandatoryColumn) {\r\n                            const {r, c} = this.validatedCell;\r\n                            this.hot.selectCell(r, c);\r\n\r\n                            if (this.hot.getActiveEditor() !== undefined) {\r\n\r\n                                const existingValueInCell = this.hot.getDataAtCell(r, c);\r\n\r\n                                this.hot.getActiveEditor().beginEditing();\r\n                                this.hot.getActiveEditor().setValue(existingValueInCell);\r\n                            }\r\n                        }\r\n                        onClose();\r\n\r\n                    } else {\r\n                        this.cancelEdit();\r\n                        onClose();\r\n                    }\r\n                }\r\n                return (\r\n                    <div className=\"card\">\r\n                        <div className=\"card-header\">\r\n                            {title}\r\n\r\n                            <button type=\"button\" className=\"close\"\r\n                                    onClick={closeAction}\r\n                                    aria-label=\"Close\">\r\n                                <span aria-hidden=\"true\">&times;</span>\r\n                            </button>\r\n\r\n                        </div>\r\n                        <div className=\"card-body\">\r\n                            <div className={'card-text text-danger'}>{message}</div>\r\n                        </div>\r\n                        <div className=\"card-footer\">\r\n                            <button className={'btn btn-warning'} onClick={closeAction}>\r\n                                Ok\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    // Finished column header groups\r\n    handleColumnHeaders() {\r\n\r\n        // Create a copy of map file\r\n        const headerMap = JSON.parse(JSON.stringify(groupingMap));\r\n\r\n        // Set the header groups for table\r\n        const headerGrouping = headerMap.filter((item) => {\r\n            item.colspan = item.columns.length;\r\n            return typeof item.columns === \"object\"\r\n        })\r\n\r\n        // set each and every column defaults\r\n        const cols = headerMap.map((item) => {\r\n\r\n            return item.columns.map(c => {\r\n\r\n                this.titles.push(c.label);\r\n\r\n                c.color = item.color;\r\n\r\n                c.editor = false; // default readonly\r\n\r\n                if (typeof c.validator !== \"undefined\") {\r\n\r\n                    if (c.validator === 'ipValidator') {\r\n                        c.validator = (value, callback) => {\r\n                            this.ipValidate(value, callback)\r\n                        }\r\n                    }\r\n\r\n                    if (c.validator === 'isNumeric') {\r\n                        c.validator = (value, callback) => {\r\n                            this.numericValidate(value, callback)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (typeof c.type !== \"undefined\") {\r\n                    if (c.type === 'dropdown') {\r\n                        this.setPickList(c.data).then((list) => {\r\n                            c.source = list;\r\n                        });\r\n                    }\r\n                }\r\n\r\n                if (typeof c.rerenderer !== \"undefined\") {\r\n                    c.renderer = this.iconForLockStatusInCell.bind(this);\r\n                    delete c.rerenderer;\r\n                }\r\n\r\n                return c;\r\n            });\r\n        })\r\n        console.log(this.columns);\r\n\r\n        // spread the columns into single object\r\n        cols.map((c) => {\r\n            console.log(c);\r\n            this.columns = [...this.columns, ...c];\r\n        })\r\n\r\n\r\n\r\n        // Pushing header group const to related vars\r\n        this.columnHeaders.push(headerGrouping);\r\n        this.columnHeaders.push(this.titles);\r\n\r\n        console.log(this.columnHeaders);\r\n        console.log(this.columns);\r\n    }\r\n\r\n    // Finished colouring header\r\n    headerColoring(col, TH) {\r\n\r\n        const TR = TH.parentNode;\r\n        const THEAD = TR.parentNode;\r\n\r\n        const b = THEAD.childNodes.length;\r\n        const n = Array.prototype.indexOf.call(THEAD.childNodes, TR);\r\n        const headerLevel = (-1) * b + n;\r\n\r\n        function applyClass(elem, className) {\r\n            if (!Handsontable.dom.hasClass(elem, className))\r\n                Handsontable.dom.addClass(elem, className);\r\n        }\r\n\r\n        if (headerLevel === -1 || headerLevel === -2) {\r\n\r\n            if (col in this.columns) {\r\n\r\n                const {color} = this.columns[col];\r\n                if (color) applyClass(TH, color);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Finished pick list setter function\r\n    setPickList(name) {\r\n        return new Promise ((res, rej) => {\r\n\r\n            const value = `${name}Picklist_value`;\r\n            const key = `${name}Picklist`;\r\n\r\n            this.restApi.callApi('getPickList', {\r\n                token: this.props.token,\r\n                pickListName: key\r\n\r\n            }).then((response) => {\r\n\r\n                if (response.pickList.length > 0) {\r\n                     const list = response.pickList.map((item) => {\r\n                        return item[value];\r\n                    })\r\n                    res(list)\r\n                }\r\n            }).catch((error) => {\r\n                console.log(error)\r\n            });\r\n        })\r\n    }\r\n\r\n    // Read the rule from imported rule file\r\n    mandatoryColumnExtractor() {\r\n        return groupingMap.reduce((fullArr, item) => {\r\n            const cols = item.columns.reduce((arr, col) => {\r\n                if (col.mandatory) arr.push(col.data)\r\n                return arr;\r\n            }, []);\r\n            return [...fullArr, ...cols]\r\n        }, [])\r\n    }\r\n\r\n    // Read the rule from imported rule file\r\n    ruleExtractor(columnId) {\r\n        return columnLogic.find((item) => {\r\n            return item.id === columnId;\r\n        })\r\n    }\r\n\r\n    // Generic attributes validations and rule runner\r\n    async columnEvents(r, c, newV) {\r\n\r\n        this.validatedCell.r = r;\r\n        this.validatedCell.c = c;\r\n\r\n        const properties = this.ruleExtractor(c);\r\n        if (properties) {\r\n            const {methodCaller, rules, executeRules, paramName, additionalParams, ruleChain} = properties;\r\n\r\n            if (methodCaller) {\r\n                // we understand that this logic needs to call api\r\n\r\n                // default dto\r\n                let dto = {\r\n                    token: this.props.token,\r\n                    [paramName]: this.hot.getDataAtRowProp(r, c)\r\n                };\r\n\r\n                if (typeof additionalParams !== 'undefined' &&\r\n                    typeof additionalParams === 'object') {\r\n\r\n                    // create addition parameter to bind exact one\r\n                    const additionalDTO = additionalParams.map((prop) => {\r\n                        return {[prop]: this.hot.getDataAtRowProp(r, prop)}\r\n                    });\r\n\r\n                    // dto with additional parameters\r\n                    dto = Object.assign({}, dto, ...additionalDTO);\r\n                }\r\n\r\n                // method caller and logic execution\r\n                //await this.genericCL(methodCaller, dto);\r\n                this.restApi.callApi(methodCaller, dto).then((response) => {\r\n\r\n                    if (typeof response.isExist !== 'undefined') {\r\n\r\n                        if (!response.isExist) {\r\n                            // value is not exist in DB, show message\r\n\r\n                            // add this row, if column is mandatory, user must fill this cell with correct value\r\n                            const isMandatoryColumn = this.mandatoryColumns.includes(c);\r\n                            // show message and execute logic\r\n                            this.showMessage(this.errorBoxTitle, this.errorMessages[c], true, isMandatoryColumn);\r\n\r\n                            this.rowValidation = false; // row has error\r\n                            return false;\r\n\r\n                        } else {\r\n                            // value is exist in DB, check other rules associated with that one\r\n                            if (executeRules && executeRules.length > 0) {\r\n                                executeRules.map(props => {\r\n\r\n                                    const {propId} = props;\r\n                                    const data = this.hot.getDataAtRowProp(r, propId)\r\n\r\n                                    this.columnEvents(r, propId, data)\r\n                                })\r\n                            }\r\n                            this.rowValidation = true; // row passed all validation\r\n                        }\r\n\r\n                        if (ruleChain && ruleChain.length > 0) {\r\n                            this.ruleChainHandle(ruleChain, dto, r)\r\n                        }\r\n                    } else {\r\n                        rules[0].changedValue = response.List.map(i => {return i.value})\r\n                        this.staticRules(r, null, rules);\r\n                    }\r\n                })\r\n\r\n            } else {\r\n                this.staticRules(r, newV, rules)\r\n            }\r\n        }\r\n    }\r\n\r\n    ruleChainHandle(ruleChain, dto, r) {\r\n\r\n        ruleChain.map(item => {\r\n            if (item.parentResponse) {\r\n                this.restApi.callApi(item.methodCaller, dto).then(response => {\r\n                    const { exec_status } = response;\r\n\r\n                    if (item.responseType === \"string\") {\r\n                        const value = response[item.parsingKey]\r\n                        if (exec_status === \"success\") {\r\n                            this.staticRules(r, value, item.rules)\r\n                        }\r\n                    }\r\n\r\n                    if (item.responseType === \"object\") {\r\n                        const obj = response[item.parsingKey]\r\n\r\n                        const list = obj.reduce((arr, i) => {\r\n                            return [...arr, i[item.parsingKey]]\r\n                        }, [])\r\n\r\n                        this.hot.setCellMeta(r, this.hot.propToCol(item.parsingKey), 'source', list);\r\n                        this.hot.setDataAtRowProp(r, item.parsingKey, list[0]);\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    staticRules(r, value, rules) {\r\n        if (rules) {\r\n            rules.map((item) => {\r\n                if (item.columnValue && value) {\r\n                    if (item.columnValue === value) {\r\n                        // status changes\r\n                        this.hot.setDataAtRowProp(r, item.changedId, item.changedValue);\r\n                    }\r\n                } else if (!item.columnValue && value) {\r\n\r\n                    this.hot.setDataAtRowProp(r, item.changedId, value);\r\n\r\n                } else {\r\n                    this.hot.setCellMeta(r, this.hot.propToCol(item.changedId), 'source', item.changedValue);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    handleExport() {\r\n        const {token, region, radioSite} = this.props;\r\n        this.props.setSpinner();\r\n\r\n        this.restApi.callApi('exportData', {\r\n            region,\r\n            token,\r\n            radioSite\r\n        }).then(response => {\r\n            const today = new Date();\r\n            //const todayDate =  '_' + today.getDate() +  (today.toLocaleString('default', { month: 'long' })) + today.getFullYear();\r\n\r\n            const todayDate = '_' + today.getFullYear() + '-' + (today.getMonth()+1) + '-' + today.getDate() + 'T' + today.getHours() + '.' + today.getMinutes()\r\n\r\n            const ws = XLSX.utils.json_to_sheet(response.ExportedExcelAsJSON);\r\n            const wb = { Sheets: { 'data': ws }, SheetNames: ['data'] };\r\n            const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\r\n            const data = new Blob([excelBuffer], {type: 'xlsx'});\r\n\r\n           // saveAs(data, `DataMatrix${todayDate}.xlsx`);\r\n            saveAs(data, `Exported_RANConn${todayDate}.xlsx`);\r\n            this.props.setSpinner();\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n            this.props.setSpinner();\r\n\r\n        });\r\n    }\r\n\r\n    handleLockClick() {\r\n\r\n        const {r} = this.selectedRowCoords;\r\n        if (r === null) return;\r\n\r\n        if (this.isRowCanBeEditable(r, 'Lock')) {\r\n            const dto = this.prepareDTOforLockMechanism(r, true);\r\n\r\n            this.restApi.callApi('lock', dto).then(response => {\r\n                this.showMessageForLockMechanism(true, response.resultLock);\r\n                this.dataLoad();\r\n            })\r\n        }\r\n    }\r\n\r\n    handleUnlockClick() {\r\n        const {r} = this.selectedRowCoords;\r\n        if (r === null) return;\r\n\r\n        if (this.isRowCanBeEditable(r, 'Lock')) {\r\n            const dto = this.prepareDTOforLockMechanism(r, true);\r\n\r\n            this.restApi.callApi('unlock', dto).then(response => {\r\n                this.showMessageForLockMechanism(false, response.resultUnlock);\r\n                this.dataLoad();\r\n            })\r\n        }\r\n    }\r\n\r\n    prepareDTOforLockMechanism(r, isExplicit) {\r\n        const {token} = this.props;\r\n\r\n        // get existing data at row\r\n        const data = this.hot.getDataAtRow(r);\r\n        const radioSiteColumnIndex = this.findIndexOfColumn(0,'radioSite');\r\n        const revisionNumberColumnIndex = this.findIndexOfColumn(0,'revisionNumber');\r\n\r\n        const radioSite = data[radioSiteColumnIndex].toString();\r\n        const revisionNumber = data[revisionNumberColumnIndex].toString();\r\n\r\n        return {\r\n            token,\r\n            radioSite,\r\n            revisionNumber,\r\n            isExplicit\r\n        }\r\n    }\r\n\r\n    showMessageForLockMechanism(messageForLock, result) {\r\n\r\n        const {lockMechanism, unlockMechanism} = this.props.language;\r\n\r\n        const title = messageForLock ? lockMechanism.title : unlockMechanism.title;\r\n        let message = messageForLock ? lockMechanism[result.code.toString()] : unlockMechanism[result.code.toString()]\r\n\r\n        message = message\r\n            ? message.replace(\"{uname}\", result.uname).replace(\"{time}\", new Date(result.time).toLocaleString())\r\n            : \"Undefined\";\r\n\r\n        this.alert.showMessage('info', title, message, false);\r\n    }\r\n\r\n    iconForLockStatusInCell(instance, td, row, col, prop, value) {\r\n\r\n        const {language} = this.props;\r\n\r\n        switch (value) {\r\n            case \"Locked_Current_User\" : {\r\n                const message = language.lockStatusMessages.Locked_Current_User;\r\n                td.innerHTML = '<strong class=\"icon icon-lock-locked text-danger\" title=\"'+message+'\" />';\r\n            } break;\r\n\r\n            case \"Locked_Other_User\" : {\r\n                const message = language.lockStatusMessages.Locked_Other_User;\r\n                td.innerHTML = '<strong class=\"text-danger\" title=\"'+message+'\">' +\r\n                    '<i class=\"icon icon-lock-locked\"></i>' +\r\n                    '<i class=\"icon icon-avatar\"></i>' +\r\n                    '</strong>';\r\n            } break;\r\n\r\n            default: {\r\n                const message = language.lockStatusMessages.Not_Locked;\r\n                td.innerHTML = '<strong class=\"icon icon-lock-unlocked\" title=\"'+message+'\" />';\r\n            } break;\r\n\r\n        }\r\n        td.classList.add(\"text-center\")\r\n        return td;\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\r\n        return nextState.isDataExistsInDB !== this.state.isDataExistsInDB ||\r\n            nextState.activePage !== this.state.activePage ||\r\n            nextState.totalCountOfData !== this.state.totalCountOfData ||\r\n            nextState.newRowAdded !== this.state.newRowAdded ||\r\n            nextState.maximize !== this.props.maximize\r\n    }\r\n\r\n    render() {\r\n        const {maximize, language, contentCSS, showRevision} = this.props;\r\n\r\n        if (language) {\r\n            this.errorBoxTitle = language.validationMessageBoxTitle;\r\n            this.errorMessages = language.validationErrorMessages;\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <Header/>\r\n                <Row className=\"h-100\">\r\n                    <Sidebar maximize={maximize}/>\r\n                    <Col className={contentCSS}>\r\n                        <Toolbar\r\n                            wrapper={'toolbar mt-2'}\r\n                            isDataExist={this.state.isDataExistsInDB}\r\n                            newRowAdded={this.state.newRowAdded}\r\n                            export={this.handleExport.bind(this)}\r\n                            lock={this.handleLockClick.bind(this)}\r\n                            unlock={this.handleUnlockClick.bind(this)}\r\n                            new={this.handleNewRowClick.bind(this)}\r\n                            duplicate={this.handleDuplicateRowClick.bind(this)}\r\n                            edit={this.handleEditClick.bind(this)}\r\n                            cancel={this.handleCancelClick.bind(this)}\r\n                            save={this.handleSaveClick.bind(this)}\r\n                            save-history={this.handleSaveHistoryClick.bind(this)}\r\n                            revision={this.revisionRowFilter.bind(this)}\r\n                            handleRegionChange={this.dataLoad.bind(this)}\r\n                            handleRadioSiteChange={this.dataLoad.bind(this)}\r\n                        />\r\n\r\n                        <Card className={'mt-1 fixedCard'}>\r\n                            <CardBody>\r\n                                <HotTable ref={this.hotTableComponent} id={'hot'}\r\n                                  licenseKey={'non-commercial-and-evaluation'}\r\n                                  nestedHeaders={this.columnHeaders}\r\n                                  columns={this.columns}\r\n                                  stretchH={'all'}\r\n                                  dropdownMenu={true}\r\n                                  filters={true}\r\n                                  manualColumnResize={true}\r\n                                  width={'100%'}\r\n                                  height={'100%'}\r\n                                  fixedColumnsLeft={0}\r\n                                  columnSorting={true}\r\n                                  currentRowClassName={['bg-primary', 'text-white']}\r\n                                  enterBeginsEditing={false}\r\n                                  outsideClickDeselects={false}\r\n                                  enterMoves={this.disableMoves()}\r\n                                  fillHandle={this.disableMoves()}\r\n                                  afterSelectionEnd={(r, c) => {\r\n                                      this.selectedRowCoords.r = r;\r\n                                      this.selectedRowCoords.c = c;\r\n                                  }}\r\n                                  afterValidate={(isValid, value, row, prop) => {\r\n                                      // this is check dropdown values are proper or not.\r\n                                      this.validatedCell.r = row;\r\n                                      this.validatedCell.c = prop;\r\n                                  }}\r\n                                  afterGetColHeader={(col, TH) => {\r\n                                      this.headerColoring(col, TH)\r\n                                  }}\r\n                                  afterCreateRow={(index, amount, source) => {\r\n                                      //console.log(index, amount, source)\r\n                                  }}\r\n                                  afterRenderer={(td, r) => {\r\n                                      if (showRevision) {\r\n                                          const v = this.hot.getDataAtRowProp(r, 'archived');\r\n                                          if (['YES', 'Yes', 'yes'].includes(v)) {\r\n                                              td.classList.add('revision-row')\r\n                                          }\r\n                                      }\r\n                                  }}\r\n                                  afterChange={(changes) => {\r\n                                      // TODO: check esc button when its clicked\r\n                                      if (changes) {\r\n                                          const [r, c, oldV, newV] = changes[0];\r\n                                          // check cell value if it's different previous one and\r\n                                          // if row still has error -> we need that because\r\n                                          // if user doesnt change value at second time, validation rule not execute.\r\n                                          if (oldV !== newV || !this.rowValidation)\r\n                                            this.columnEvents(r, c, newV);\r\n                                      }\r\n                                  }}\r\n                                />\r\n\r\n                                {!this.state.isDataExistsInDB &&\r\n                                    <EmptyDataset page={'matrix'}/>\r\n                                }\r\n                            </CardBody>\r\n\r\n                            {/*<CardFooter className={'text-center'}>\r\n                                <PaginationMatrix\r\n                                    activePage={this.state.activePage}\r\n                                    itemPerPage={this.state.itemPerPage}\r\n                                    totalCountOfData={this.state.totalCountOfData}\r\n                                    handlePageChange={this.handlePageChange.bind(this)}\r\n                                />\r\n                            </CardFooter>*/}\r\n                        </Card>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <ModalImport loadAfterImport={this.dataLoad.bind(this)}/>\r\n                <Spinner/>\r\n            </>\r\n        )\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        token: state.token,\r\n        user: state.user,\r\n        language: state.language,\r\n        maximize: state.maximize,\r\n        contentCSS: state.contentCSS,\r\n        region: state.region,\r\n        radioSite: state.radioSite,\r\n        spinnerToggle: state.spinnerToggle,\r\n        showRevision: state.showRevision\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setEdit: () => dispatch(editOnToggle()),\r\n        setSpinner: () => dispatch(spinnerToggle()),\r\n    }\r\n\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Matrix);"]},"metadata":{},"sourceType":"module"}