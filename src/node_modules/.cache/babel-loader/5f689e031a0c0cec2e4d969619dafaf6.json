{"ast":null,"code":"import _slicedToArray from \"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\src\\\\views\\\\Matrix.jsx\";\nimport React, { createRef } from 'react';\nimport { connect } from \"react-redux\";\nimport { Row, Col, Card, CardBody, CardFooter, Jumbotron, Alert } from 'reactstrap';\nimport { HotTable } from '@handsontable/react';\nimport Handsontable from 'handsontable';\nimport { groupingMap } from '../matrixDataMap';\nimport { columnLogic } from '../matrixColumnLogicMap';\nimport PaginationMatrix from \"../components/Pagination\";\nimport Header from '../components/Header';\nimport Sidebar from '../components/Sidebar';\nimport Toolbar from '../components/ToolbarMatrix';\nimport ModalTemplate from '../components/ModalImport';\nimport Spinner from '../components/Spinner';\nimport { editOnToggle, spinnerToggle } from \"../redux/actions\";\nimport { confirmAlert } from 'react-confirm-alert';\nimport 'react-confirm-alert/src/react-confirm-alert.css'; // For export File\n\nimport XLSX from 'xlsx';\nimport { saveAs } from 'file-saver'; // Rest api module import\n\nimport RestApiModule from '../RestApiModule'; // Alert module\n\nimport AlertModule from '../AlertModule';\n\nclass Matrix extends React.Component {\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n    this.restApi = new RestApiModule();\n    this.alert = new AlertModule();\n    this.exportButton = createRef();\n    this.hotTableComponent = createRef();\n    this.hot = null;\n    this.handsontableData = null;\n    this.handsontableDataBackup = null;\n    this.errorMessages = null;\n    this.errorBoxTitle = null;\n    this.columnHeaders = [];\n    this.titles = [];\n    this.columns = [];\n    this.handleColumnHeaders();\n    this.selectedRowCoords = {\n      r: null,\n      c: null\n    };\n    this.editedRowCoords = {\n      r: null,\n      c: null\n    };\n    this.validatedCell = {\n      r: null,\n      c: null\n    };\n    this.rowValidation = true;\n    this.showHistory = false;\n    this.filter = null;\n    this.mandatoryColumns = null; //this.itemPerPage = +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE;\n\n    this.state = {\n      isDataExistsInDB: false,\n      newRowAdded: false,\n      showHistory: false,\n      activePage: 1,\n      itemPerPage: +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE,\n      totalCountOfData: 0,\n      exportDataAsExcelFile: null\n    };\n    Handsontable.hooks.add('afterSelectionEnd', (r, c) => {\n      this.selectedRowCoords.r = r;\n      this.selectedRowCoords.c = c;\n    });\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n\n    if (this.props.user) {\n      // get mandatory columns from map file\n      this.mandatoryColumns = this.mandatoryColumnExtractor();\n      this.setStateAsync({\n        permittedColumns: this.props.user.role.permittedColumns\n      });\n      this.hot = this.hotTableComponent.current.hotInstance;\n      this.dataLoad();\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  calculatePagination(total) {\n    if (total) {\n      const pageCount = +total / this.state.itemPerPage;\n      this.setStateAsync({\n        totalCountOfData: total,\n        pageCount\n      });\n    }\n  }\n\n  dataCountOfSelectedRegion() {\n    const _this$props = this.props,\n          token = _this$props.token,\n          region = _this$props.region,\n          radioSite = _this$props.radioSite;\n\n    if (region) {\n      this.restApi.callApi('getMatrixDataCount', {\n        token,\n        region,\n        radioSite\n      }).then(response => {\n        this.calculatePagination(response.ConnectivityCount[0].Count);\n      });\n    }\n  }\n\n  async dataLoad(filterChanged) {\n    if (this._isMounted) {\n      const _this$props2 = this.props,\n            token = _this$props2.token,\n            region = _this$props2.region,\n            radioSite = _this$props2.radioSite; // that means filtered options changed, so we reset the activePage number to 1\n\n      if (filterChanged) {\n        this.setStateAsync({\n          activePage: 1,\n          itemPerPage: filterChanged === \"radioSite\" ? 100 : +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE\n        });\n      }\n\n      if (region) {\n        this.props.setSpinner(); // get count of data\n\n        await this.dataCountOfSelectedRegion();\n        this.restApi.callApi('getMatrixData', {\n          token,\n          region,\n          radioSite,\n          count: this.state.itemPerPage.toString(),\n          page_index: this.state.activePage.toString()\n        }).then(async response => {\n          //console.log(response)\n          this.setStateAsync({\n            isDataExistsInDB: true\n          });\n          this.handsontableData = response.ConnectivityMatrix; // store the copy of data\n\n          this.hot.loadData(this.handsontableData);\n          /* Filter for show active rows only*/\n\n          this.filter = this.hot.getPlugin('filters');\n          await this.revisionRowFilter();\n          this.props.setSpinner();\n        }).catch(err => {\n          // err\n          this.props.setSpinner();\n        });\n      }\n    }\n  }\n\n  setStateAsync(state) {\n    return new Promise(resolve => {\n      this.setState(state, resolve);\n    });\n  }\n\n  async handlePageChange(pageNumber) {\n    //console.log(pageNumber);\n    // TODO: call api to retrieve data for matrix page\n    // data will provided by page number\n    await this.setStateAsync({\n      activePage: pageNumber\n    });\n    this.dataLoad();\n  } // click event handle for edit button\n\n\n  handleEditClick() {\n    const _this$selectedRowCoor = this.selectedRowCoords,\n          r = _this$selectedRowCoor.r,\n          c = _this$selectedRowCoor.c;\n    if (r === null && c === null) return;\n    const etatRule = this.ruleExtractor(\"etatCheckValue\");\n    const archivedRule = this.ruleExtractor(\"archivedCheckValue\");\n    const etatDataAtCell = this.hot.getDataAtRowProp(r, \"etat\");\n    const archivedDataAtCell = this.hot.getDataAtRowProp(r, \"archived\");\n    const checkEtatValue = etatRule.isValue.includes(etatDataAtCell);\n    const checkArchivedValue = archivedRule.isValue.includes(archivedDataAtCell);\n\n    if (checkEtatValue && checkArchivedValue) {\n      // create backup data before editing;\n      this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData)); // Change edit mode on redux\n\n      this.props.setEdit();\n      this.setCellProperties(r, c);\n      this.editedRowCoords.r = r;\n      this.editedRowCoords.c = c;\n    } else {\n      const language = this.props.language;\n      this.alert.showMessage(\"warning\", language.editModeRestrictionTitle, language.editModeRestriction, false);\n    }\n  } // click handle for add new row\n\n\n  async handleNewRowClick() {\n    await this.setStateAsync({\n      newRowAdded: true\n    });\n    this.editedRowCoords.r = 0;\n    this.editedRowCoords.c = 0; // create backup data before editing;\n\n    this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData));\n    this.props.setEdit();\n    this.hot.alter('insert_row', 0, 1);\n    this.setCellProperties(0, null);\n    if (this.state.showHistory) this.iterateRevisionRows();\n  } // history toggle finished\n\n\n  async handleHistoryToggle() {\n    await this.setStateAsync({\n      showHistory: !this.state.showHistory\n    });\n    await this.revisionRowFilter();\n  }\n\n  handleCancelClick() {\n    this.setStateAsync({\n      newRowAdded: false\n    }).then(() => {\n      this.cancelEdit();\n    });\n  }\n\n  handleSaveClick() {\n    this.saveAction();\n  }\n\n  handleSaveHistoryClick() {\n    this.saveAction(true);\n  } // save action for row edited or new\n\n\n  saveAction(revision) {\n    const language = this.props.language;\n\n    if (this.rowValidation) {\n      const _this$editedRowCoords = this.editedRowCoords,\n            r = _this$editedRowCoords.r,\n            c = _this$editedRowCoords.c;\n      const token = this.props.token;\n\n      if (r !== null || r !== undefined) {\n        // data would send to API\n        let data = this.hot.getSourceDataAtRow(r); // check if new row add action\n\n        if (this.state.newRowAdded) {\n          // if this is new row add action, we need all the columns even if the empty\n          data = this.columns.reduce((newRowData, i) => {\n            Object.assign(newRowData, data.hasOwnProperty(i.data) ? {\n              [i.data]: data[i.data]\n            } : {\n              [i.data]: \"\"\n            });\n            return newRowData;\n          }, {});\n        } //console.log(data);\n\n\n        const mandatoryColumnsFilled = this.checkMandatoryColumnsFilled(data);\n\n        if (mandatoryColumnsFilled) {\n          const isRevision = revision ? revision : this.state.newRowAdded ? false : data.archived === \"YES\"; // Call backend to save row\n\n          this.restApi.callApi(\"saveRow\", {\n            token,\n            row: data,\n            isNewRow: this.state.newRowAdded,\n            isRevision\n          }).then(response => {\n            const _response$result = response.result,\n                  proceed = _response$result.proceed,\n                  log = _response$result.log;\n\n            if (proceed) {\n              this.alert.showMessage(\"success\", language.saveActionSuccessTitle, log, false); //this.resetRow(r); // should remove, refresh data from DB\n\n              this.selectedRowCoords.c = c;\n              this.selectedRowCoords.r = r;\n              this.editedRowCoords.r = null;\n              this.editedRowCoords.c = null; // Change edit mode on redux\n\n              this.props.setEdit();\n              this.dataLoad();\n            } else {\n              this.alert.showMessage(\"error\", language.saveActionFailTitle, log, false);\n            }\n          });\n        } else {\n          const title = language.mandatoryDataTitle;\n          let text = language.mandatoryDataText;\n          text = text.replace(\"{columns}\", this.mandatoryColumns.join(',<br>'));\n          this.alert.showMessage(\"error\", title, text, false);\n        }\n      }\n    } else {\n      const language = this.props.language;\n      this.alert.showMessage(\"error\", language.validationMessageBoxTitle, language.validationErrorGeneralMessage, false);\n    }\n  }\n\n  async revisionRowFilter() {\n    if (this._isMounted) {\n      const colIndex = this.findIndexOfColumn(0, 'archived');\n      const arg = this.state.showHistory ? '' : 'NO'; // this param is for filtering on handsontable\n\n      if (this.state.showHistory) {\n        this.filter.removeConditions(colIndex);\n      } else {\n        this.filter.addCondition(colIndex, 'contains', arg);\n      }\n\n      await this.filter.filter(); // Makeup for revisioned rows.\n\n      await this.iterateRevisionRows();\n    }\n  }\n\n  setCellProperties(r, c) {\n    const colCount = this.hot.countCols();\n    let col = c !== null ? c : 0;\n\n    for (let x = 0; x <= colCount; x++) {\n      const _this$hot$getCellMeta = this.hot.getCellMeta(r, x),\n            prop = _this$hot$getCellMeta.prop; //if (this.editable.indexOf(prop) >= 0) {\n\n\n      if (this.state.permittedColumns.indexOf(prop) >= 0) {\n        const type = this.hot.getDataType(r, x); // get cell type from loaded map\n        // this 2 row for initiate the rules on editing row.\n        //const value = this.hot.getDataAtCell(r, x);\n        //this.columnEvents(r, prop, value);\n\n        col = col === 0 ? x : col; // when add new row find first editable col.\n\n        this.hot.setCellMeta(r, x, \"editor\", type);\n        this.hot.setCellMeta(r, x, \"className\", 'bg-warning text-dark');\n      }\n    } // set initial value for newly adding rows\n\n\n    if (this.state.newRowAdded) {\n      this.setInitialValueOfColumn();\n    }\n\n    this.hot.render();\n    this.hot.selectCell(r, col);\n  }\n\n  findIndexOfColumn(r, propName) {\n    const colCount = this.hot.countCols();\n\n    for (let c = 0; c <= colCount; c++) {\n      const _this$hot$getCellMeta2 = this.hot.getCellMeta(r, c),\n            prop = _this$hot$getCellMeta2.prop;\n\n      if (prop === propName) {\n        return c;\n      }\n    }\n  } // Before save action mandatory columns are must be filled\n\n\n  checkMandatoryColumnsFilled(rowData) {\n    const checkData = this.mandatoryColumns.reduce((data, columnId) => {\n      data.push(rowData[columnId]);\n      return data;\n    }, []);\n    return checkData.every(data => {\n      return data !== undefined && data !== \"\" && data !== null;\n    });\n  } // Finished initial value setter\n\n\n  setInitialValueOfColumn() {\n    this.columns.map(item => {\n      if (item.hasOwnProperty('initialValue')) {\n        this.hot.setDataAtRowProp(0, item.data, item.initialValue);\n      }\n\n      return true;\n    });\n  } // Finished, cancel edit return back to last backup data\n\n\n  cancelEdit() {\n    this.handsontableData = JSON.parse(JSON.stringify(this.handsontableDataBackup));\n    this.hot.loadData(this.handsontableData);\n    this.hot.render(); // Change edit mode on redux\n\n    this.props.setEdit();\n    if (this.state.showHistory) this.iterateRevisionRows();\n  } // reset row finished\n\n\n  resetRow(r) {\n    const colCount = this.hot.countCols();\n\n    for (let x = 0; x <= colCount; x++) {\n      this.hot.setCellMeta(r, x, \"editor\", false);\n      this.hot.setCellMeta(r, x, \"className\", 'bg-primary text-white');\n    }\n\n    this.hot.render();\n    this.setState({\n      newRowAdded: false\n    });\n  } // disable moves finished\n\n\n  disableMoves() {\n    return false;\n  } // Finished ip validation rule\n\n\n  ipValidate(value, callback) {\n    const pat = /^(?:\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b|null)$/;\n    this.rowValidation = pat.test(value);\n    callback(this.rowValidation);\n    if (!this.rowValidation) this.showMessage(this.errorBoxTitle, this.errorMessages.invalidIP, true);\n  } // Finished numeric value validation\n\n\n  numericValidate(value, callback) {\n    const pat = /^\\d+$/;\n    this.rowValidation = pat.test(value);\n    callback(this.rowValidation);\n    if (!this.rowValidation) this.showMessage(this.errorBoxTitle, this.errorMessages.invalidNumber, true);\n  } // Finished validation message box\n\n\n  showMessage(title, message, validatorClose) {\n    confirmAlert({\n      title: 'Validation Warning',\n      message: message,\n      closeOnEscape: false,\n      closeOnClickOutside: false,\n      customUI: ({\n        onClose\n      }) => {\n        const closeAction = () => {\n          if (validatorClose) {\n            this.hot.selectCell(this.validatedCell.r, this.validatedCell.c);\n            if (this.hot.getActiveEditor() !== undefined) this.hot.getActiveEditor().beginEditing();\n            onClose();\n          } else {\n            this.cancelEdit();\n            onClose();\n          }\n        };\n\n        return React.createElement(\"div\", {\n          className: \"card\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 513\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"card-header\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 514\n          },\n          __self: this\n        }, title, React.createElement(\"button\", {\n          type: \"button\",\n          className: \"close\",\n          onClick: closeAction,\n          \"aria-label\": \"Close\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 517\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          \"aria-hidden\": \"true\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 520\n          },\n          __self: this\n        }, \"\\xD7\"))), React.createElement(\"div\", {\n          className: \"card-body\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 524\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: 'card-text text-danger',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 525\n          },\n          __self: this\n        }, message)), React.createElement(\"div\", {\n          className: \"card-footer\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 527\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: 'btn btn-warning',\n          onClick: closeAction,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 528\n          },\n          __self: this\n        }, \"Ok\")));\n      }\n    });\n  } // Finished column header groups\n\n\n  handleColumnHeaders() {\n    // Create a copy of map file\n    const headerMap = JSON.parse(JSON.stringify(groupingMap)); // Set the header groups for table\n\n    const headerGrouping = headerMap.filter(item => {\n      item.colspan = item.columns.length;\n      return typeof item.columns !== \"array\";\n    }); // set each and every column defaults\n\n    const cols = headerMap.map(item => {\n      return item.columns.map(c => {\n        this.titles.push(c.label);\n        c.editor = false; // default readonly\n\n        if (typeof c.validator !== \"undefined\") {\n          if (c.validator === 'ipValidator') {\n            c.validator = (value, callback) => {\n              this.ipValidate(value, callback);\n            };\n          }\n\n          if (c.validator === 'isNumeric') {\n            c.validator = (value, callback) => {\n              this.numericValidate(value, callback);\n            };\n          }\n        }\n\n        if (typeof c.type !== \"undefined\") {\n          if (c.type === 'dropdown') {\n            this.setPickList(c.data).then(list => {\n              c.source = list;\n            });\n          }\n        }\n\n        return c;\n      });\n    }); // spread the columns into single object\n\n    cols.map(c => {\n      this.columns = [...this.columns, ...c];\n    }); // Pushing header group const to related vars\n\n    this.columnHeaders.push(headerGrouping);\n    this.columnHeaders.push(this.titles);\n  } // Finished colouring header\n\n\n  headerColoring(col, TH) {\n    const TR = TH.parentNode;\n    const THEAD = TR.parentNode;\n    const b = THEAD.childNodes.length;\n    const n = Array.prototype.indexOf.call(THEAD.childNodes, TR);\n    const headerLevel = -1 * b + n;\n\n    function applyClass(elem, className) {\n      if (!Handsontable.dom.hasClass(elem, className)) Handsontable.dom.addClass(elem, className);\n    }\n\n    if (headerLevel === -1 || headerLevel === -2) {\n      if (col >= 0 && col <= 11) applyClass(TH, 'color1');\n      if (col === 12) applyClass(TH, 'color2');\n      if (col >= 13 && col <= 20) applyClass(TH, 'color3');\n      if (col >= 21 && col <= 27) applyClass(TH, 'color4');\n      if (col >= 28 && col <= 30) applyClass(TH, 'color5');\n      if (col >= 31 && col <= 34) applyClass(TH, 'color6');\n      if (col >= 35 && col <= 43) applyClass(TH, 'color7');\n      if (col >= 44 && col <= 46) applyClass(TH, 'color8');\n      if (col >= 47 && col <= 50) applyClass(TH, 'color9');\n    }\n  } // Finished pick list setter function\n\n\n  setPickList(name) {\n    return new Promise((res, rej) => {\n      const value = `${name}Picklist_value`;\n      const key = `${name}Picklist`;\n      this.restApi.callApi('getPickList', {\n        token: this.props.token,\n        pickListName: key\n      }).then(response => {\n        if (response.pickList.length > 0) {\n          const list = response.pickList.map(item => {\n            return item[value];\n          });\n          res(list);\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    });\n  } // Finished revision row makeup\n\n\n  iterateRevisionRows() {\n    const rc = this.hot.countRows();\n    const cc = this.hot.countCols();\n\n    for (let r = 0; r <= rc; r++) {\n      const value = this.hot.getDataAtRowProp(r, 'archived');\n\n      if (value === 'YES' || value === \"Yes\" || value === \"yes\") {\n        for (let c = 0; c <= cc; c++) {\n          this.hot.setCellMeta(r, c, 'renderer', (instance, td) => {\n            const showHistory = this.state.showHistory;\n            if (showHistory) td.classList.add('revision-row');\n          });\n        }\n      }\n    }\n\n    this.hot.render();\n  } // Read the rule from imported rule file\n\n\n  mandatoryColumnExtractor() {\n    return groupingMap.reduce((fullArr, item) => {\n      const cols = item.columns.reduce((arr, col) => {\n        if (col.mandatory) arr.push(col.data);\n        return arr;\n      }, []);\n      return [...fullArr, ...cols];\n    }, []);\n  } // Read the rule from imported rule file\n\n\n  ruleExtractor(columnId) {\n    return columnLogic.find(item => {\n      return item.id === columnId;\n    });\n  } // Generic attributes validations and rule runner\n\n\n  async columnEvents(r, c, newV) {\n    this.validatedCell.r = r;\n    this.validatedCell.c = c;\n    const properties = this.ruleExtractor(c);\n\n    if (properties) {\n      const methodCaller = properties.methodCaller,\n            rules = properties.rules,\n            executeRules = properties.executeRules,\n            paramName = properties.paramName,\n            additionalParams = properties.additionalParams;\n\n      if (methodCaller) {\n        // we understand that this logic needs to call api\n        // default dto\n        let dto = {\n          token: this.props.token,\n          [paramName]: this.hot.getDataAtRowProp(r, c)\n        };\n\n        if (typeof additionalParams !== 'undefined' && typeof additionalParams === 'object') {\n          // create addition parameter to bind exact one\n          const additionalDTO = additionalParams.map(prop => {\n            return {\n              [prop]: this.hot.getDataAtRowProp(r, prop)\n            };\n          }); // dto with additional parameters\n\n          dto = Object.assign({}, dto, ...additionalDTO);\n        } // method caller and logic execution\n        //await this.genericCL(methodCaller, dto);\n\n\n        this.restApi.callApi(methodCaller, dto).then(response => {\n          if (typeof response.isExist !== 'undefined') {\n            if (!response.isExist) {\n              // value is not exist in DB, show message\n              this.showMessage(this.errorBoxTitle, this.errorMessages[c], true);\n              return false;\n            } else {\n              // value is exist in DB, check other rules associated with that one\n              if (executeRules && executeRules.length > 0) {\n                executeRules.map(props => {\n                  const propId = props.propId;\n                  const data = this.hot.getDataAtRowProp(r, propId);\n                  this.columnEvents(r, propId, data);\n                });\n              }\n            }\n          } else {\n            rules[0].changedValue = response.List.map(i => {\n              return i.value;\n            });\n            this.staticRules(r, null, rules);\n          }\n        });\n      } else {\n        this.staticRules(r, newV, rules);\n      }\n    }\n  }\n\n  staticRules(r, value, rules) {\n    if (rules) {\n      rules.map(item => {\n        if (value !== null && item.columnValue === value) {\n          // status changes\n          this.hot.setDataAtRowProp(r, item.changedId, item.changedValue);\n        } else {\n          this.hot.setCellMeta(r, this.hot.propToCol(item.changedId), 'source', item.changedValue);\n        }\n      });\n    }\n  }\n\n  handleExport() {\n    const _this$props3 = this.props,\n          token = _this$props3.token,\n          region = _this$props3.region;\n    this.restApi.callApi('exportData', {\n      region,\n      token\n    }).then(response => {\n      const today = new Date(); //const todayDate =  '_' + today.getDate() +  (today.toLocaleString('default', { month: 'long' })) + today.getFullYear();\n\n      const todayDate = '_' + today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate() + 'T' + today.getHours() + ':::' + today.getMinutes();\n      const ws = XLSX.utils.json_to_sheet(response.ExportedExcelAsJSON);\n      const wb = {\n        Sheets: {\n          'data': ws\n        },\n        SheetNames: ['data']\n      };\n      const excelBuffer = XLSX.write(wb, {\n        bookType: 'xlsx',\n        type: 'array'\n      });\n      const data = new Blob([excelBuffer], {\n        type: 'xlsx'\n      }); // saveAs(data, `DataMatrix${todayDate}.xlsx`);\n\n      saveAs(data, `Exported_RANConn${todayDate}.xlsx`);\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  shouldComponentUpdate(nextProps, nextState, nextContext) {\n    return nextState.isDataExistsInDB !== this.state.isDataExistsInDB || nextState.activePage !== this.state.activePage || nextState.totalCountOfData !== this.state.totalCountOfData || nextState.newRowAdded !== this.state.newRowAdded;\n  }\n\n  render() {\n    const _this$props4 = this.props,\n          maximize = _this$props4.maximize,\n          language = _this$props4.language,\n          contentCSS = _this$props4.contentCSS;\n\n    if (language) {\n      this.errorBoxTitle = language.validationMessageBoxTitle;\n      this.errorMessages = language.validationErrorMessages;\n    }\n\n    return React.createElement(React.Fragment, null, React.createElement(Header, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 811\n      },\n      __self: this\n    }), React.createElement(Row, {\n      className: \"h-100\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 812\n      },\n      __self: this\n    }, React.createElement(Sidebar, {\n      maximize: maximize,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 813\n      },\n      __self: this\n    }), React.createElement(Col, {\n      className: contentCSS,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 814\n      },\n      __self: this\n    }, React.createElement(Toolbar, {\n      wrapper: 'toolbar mt-2',\n      isDataExist: this.state.isDataExistsInDB,\n      newRowAdded: this.state.newRowAdded,\n      exportClick: this.handleExport.bind(this),\n      newClick: this.handleNewRowClick.bind(this),\n      editClick: this.handleEditClick.bind(this),\n      cancelClick: this.handleCancelClick.bind(this),\n      saveClick: this.handleSaveClick.bind(this),\n      saveHistoryClick: this.handleSaveHistoryClick.bind(this),\n      historyToggle: this.handleHistoryToggle.bind(this),\n      handleRegionChange: this.dataLoad.bind(this),\n      handleRadioSiteChange: this.dataLoad.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 815\n      },\n      __self: this\n    }), React.createElement(Card, {\n      className: 'mt-1 fixedCard',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 830\n      },\n      __self: this\n    }, React.createElement(CardBody, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 831\n      },\n      __self: this\n    }, React.createElement(HotTable, {\n      ref: this.hotTableComponent,\n      id: 'hot',\n      rowHeaders: true,\n      licenseKey: 'non-commercial-and-evaluation',\n      nestedHeaders: this.columnHeaders,\n      columns: this.columns,\n      stretchH: 'all',\n      dropdownMenu: true,\n      filters: true,\n      manualColumnResize: true,\n      width: '100%',\n      height: '100%',\n      fixedColumnsLeft: 0,\n      columnSorting: true,\n      currentRowClassName: ['bg-primary', 'text-white'],\n      enterBeginsEditing: false,\n      outsideClickDeselects: false,\n      enterMoves: this.disableMoves(),\n      fillHandle: this.disableMoves(),\n      afterValidate: (isValid, value, row, prop) => {\n        // this is check dropdown values are proper or not.\n        this.validatedCell.r = row;\n        this.validatedCell.c = prop;\n      },\n      afterGetColHeader: (col, TH) => {\n        this.headerColoring(col, TH);\n      },\n      afterCreateRow: (index, amount, source) => {\n        console.log(index, amount, source);\n      },\n      afterChange: changes => {\n        // TODO: check esc button when its clicked\n        if (changes) {\n          const _changes$ = _slicedToArray(changes[0], 4),\n                r = _changes$[0],\n                c = _changes$[1],\n                oldV = _changes$[2],\n                newV = _changes$[3]; //&& !this.state.newRowAdded\n\n\n          if (oldV !== newV) this.columnEvents(r, c, newV);\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 832\n      },\n      __self: this\n    }), !this.state.isDataExistsInDB && React.createElement(\"div\", {\n      className: 'empty-data',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 873\n      },\n      __self: this\n    }, React.createElement(Jumbotron, {\n      className: \"empty-data-content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 874\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      className: \"display-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 875\n      },\n      __self: this\n    }, language.emptyDataMatrix.title), React.createElement(\"p\", {\n      className: \"lead\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 876\n      },\n      __self: this\n    }, language.emptyDataMatrix.spot), React.createElement(\"hr\", {\n      className: \"my-2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 877\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 878\n      },\n      __self: this\n    }, language.emptyDataMatrix.text)))), React.createElement(CardFooter, {\n      className: 'text-center',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 884\n      },\n      __self: this\n    }, React.createElement(PaginationMatrix, {\n      activePage: this.state.activePage,\n      itemPerPage: this.state.itemPerPage,\n      totalCountOfData: this.state.totalCountOfData,\n      handlePageChange: this.handlePageChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 885\n      },\n      __self: this\n    }))))), React.createElement(ModalTemplate, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 896\n      },\n      __self: this\n    }), React.createElement(Spinner, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 897\n      },\n      __self: this\n    }));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    token: state.token,\n    user: state.user,\n    language: state.language,\n    maximize: state.maximize,\n    contentCSS: state.contentCSS,\n    region: state.region,\n    radioSite: state.radioSite,\n    spinnerToggle: state.spinnerToggle\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    setEdit: () => dispatch(editOnToggle()),\n    setSpinner: () => dispatch(spinnerToggle())\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Matrix);","map":{"version":3,"sources":["C:/Users/ezerdon/Desktop/INWI/svn reps/E2E_Topology/E2ETopologyFrontend/src/src/views/Matrix.jsx"],"names":["React","createRef","connect","Row","Col","Card","CardBody","CardFooter","Jumbotron","Alert","HotTable","Handsontable","groupingMap","columnLogic","PaginationMatrix","Header","Sidebar","Toolbar","ModalTemplate","Spinner","editOnToggle","spinnerToggle","confirmAlert","XLSX","saveAs","RestApiModule","AlertModule","Matrix","Component","constructor","props","_isMounted","restApi","alert","exportButton","hotTableComponent","hot","handsontableData","handsontableDataBackup","errorMessages","errorBoxTitle","columnHeaders","titles","columns","handleColumnHeaders","selectedRowCoords","r","c","editedRowCoords","validatedCell","rowValidation","showHistory","filter","mandatoryColumns","state","isDataExistsInDB","newRowAdded","activePage","itemPerPage","process","env","REACT_APP_MATRIX_ITEM_PER_PAGE","totalCountOfData","exportDataAsExcelFile","hooks","add","componentDidMount","user","mandatoryColumnExtractor","setStateAsync","permittedColumns","role","current","hotInstance","dataLoad","componentWillUnmount","calculatePagination","total","pageCount","dataCountOfSelectedRegion","token","region","radioSite","callApi","then","response","ConnectivityCount","Count","filterChanged","setSpinner","count","toString","page_index","ConnectivityMatrix","loadData","getPlugin","revisionRowFilter","catch","err","Promise","resolve","setState","handlePageChange","pageNumber","handleEditClick","etatRule","ruleExtractor","archivedRule","etatDataAtCell","getDataAtRowProp","archivedDataAtCell","checkEtatValue","isValue","includes","checkArchivedValue","JSON","parse","stringify","setEdit","setCellProperties","language","showMessage","editModeRestrictionTitle","editModeRestriction","handleNewRowClick","alter","iterateRevisionRows","handleHistoryToggle","handleCancelClick","cancelEdit","handleSaveClick","saveAction","handleSaveHistoryClick","revision","undefined","data","getSourceDataAtRow","reduce","newRowData","i","Object","assign","hasOwnProperty","mandatoryColumnsFilled","checkMandatoryColumnsFilled","isRevision","archived","row","isNewRow","result","proceed","log","saveActionSuccessTitle","saveActionFailTitle","title","mandatoryDataTitle","text","mandatoryDataText","replace","join","validationMessageBoxTitle","validationErrorGeneralMessage","colIndex","findIndexOfColumn","arg","removeConditions","addCondition","colCount","countCols","col","x","getCellMeta","prop","indexOf","type","getDataType","setCellMeta","setInitialValueOfColumn","render","selectCell","propName","rowData","checkData","columnId","push","every","map","item","setDataAtRowProp","initialValue","resetRow","disableMoves","ipValidate","value","callback","pat","test","invalidIP","numericValidate","invalidNumber","message","validatorClose","closeOnEscape","closeOnClickOutside","customUI","onClose","closeAction","getActiveEditor","beginEditing","headerMap","headerGrouping","colspan","length","cols","label","editor","validator","setPickList","list","source","headerColoring","TH","TR","parentNode","THEAD","b","childNodes","n","Array","prototype","call","headerLevel","applyClass","elem","className","dom","hasClass","addClass","name","res","rej","key","pickListName","pickList","error","console","rc","countRows","cc","instance","td","classList","fullArr","arr","mandatory","find","id","columnEvents","newV","properties","methodCaller","rules","executeRules","paramName","additionalParams","dto","additionalDTO","isExist","propId","changedValue","List","staticRules","columnValue","changedId","propToCol","handleExport","today","Date","todayDate","getFullYear","getMonth","getDate","getHours","getMinutes","ws","utils","json_to_sheet","ExportedExcelAsJSON","wb","Sheets","SheetNames","excelBuffer","write","bookType","Blob","shouldComponentUpdate","nextProps","nextState","nextContext","maximize","contentCSS","validationErrorMessages","bind","isValid","index","amount","changes","oldV","emptyDataMatrix","spot","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, {createRef} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport {Row, Col, Card, CardBody, CardFooter, Jumbotron, Alert} from 'reactstrap';\r\n\r\nimport {HotTable} from '@handsontable/react';\r\nimport Handsontable from 'handsontable';\r\nimport {groupingMap} from '../matrixDataMap';\r\nimport {columnLogic} from '../matrixColumnLogicMap';\r\n\r\nimport PaginationMatrix from \"../components/Pagination\"\r\n\r\nimport Header from '../components/Header'\r\nimport Sidebar from '../components/Sidebar'\r\nimport Toolbar from '../components/ToolbarMatrix'\r\nimport ModalTemplate from '../components/ModalImport'\r\nimport Spinner from '../components/Spinner'\r\n\r\nimport {editOnToggle, spinnerToggle} from \"../redux/actions\";\r\n\r\nimport { confirmAlert } from 'react-confirm-alert';\r\nimport 'react-confirm-alert/src/react-confirm-alert.css';\r\n\r\n// For export File\r\nimport XLSX from 'xlsx'\r\nimport {saveAs} from 'file-saver';\r\n\r\n// Rest api module import\r\nimport RestApiModule from '../RestApiModule'\r\n\r\n// Alert module\r\nimport AlertModule from '../AlertModule'\r\n\r\nclass Matrix extends React.Component {\r\n    _isMounted = false;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.restApi = new RestApiModule();\r\n        this.alert = new AlertModule();\r\n\r\n        this.exportButton = createRef();\r\n\r\n        this.hotTableComponent = createRef();\r\n        this.hot = null;\r\n        this.handsontableData = null;\r\n        this.handsontableDataBackup = null;\r\n\r\n        this.errorMessages = null;\r\n        this.errorBoxTitle = null;\r\n        this.columnHeaders = [];\r\n        this.titles = [];\r\n        this.columns = [];\r\n        this.handleColumnHeaders();\r\n\r\n        this.selectedRowCoords = {r: null, c: null};\r\n        this.editedRowCoords = {r: null, c: null};\r\n        this.validatedCell = {r: null, c: null};\r\n        this.rowValidation = true;\r\n        this.showHistory = false;\r\n        this.filter = null;\r\n        this.mandatoryColumns = null;\r\n\r\n\r\n        //this.itemPerPage = +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE;\r\n        this.state = {\r\n            isDataExistsInDB: false,\r\n            newRowAdded: false,\r\n            showHistory: false,\r\n            activePage: 1,\r\n            itemPerPage: +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE,\r\n            totalCountOfData: 0,\r\n            exportDataAsExcelFile: null\r\n        };\r\n\r\n        Handsontable.hooks.add('afterSelectionEnd', (r, c) => {\r\n            this.selectedRowCoords.r = r;\r\n            this.selectedRowCoords.c = c;\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        this._isMounted = true;\r\n\r\n        if (this.props.user) {\r\n\r\n            // get mandatory columns from map file\r\n            this.mandatoryColumns = this.mandatoryColumnExtractor();\r\n\r\n            this.setStateAsync({permittedColumns: this.props.user.role.permittedColumns});\r\n            this.hot = this.hotTableComponent.current.hotInstance;\r\n\r\n            this.dataLoad();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this._isMounted = false;\r\n    }\r\n\r\n    calculatePagination(total) {\r\n\r\n        if (total) {\r\n            const pageCount = +total / this.state.itemPerPage;\r\n            this.setStateAsync({totalCountOfData: total, pageCount})\r\n        }\r\n    }\r\n\r\n    dataCountOfSelectedRegion() {\r\n\r\n        const {token, region, radioSite} = this.props;\r\n\r\n        if (region) {\r\n            this.restApi.callApi('getMatrixDataCount', {\r\n                token,\r\n                region,\r\n                radioSite\r\n            }).then(response => {\r\n                this.calculatePagination(response.ConnectivityCount[0].Count)\r\n            })\r\n        }\r\n    }\r\n\r\n    async dataLoad(filterChanged) {\r\n\r\n        if (this._isMounted) {\r\n            const {token, region, radioSite} = this.props;\r\n\r\n            // that means filtered options changed, so we reset the activePage number to 1\r\n            if (filterChanged) {\r\n\r\n                this.setStateAsync({\r\n                    activePage: 1,\r\n                    itemPerPage: (filterChanged === \"radioSite\") ? 100 : +process.env.REACT_APP_MATRIX_ITEM_PER_PAGE\r\n                });\r\n            }\r\n\r\n            if (region) {\r\n                this.props.setSpinner();\r\n\r\n                // get count of data\r\n                await this.dataCountOfSelectedRegion()\r\n\r\n                this.restApi.callApi('getMatrixData', {\r\n                    token,\r\n                    region,\r\n                    radioSite,\r\n                    count: this.state.itemPerPage.toString(),\r\n                    page_index: this.state.activePage.toString()\r\n                }).then(async (response) => {\r\n                    //console.log(response)\r\n                    this.setStateAsync({isDataExistsInDB: true});\r\n\r\n                    this.handsontableData = response.ConnectivityMatrix; // store the copy of data\r\n                    this.hot.loadData(this.handsontableData);\r\n\r\n                    /* Filter for show active rows only*/\r\n                    this.filter = this.hot.getPlugin('filters');\r\n\r\n                    await this.revisionRowFilter();\r\n                    this.props.setSpinner();\r\n                }).catch(err => {\r\n                    // err\r\n                    this.props.setSpinner();\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    setStateAsync(state) {\r\n        return new Promise((resolve) => {\r\n            this.setState(state, resolve)\r\n        });\r\n    }\r\n\r\n    async handlePageChange(pageNumber) {\r\n        //console.log(pageNumber);\r\n        // TODO: call api to retrieve data for matrix page\r\n        // data will provided by page number\r\n        await this.setStateAsync({activePage: pageNumber});\r\n        this.dataLoad();\r\n    }\r\n\r\n    // click event handle for edit button\r\n    handleEditClick() {\r\n\r\n        const {r, c} = this.selectedRowCoords;\r\n        if (r === null && c === null) return;\r\n\r\n        const etatRule = this.ruleExtractor(\"etatCheckValue\");\r\n        const archivedRule = this.ruleExtractor(\"archivedCheckValue\");\r\n        const etatDataAtCell = this.hot.getDataAtRowProp(r, \"etat\");\r\n        const archivedDataAtCell = this.hot.getDataAtRowProp(r, \"archived\");\r\n\r\n        const checkEtatValue = etatRule.isValue.includes(etatDataAtCell)\r\n        const checkArchivedValue = archivedRule.isValue.includes(archivedDataAtCell)\r\n\r\n        if (checkEtatValue && checkArchivedValue) {\r\n\r\n            // create backup data before editing;\r\n            this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData));\r\n\r\n            // Change edit mode on redux\r\n            this.props.setEdit();\r\n\r\n            this.setCellProperties(r, c);\r\n            this.editedRowCoords.r = r;\r\n            this.editedRowCoords.c = c;\r\n        } else {\r\n\r\n            const {language} = this.props;\r\n            this.alert.showMessage(\"warning\",\r\n                language.editModeRestrictionTitle,\r\n                language.editModeRestriction,\r\n                false);\r\n        }\r\n    }\r\n\r\n    // click handle for add new row\r\n    async handleNewRowClick() {\r\n\r\n        await this.setStateAsync({newRowAdded : true});\r\n        this.editedRowCoords.r = 0;\r\n        this.editedRowCoords.c = 0;\r\n\r\n        // create backup data before editing;\r\n        this.handsontableDataBackup = JSON.parse(JSON.stringify(this.handsontableData));\r\n\r\n        this.props.setEdit();\r\n        this.hot.alter('insert_row', 0, 1);\r\n        this.setCellProperties(0, null);\r\n\r\n        if (this.state.showHistory)\r\n            this.iterateRevisionRows();\r\n    }\r\n\r\n    // history toggle finished\r\n    async handleHistoryToggle() {\r\n\r\n        await this.setStateAsync({showHistory: !this.state.showHistory})\r\n        await this.revisionRowFilter();\r\n    }\r\n\r\n    handleCancelClick() {\r\n        this.setStateAsync({newRowAdded : false}).then(() => {\r\n            this.cancelEdit();\r\n        });\r\n    }\r\n\r\n    handleSaveClick() {\r\n        this.saveAction();\r\n    }\r\n\r\n    handleSaveHistoryClick() {\r\n        this.saveAction(true)\r\n    }\r\n\r\n    // save action for row edited or new\r\n    saveAction(revision) {\r\n\r\n        const {language} = this.props;\r\n\r\n        if (this.rowValidation) {\r\n\r\n            const {r, c} = this.editedRowCoords;\r\n            const {token} = this.props;\r\n\r\n            if (r !== null || r !== undefined) {\r\n                // data would send to API\r\n                let data = this.hot.getSourceDataAtRow(r);\r\n\r\n                // check if new row add action\r\n                if (this.state.newRowAdded) {\r\n                    // if this is new row add action, we need all the columns even if the empty\r\n\r\n                    data = this.columns.reduce((newRowData, i) => {\r\n\r\n                        Object.assign(newRowData,\r\n                            (data.hasOwnProperty(i.data))\r\n                                ? {[i.data]: data[i.data]}\r\n                                : {[i.data]: \"\"}\r\n                            );\r\n                        return newRowData;\r\n                    }, {});\r\n                }\r\n                //console.log(data);\r\n\r\n                const mandatoryColumnsFilled = this.checkMandatoryColumnsFilled(data);\r\n\r\n                if (mandatoryColumnsFilled) {\r\n\r\n                    const isRevision = revision\r\n                        ? revision\r\n                        : this.state.newRowAdded\r\n                            ? false\r\n                            : data.archived === \"YES\"\r\n\r\n                    // Call backend to save row\r\n                    this.restApi.callApi(\"saveRow\", {\r\n                        token,\r\n                        row: data,\r\n                        isNewRow: this.state.newRowAdded,\r\n                        isRevision\r\n                    }).then(response => {\r\n\r\n                        const {proceed, log} = response.result;\r\n\r\n                        if (proceed) {\r\n                            this.alert.showMessage(\"success\",\r\n                                language.saveActionSuccessTitle,\r\n                                log,\r\n                                false\r\n                            )\r\n\r\n                            //this.resetRow(r); // should remove, refresh data from DB\r\n\r\n                            this.selectedRowCoords.c = c;\r\n                            this.selectedRowCoords.r = r;\r\n                            this.editedRowCoords.r = null;\r\n                            this.editedRowCoords.c = null;\r\n\r\n                            // Change edit mode on redux\r\n                            this.props.setEdit();\r\n                            this.dataLoad();\r\n\r\n                        } else {\r\n                            this.alert.showMessage(\"error\",\r\n                                language.saveActionFailTitle,\r\n                                log,\r\n                                false\r\n                            )\r\n                        }\r\n                    })\r\n                } else {\r\n\r\n                    const title = language.mandatoryDataTitle;\r\n                    let text = language.mandatoryDataText;\r\n\r\n                    text = text.replace(\"{columns}\", this.mandatoryColumns.join(',<br>'));\r\n\r\n                    this.alert.showMessage(\"error\", title, text, false);\r\n                }\r\n            }\r\n\r\n        } else {\r\n\r\n            const {language} = this.props;\r\n            this.alert.showMessage(\"error\",\r\n                language.validationMessageBoxTitle,\r\n                language.validationErrorGeneralMessage,\r\n                false)\r\n        }\r\n    }\r\n\r\n    async revisionRowFilter() {\r\n        if (this._isMounted) {\r\n            const colIndex = this.findIndexOfColumn(0,'archived');\r\n\r\n            const arg = this.state.showHistory ? '' : 'NO'; // this param is for filtering on handsontable\r\n\r\n            if (this.state.showHistory) {\r\n                this.filter.removeConditions(colIndex);\r\n            } else {\r\n                this.filter.addCondition(colIndex, 'contains', arg);\r\n            }\r\n            await this.filter.filter();\r\n\r\n            // Makeup for revisioned rows.\r\n            await this.iterateRevisionRows();\r\n        }\r\n    }\r\n\r\n    setCellProperties(r, c) {\r\n\r\n        const colCount = this.hot.countCols();\r\n        let col = c !== null ? c : 0;\r\n\r\n        for (let x = 0; x <= colCount; x++) {\r\n            const {prop} = this.hot.getCellMeta(r,x);\r\n\r\n            //if (this.editable.indexOf(prop) >= 0) {\r\n            if (this.state.permittedColumns.indexOf(prop) >= 0) {\r\n\r\n                const type = this.hot.getDataType(r,x); // get cell type from loaded map\r\n\r\n                // this 2 row for initiate the rules on editing row.\r\n                //const value = this.hot.getDataAtCell(r, x);\r\n                //this.columnEvents(r, prop, value);\r\n\r\n                col = col === 0 ? x : col; // when add new row find first editable col.\r\n\r\n                this.hot.setCellMeta(r, x, \"editor\", type);\r\n                this.hot.setCellMeta(r, x, \"className\", 'bg-warning text-dark');\r\n            }\r\n        }\r\n        // set initial value for newly adding rows\r\n        if (this.state.newRowAdded) {\r\n            this.setInitialValueOfColumn();\r\n        }\r\n\r\n\r\n        this.hot.render();\r\n        this.hot.selectCell(r, col);\r\n    }\r\n\r\n    findIndexOfColumn(r, propName) {\r\n        const colCount = this.hot.countCols();\r\n        for (let c = 0; c <= colCount; c++) {\r\n            const {prop} = this.hot.getCellMeta(r,c);\r\n            if (prop === propName) {\r\n                return c;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Before save action mandatory columns are must be filled\r\n    checkMandatoryColumnsFilled(rowData) {\r\n\r\n        const checkData = this.mandatoryColumns.reduce((data, columnId) => {\r\n            data.push(rowData[columnId]);\r\n            return data;\r\n        }, []);\r\n\r\n        return checkData.every(data => {\r\n            return data !== undefined && data !== \"\" && data !== null\r\n        })\r\n    }\r\n\r\n    // Finished initial value setter\r\n    setInitialValueOfColumn() {\r\n        this.columns.map((item) => {\r\n            if (item.hasOwnProperty('initialValue')) {\r\n                this.hot.setDataAtRowProp(0, item.data, item.initialValue)\r\n            }\r\n            return true;\r\n        })\r\n    }\r\n\r\n    // Finished, cancel edit return back to last backup data\r\n    cancelEdit() {\r\n        this.handsontableData = JSON.parse(JSON.stringify(this.handsontableDataBackup));\r\n        this.hot.loadData(this.handsontableData);\r\n        this.hot.render();\r\n\r\n        // Change edit mode on redux\r\n        this.props.setEdit();\r\n\r\n        if (this.state.showHistory)\r\n            this.iterateRevisionRows();\r\n    }\r\n\r\n    // reset row finished\r\n    resetRow(r) {\r\n        const colCount = this.hot.countCols();\r\n        for (let x = 0; x <= colCount; x++) {\r\n\r\n            this.hot.setCellMeta(r, x, \"editor\", false);\r\n            this.hot.setCellMeta(r, x, \"className\", 'bg-primary text-white');\r\n        }\r\n        this.hot.render();\r\n        this.setState({ newRowAdded : false});\r\n    }\r\n\r\n    // disable moves finished\r\n    disableMoves() {\r\n        return false;\r\n    }\r\n\r\n    // Finished ip validation rule\r\n    ipValidate(value, callback) {\r\n\r\n        const pat = /^(?:\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b|null)$/;\r\n\r\n        this.rowValidation = pat.test(value);\r\n        callback(this.rowValidation);\r\n        if (!this.rowValidation)\r\n            this.showMessage(this.errorBoxTitle, this.errorMessages.invalidIP, true);\r\n    }\r\n\r\n    // Finished numeric value validation\r\n    numericValidate(value, callback) {\r\n\r\n        const pat = /^\\d+$/;\r\n\r\n        this.rowValidation = pat.test(value);\r\n        callback(this.rowValidation);\r\n        if (!this.rowValidation)\r\n            this.showMessage(this.errorBoxTitle, this.errorMessages.invalidNumber, true);\r\n    }\r\n\r\n    // Finished validation message box\r\n    showMessage(title, message, validatorClose) {\r\n        confirmAlert({\r\n            title: 'Validation Warning',\r\n            message: message,\r\n            closeOnEscape: false,\r\n            closeOnClickOutside: false,\r\n            customUI: ({ onClose }) => {\r\n\r\n                const closeAction = () => {\r\n                    if (validatorClose) {\r\n                        this.hot.selectCell(this.validatedCell.r, this.validatedCell.c);\r\n                        if (this.hot.getActiveEditor() !== undefined)\r\n                            this.hot.getActiveEditor().beginEditing();\r\n                        onClose();\r\n\r\n                    } else {\r\n                        this.cancelEdit();\r\n                        onClose();\r\n                    }\r\n                }\r\n                return (\r\n                    <div className=\"card\">\r\n                        <div className=\"card-header\">\r\n                            {title}\r\n\r\n                            <button type=\"button\" className=\"close\"\r\n                                    onClick={closeAction}\r\n                                    aria-label=\"Close\">\r\n                                <span aria-hidden=\"true\">&times;</span>\r\n                            </button>\r\n\r\n                        </div>\r\n                        <div className=\"card-body\">\r\n                            <div className={'card-text text-danger'}>{message}</div>\r\n                        </div>\r\n                        <div className=\"card-footer\">\r\n                            <button className={'btn btn-warning'} onClick={closeAction}>\r\n                                Ok\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    // Finished column header groups\r\n    handleColumnHeaders() {\r\n\r\n        // Create a copy of map file\r\n        const headerMap = JSON.parse(JSON.stringify(groupingMap));\r\n\r\n        // Set the header groups for table\r\n        const headerGrouping = headerMap.filter((item) => {\r\n            item.colspan = item.columns.length;\r\n            return typeof item.columns !== \"array\"\r\n        })\r\n\r\n        // set each and every column defaults\r\n        const cols = headerMap.map((item) => {\r\n\r\n            return item.columns.map(c => {\r\n\r\n                this.titles.push(c.label);\r\n\r\n                c.editor = false; // default readonly\r\n\r\n                if (typeof c.validator !== \"undefined\") {\r\n\r\n                    if (c.validator === 'ipValidator') {\r\n                        c.validator = (value, callback) => {\r\n                            this.ipValidate(value, callback)\r\n                        }\r\n                    }\r\n\r\n                    if (c.validator === 'isNumeric') {\r\n                        c.validator = (value, callback) => {\r\n                            this.numericValidate(value, callback)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (typeof c.type !== \"undefined\") {\r\n                    if (c.type === 'dropdown') {\r\n                        this.setPickList(c.data).then((list) => {\r\n                            c.source = list;\r\n                        });\r\n                    }\r\n                }\r\n                return c;\r\n            });\r\n        })\r\n\r\n        // spread the columns into single object\r\n        cols.map((c) => {\r\n            this.columns = [...this.columns, ...c];\r\n        })\r\n\r\n        // Pushing header group const to related vars\r\n        this.columnHeaders.push(headerGrouping);\r\n        this.columnHeaders.push(this.titles);\r\n    }\r\n\r\n    // Finished colouring header\r\n    headerColoring(col, TH) {\r\n\r\n        const TR = TH.parentNode;\r\n        const THEAD = TR.parentNode;\r\n\r\n        const b = THEAD.childNodes.length;\r\n        const n = Array.prototype.indexOf.call(THEAD.childNodes, TR);\r\n        const headerLevel = (-1) * b + n;\r\n\r\n        function applyClass(elem, className) {\r\n            if (!Handsontable.dom.hasClass(elem, className))\r\n                Handsontable.dom.addClass(elem, className);\r\n        }\r\n\r\n        if (headerLevel === -1 || headerLevel === -2) {\r\n\r\n            if (col >=0 && col <= 11) applyClass(TH, 'color1');\r\n            if (col === 12) applyClass(TH, 'color2');\r\n            if (col >=13 && col <= 20) applyClass(TH, 'color3');\r\n            if (col >=21 && col <= 27) applyClass(TH, 'color4');\r\n            if (col >=28 && col <= 30) applyClass(TH, 'color5');\r\n            if (col >=31 && col <= 34) applyClass(TH, 'color6');\r\n            if (col >=35 && col <= 43) applyClass(TH, 'color7');\r\n            if (col >=44 && col <= 46) applyClass(TH, 'color8');\r\n            if (col >=47 && col <= 50) applyClass(TH, 'color9');\r\n        }\r\n    }\r\n\r\n    // Finished pick list setter function\r\n    setPickList(name) {\r\n        return new Promise ((res, rej) => {\r\n\r\n            const value = `${name}Picklist_value`;\r\n            const key = `${name}Picklist`;\r\n\r\n            this.restApi.callApi('getPickList', {\r\n                token: this.props.token,\r\n                pickListName: key\r\n\r\n            }).then((response) => {\r\n\r\n                if (response.pickList.length > 0) {\r\n                     const list = response.pickList.map((item) => {\r\n                        return item[value];\r\n                    })\r\n                    res(list)\r\n                }\r\n            }).catch((error) => {\r\n                console.log(error)\r\n            });\r\n        })\r\n    }\r\n\r\n    // Finished revision row makeup\r\n    iterateRevisionRows() {\r\n\r\n        const rc = this.hot.countRows();\r\n        const cc = this.hot.countCols();\r\n\r\n        for (let r = 0; r <= rc; r++) {\r\n            const value = this.hot.getDataAtRowProp(r, 'archived');\r\n            if (value === 'YES' || value === \"Yes\" || value === \"yes\") {\r\n                for (let c = 0; c <= cc; c++) {\r\n                    this.hot.setCellMeta(r, c, 'renderer', (instance, td) => {\r\n\r\n                        const {showHistory} = this.state;\r\n                        if (showHistory)\r\n                            td.classList.add('revision-row');\r\n                    })\r\n                }\r\n            }\r\n        }\r\n        this.hot.render();\r\n    }\r\n\r\n    // Read the rule from imported rule file\r\n    mandatoryColumnExtractor() {\r\n        return groupingMap.reduce((fullArr, item) => {\r\n            const cols = item.columns.reduce((arr, col) => {\r\n                if (col.mandatory) arr.push(col.data)\r\n                return arr;\r\n            }, []);\r\n            return [...fullArr, ...cols]\r\n        }, [])\r\n    }\r\n\r\n    // Read the rule from imported rule file\r\n    ruleExtractor(columnId) {\r\n        return columnLogic.find((item) => {\r\n            return item.id === columnId;\r\n        })\r\n    }\r\n\r\n    // Generic attributes validations and rule runner\r\n    async columnEvents(r, c, newV) {\r\n\r\n        this.validatedCell.r = r;\r\n        this.validatedCell.c = c;\r\n\r\n        const properties = this.ruleExtractor(c);\r\n        if (properties) {\r\n            const {methodCaller, rules, executeRules, paramName, additionalParams} = properties;\r\n\r\n            if (methodCaller) {\r\n                // we understand that this logic needs to call api\r\n\r\n                // default dto\r\n                let dto = {\r\n                    token: this.props.token,\r\n                    [paramName]: this.hot.getDataAtRowProp(r, c)\r\n                };\r\n\r\n                if (typeof additionalParams !== 'undefined' &&\r\n                    typeof additionalParams === 'object') {\r\n\r\n                    // create addition parameter to bind exact one\r\n                    const additionalDTO = additionalParams.map((prop) => {\r\n                        return {[prop]: this.hot.getDataAtRowProp(r, prop)}\r\n                    });\r\n\r\n                    // dto with additional parameters\r\n                    dto = Object.assign({}, dto, ...additionalDTO);\r\n                }\r\n\r\n                // method caller and logic execution\r\n                //await this.genericCL(methodCaller, dto);\r\n                this.restApi.callApi(methodCaller, dto).then((response) => {\r\n\r\n                    if (typeof response.isExist !== 'undefined') {\r\n\r\n                        if (!response.isExist) {\r\n                            // value is not exist in DB, show message\r\n                            this.showMessage(this.errorBoxTitle, this.errorMessages[c], true);\r\n                            return false;\r\n\r\n                        } else {\r\n                            // value is exist in DB, check other rules associated with that one\r\n                            if (executeRules && executeRules.length > 0) {\r\n                                executeRules.map(props => {\r\n\r\n                                    const {propId} = props;\r\n                                    const data = this.hot.getDataAtRowProp(r, propId)\r\n\r\n                                    this.columnEvents(r, propId, data)\r\n                                })\r\n                            }\r\n                        }\r\n                    } else {\r\n                        rules[0].changedValue = response.List.map(i => {return i.value})\r\n                        this.staticRules(r, null, rules);\r\n                    }\r\n                })\r\n\r\n            } else {\r\n                this.staticRules(r, newV, rules)\r\n            }\r\n        }\r\n    }\r\n\r\n    staticRules(r, value, rules) {\r\n        if (rules) {\r\n            rules.map((item) => {\r\n                if (value !== null && item.columnValue === value) {\r\n                    // status changes\r\n                    this.hot.setDataAtRowProp(r, item.changedId, item.changedValue);\r\n                } else {\r\n                    this.hot.setCellMeta(r, this.hot.propToCol(item.changedId), 'source', item.changedValue);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n\r\n    handleExport() {\r\n        const {token, region} = this.props;\r\n\r\n        this.restApi.callApi('exportData', {\r\n            region,\r\n            token\r\n        }).then(response => {\r\n            const today = new Date();\r\n            //const todayDate =  '_' + today.getDate() +  (today.toLocaleString('default', { month: 'long' })) + today.getFullYear();\r\n\r\n            const todayDate = '_' + today.getFullYear() + '-' + (today.getMonth()+1) + '-' + today.getDate() + 'T' + today.getHours() + ':::' + today.getMinutes()\r\n\r\n            const ws = XLSX.utils.json_to_sheet(response.ExportedExcelAsJSON);\r\n            const wb = { Sheets: { 'data': ws }, SheetNames: ['data'] };\r\n            const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\r\n            const data = new Blob([excelBuffer], {type: 'xlsx'});\r\n\r\n           // saveAs(data, `DataMatrix${todayDate}.xlsx`);\r\n            saveAs(data, `Exported_RANConn${todayDate}.xlsx`);\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\r\n        return nextState.isDataExistsInDB !== this.state.isDataExistsInDB ||\r\n            nextState.activePage !== this.state.activePage ||\r\n            nextState.totalCountOfData !== this.state.totalCountOfData ||\r\n            nextState.newRowAdded !== this.state.newRowAdded\r\n    }\r\n\r\n    render() {\r\n        const {maximize, language, contentCSS} = this.props;\r\n\r\n        if (language) {\r\n            this.errorBoxTitle = language.validationMessageBoxTitle;\r\n            this.errorMessages = language.validationErrorMessages;\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <Header/>\r\n                <Row className=\"h-100\">\r\n                    <Sidebar maximize={maximize}/>\r\n                    <Col className={contentCSS}>\r\n                        <Toolbar\r\n                            wrapper={'toolbar mt-2'}\r\n                            isDataExist={this.state.isDataExistsInDB}\r\n                            newRowAdded={this.state.newRowAdded}\r\n                            exportClick={this.handleExport.bind(this)}\r\n                            newClick={this.handleNewRowClick.bind(this)}\r\n                            editClick={this.handleEditClick.bind(this)}\r\n                            cancelClick={this.handleCancelClick.bind(this)}\r\n                            saveClick={this.handleSaveClick.bind(this)}\r\n                            saveHistoryClick={this.handleSaveHistoryClick.bind(this)}\r\n                            historyToggle={this.handleHistoryToggle.bind(this)}\r\n                            handleRegionChange={this.dataLoad.bind(this)}\r\n                            handleRadioSiteChange={this.dataLoad.bind(this)}\r\n                        />\r\n\r\n                        <Card className={'mt-1 fixedCard'}>\r\n                            <CardBody>\r\n                                <HotTable ref={this.hotTableComponent} id={'hot'}\r\n                                  rowHeaders={true}\r\n                                  licenseKey={'non-commercial-and-evaluation'}\r\n                                  nestedHeaders={this.columnHeaders}\r\n                                  columns={this.columns}\r\n                                  stretchH={'all'}\r\n                                  dropdownMenu={true}\r\n                                  filters={true}\r\n                                  manualColumnResize={true}\r\n                                  width={'100%'}\r\n                                  height={'100%'}\r\n                                  fixedColumnsLeft={0}\r\n                                  columnSorting={true}\r\n                                  currentRowClassName={['bg-primary', 'text-white']}\r\n                                  enterBeginsEditing={false}\r\n                                  outsideClickDeselects={false}\r\n                                  enterMoves={this.disableMoves()}\r\n                                  fillHandle={this.disableMoves()}\r\n                                  afterValidate={(isValid, value, row, prop) => {\r\n                                      // this is check dropdown values are proper or not.\r\n                                      this.validatedCell.r = row;\r\n                                      this.validatedCell.c = prop;\r\n                                  }}\r\n                                  afterGetColHeader={(col, TH) => {\r\n                                      this.headerColoring(col, TH)\r\n                                  }}\r\n                                  afterCreateRow={(index, amount, source) => {\r\n                                      console.log(index, amount, source)\r\n                                  }}\r\n                                  afterChange={(changes) => {\r\n                                      // TODO: check esc button when its clicked\r\n                                      if (changes) {\r\n                                          const [r, c, oldV, newV] = changes[0];\r\n                                          //&& !this.state.newRowAdded\r\n                                          if (oldV !== newV)\r\n                                            this.columnEvents(r, c, newV);\r\n                                      }\r\n                                  }}\r\n                                />\r\n\r\n                                {!this.state.isDataExistsInDB &&\r\n                                <div className={'empty-data'}>\r\n                                    <Jumbotron className=\"empty-data-content\">\r\n                                        <h1 className=\"display-5\">{language.emptyDataMatrix.title}</h1>\r\n                                        <p className=\"lead\">{language.emptyDataMatrix.spot}</p>\r\n                                        <hr className=\"my-2\" />\r\n                                        <p>{language.emptyDataMatrix.text}</p>\r\n                                    </Jumbotron>\r\n                                </div>\r\n                                }\r\n                            </CardBody>\r\n\r\n                            <CardFooter className={'text-center'}>\r\n                                <PaginationMatrix\r\n                                    activePage={this.state.activePage}\r\n                                    itemPerPage={this.state.itemPerPage}\r\n                                    totalCountOfData={this.state.totalCountOfData}\r\n                                    handlePageChange={this.handlePageChange.bind(this)}\r\n                                />\r\n                            </CardFooter>\r\n                        </Card>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <ModalTemplate/>\r\n                <Spinner/>\r\n            </>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        token: state.token,\r\n        user: state.user,\r\n        language: state.language,\r\n        maximize: state.maximize,\r\n        contentCSS: state.contentCSS,\r\n        region: state.region,\r\n        radioSite: state.radioSite,\r\n        spinnerToggle: state.spinnerToggle\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setEdit: () => dispatch(editOnToggle()),\r\n        setSpinner: () => dispatch(spinnerToggle()),\r\n    }\r\n\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Matrix);"]},"metadata":{},"sourceType":"module"}