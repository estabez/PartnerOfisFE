{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\soperasyon27\\\\Desktop\\\\FE\\\\src18mart\\\\src\\\\src\\\\views\\\\Ran.jsx\";\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport Toolbar from '../components/TopologyToolbar';\nimport Header from \"../components/Header\";\nimport Sidebar from \"../components/Sidebar\";\nimport ModalTemplate from '../components/Modal';\nimport TopologyDiagram from '../components/TopologyDiagram';\nimport { modalToggle, modalTitle, setTopologyFirstLevel, setTopologySecondLevel, setTopologySecondLevelDropdownLabels } from \"../redux/actions\";\nimport IconModule from '../IconModule';\nimport RestApiModule from '../RestApiModule';\nimport AlertModule from '../AlertModule';\nimport EmptyDataset from \"../components/EmptyDataset\";\nimport { Card, CardBody } from 'reactstrap';\n\nclass Ran extends React.Component {\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n    this.events = {\n      doubleClick: event => {\n        const {\n          nodes\n        } = event;\n        const nodeID = nodes[0];\n\n        if (nodeID) {\n          // type must be aggreg_site\n          const node = this.props.graph.nodes.find(item => {\n            return item.id === nodeID;\n          });\n\n          if (node.type === 'AGGREGATE_SITE') {\n            this.getDataByAggregSite(nodeID);\n            this.props.setModalTitle(nodeID);\n          }\n        }\n      }\n    };\n    this.Icons = new IconModule();\n    this.restApi = new RestApiModule();\n    this.alert = new AlertModule();\n    this.state = {\n      firstLevelData: null,\n      dropdownLabels: null,\n      dataExist: true\n    };\n    this.unformatedData = null;\n    this.unformatedDataSecondLevel = null;\n    this.today = new Date();\n    this.todayDate = '_' + this.today.getDate() + this.today.toLocaleString('default', {\n      month: 'long'\n    }) + this.today.getFullYear();\n    this.fileName = 'RanTopology' + this.todayDate + '.png'; // init first data\n\n    this.getDataByRegion();\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  setStateAsync(state) {\n    return new Promise(resolve => {\n      this.setState(state, resolve);\n    });\n  }\n\n  getDataByRegion() {\n    const {\n      token,\n      region\n    } = this.props;\n    this.restApi.callApi('ranFirst', {\n      token,\n      region\n    }).then(async response => {\n      const d = response.RANTopologyFirstLevelViewData;\n\n      if (this._isMounted && d && d.length > 0) {\n        await this.setStateAsync({\n          firstLevelData: d,\n          dataExist: true\n        });\n        this.prepareFirstLevelData();\n      } else {\n        this.setStateAsync({\n          dataExist: false\n        });\n      }\n    }).catch(error => {\n      console.log(error);\n      this.setStateAsync({\n        dataExist: false\n      });\n    });\n  }\n\n  async getDataByAggregSite(id) {\n    const {\n      token\n    } = this.props;\n    this.restApi.callApi('ranSecond', {\n      selectedNode: id,\n      token\n    }).then(async response => {\n      const d = response.RANTopologySecondLevelViewData;\n      if (d.length > 0) await this.prepareSecondLevelData(d, id);\n      this.props.setModal();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  prepareFirstLevelData() {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, type, Icons) {\n      if (type === 'AGGREGATE_SITE') {\n        labels.push(id);\n      }\n\n      nodes.push({\n        id: id,\n        label: id,\n        type: type,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        size: 25,\n        image: Icons.getIconForNode(type)\n      });\n    }\n\n    this.state.firstLevelData.map(item => {\n      const indexA = nodes.findIndex(data => data.id === item.NODE_A);\n\n      if (indexA < 0) {\n        pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\n      }\n\n      const indexB = nodes.findIndex(data => data.id === item.NODE_B);\n\n      if (indexB < 0) {\n        pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\n      }\n\n      edges.push({\n        from: item.NODE_A,\n        to: item.NODE_B\n      });\n    }); // this row for store the first state of graph data.\n    // Once we select a node, it will turn to red font, others will stay black.\n\n    this.unformatedData = {\n      nodes,\n      edges\n    }; // once the data is ready to show, redux is updating.\n\n    this.props.setTopologyFirstLevel({\n      nodes,\n      edges\n    });\n    this.setState({\n      dropdownLabels: labels.sort()\n    });\n  }\n\n  prepareSecondLevelData(data, aggregSite) {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, Icons) {\n      const radioIcon = Icons.getIconForNode('RADIO_SITE');\n      const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\n      nodes.push({\n        id: id,\n        label: id,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        size: 25,\n        image: id === aggregSite ? aggregIcon : radioIcon\n      });\n      if (id !== aggregSite) labels.push(id);\n    }\n\n    if (data) {\n      data.map(item => {\n        const indexA = nodes.findIndex(data => data.id === item.A_SITE);\n\n        if (indexA < 0) {\n          pushItem(item.A_SITE, this.Icons);\n        }\n\n        const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\n\n        if (indexB < 0) {\n          pushItem(item.Z_SITE, this.Icons);\n        }\n\n        edges.push({\n          from: item.A_SITE,\n          to: item.Z_SITE\n        });\n      }); // this row for store the first state of graph data.\n      // Once we select a node, it will turn to red font, others will stay black.\n\n      this.unformatedDataSecondLevel = {\n        nodes,\n        edges\n      }; // set the second level topology diagram.\n      // It will update the redux and it trigger to rerender of modal window.\n\n      this.props.setTopologySecondLevel({\n        nodes,\n        edges\n      }); // set the secondLevel topology view dropdown list\n\n      this.props.setTopologySecondLevelDropDown({\n        dropdownList: labels\n      });\n    }\n  }\n\n  async handleSelectAggregSite(selectedNodeId) {\n    let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\n\n    if (newGraph) {\n      newGraph.nodes.map(node => {\n        if (node.id === selectedNodeId) {\n          node.font = {\n            color: 'red',\n            size: this.props.fontSize\n          };\n          node.size = 40;\n        }\n      });\n      this.props.setTopologyFirstLevel(newGraph);\n    }\n  }\n\n  render() {\n    const {\n      language,\n      maximize,\n      contentCSS,\n      graph\n    } = this.props;\n    const diagramAreaIdLevelOne = 'diagramLevel1';\n    const diagramAreaIdLevelTwo = 'diagramLevel2';\n\n    if (language !== null) {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row h-100\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Sidebar, {\n        maximize: maximize,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: contentCSS,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Toolbar, {\n        wrapper: 'card toolbar mt-2',\n        labels: this.state.dropdownLabels,\n        handleAggregSiteChange: this.handleSelectAggregSite.bind(this),\n        handleRegionChange: this.getDataByRegion.bind(this),\n        topologyLevel: 1,\n        diagramAreaId: diagramAreaIdLevelOne,\n        snapshotFileName: this.fileName,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(Card, {\n        id: diagramAreaIdLevelOne,\n        className: 'mt-1 fixedCard',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(CardBody, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: 'topologyViewHeader',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 37\n        }\n      }, language.ranTopology), this.state.dataExist && graph && /*#__PURE__*/React.createElement(TopologyDiagram, {\n        id: 'diagramLevel1',\n        height: '95%',\n        graph: graph,\n        events: this.events,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 37\n        }\n      }), !this.state.dataExist && /*#__PURE__*/React.createElement(EmptyDataset, {\n        page: 'ran',\n        showButton: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 37\n        }\n      }))))), /*#__PURE__*/React.createElement(ModalTemplate, {\n        diagramAreaId: diagramAreaIdLevelTwo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 21\n        }\n      }));\n    } else {\n      return /*#__PURE__*/React.createElement(React.Fragment, null);\n    }\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    token: state.token,\n    region: state.region,\n    language: state.language,\n    maximize: state.maximize,\n    contentCSS: state.contentCSS,\n    graph: state.topologyFirstLevel,\n    fontSize: state.topologySelectedNodeFontSize,\n    authUser: state.user\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    setModal: () => dispatch(modalToggle()),\n    setModalTitle: content => dispatch(modalTitle(content)),\n    setTopologyFirstLevel: graph => dispatch(setTopologyFirstLevel(graph)),\n    setTopologySecondLevel: graph => dispatch(setTopologySecondLevel(graph)),\n    setTopologySecondLevelDropDown: labels => dispatch(setTopologySecondLevelDropdownLabels(labels))\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);","map":{"version":3,"sources":["C:/Users/soperasyon27/Desktop/FE/src18mart/src/src/views/Ran.jsx"],"names":["React","connect","Toolbar","Header","Sidebar","ModalTemplate","TopologyDiagram","modalToggle","modalTitle","setTopologyFirstLevel","setTopologySecondLevel","setTopologySecondLevelDropdownLabels","IconModule","RestApiModule","AlertModule","EmptyDataset","Card","CardBody","Ran","Component","constructor","props","_isMounted","events","doubleClick","event","nodes","nodeID","node","graph","find","item","id","type","getDataByAggregSite","setModalTitle","Icons","restApi","alert","state","firstLevelData","dropdownLabels","dataExist","unformatedData","unformatedDataSecondLevel","today","Date","todayDate","getDate","toLocaleString","month","getFullYear","fileName","getDataByRegion","componentDidMount","componentWillUnmount","setStateAsync","Promise","resolve","setState","token","region","callApi","then","response","d","RANTopologyFirstLevelViewData","length","prepareFirstLevelData","catch","error","console","log","selectedNode","RANTopologySecondLevelViewData","prepareSecondLevelData","setModal","edges","labels","pushItem","push","label","shape","font","color","size","image","getIconForNode","map","indexA","findIndex","data","NODE_A","NODE_A_TYPE","indexB","NODE_B","NODE_B_TYPE","from","to","sort","aggregSite","radioIcon","aggregIcon","A_SITE","Z_SITE","setTopologySecondLevelDropDown","dropdownList","handleSelectAggregSite","selectedNodeId","newGraph","JSON","parse","stringify","fontSize","render","language","maximize","contentCSS","diagramAreaIdLevelOne","diagramAreaIdLevelTwo","bind","ranTopology","mapStateToProps","topologyFirstLevel","topologySelectedNodeFontSize","authUser","user","mapDispatchToProps","dispatch","content"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {connect} from \"react-redux\";\r\n\r\nimport Toolbar from '../components/TopologyToolbar'\r\nimport Header from \"../components/Header\";\r\nimport Sidebar from \"../components/Sidebar\";\r\nimport ModalTemplate from '../components/Modal'\r\nimport TopologyDiagram from '../components/TopologyDiagram'\r\nimport {\r\n    modalToggle, modalTitle,\r\n    setTopologyFirstLevel,\r\n    setTopologySecondLevel,\r\n    setTopologySecondLevelDropdownLabels\r\n} from \"../redux/actions\";\r\n\r\nimport IconModule from '../IconModule';\r\nimport RestApiModule from '../RestApiModule'\r\nimport AlertModule from '../AlertModule'\r\nimport EmptyDataset from \"../components/EmptyDataset\";\r\nimport {Card, CardBody} from 'reactstrap';\r\n\r\n\r\nclass Ran extends React.Component {\r\n    _isMounted = false;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.Icons = new IconModule();\r\n        this.restApi = new RestApiModule();\r\n        this.alert = new AlertModule();\r\n\r\n        this.state = {\r\n            firstLevelData: null,\r\n            dropdownLabels: null,\r\n            dataExist: true\r\n        }\r\n\r\n        this.unformatedData = null\r\n        this.unformatedDataSecondLevel = null\r\n\r\n        this.today = new Date();\r\n        this.todayDate = '_' + this.today.getDate() +  (this.today.toLocaleString('default', { month: 'long' })) + this.today.getFullYear();\r\n        this.fileName = 'RanTopology' + this.todayDate + '.png';\r\n\r\n        // init first data\r\n        this.getDataByRegion();\r\n    }\r\n\r\n    events = {\r\n        doubleClick: (event) => {\r\n            const {nodes} = event;\r\n            const nodeID = nodes[0];\r\n\r\n            if (nodeID) {\r\n                // type must be aggreg_site\r\n                const node = this.props.graph.nodes.find((item) => {\r\n                    return item.id === nodeID\r\n                });\r\n                if (node.type === 'AGGREGATE_SITE') {\r\n                    this.getDataByAggregSite(nodeID);\r\n\r\n                    this.props.setModalTitle(nodeID);\r\n\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    componentDidMount() {\r\n        this._isMounted = true;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this._isMounted = false;\r\n    }\r\n\r\n    setStateAsync(state) {\r\n        return new Promise((resolve) => {\r\n            this.setState(state, resolve)\r\n        });\r\n    }\r\n\r\n    getDataByRegion() {\r\n\r\n        const {token, region} = this.props;\r\n\r\n        this.restApi.callApi('ranFirst', {\r\n            token,\r\n            region\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologyFirstLevelViewData;\r\n\r\n            if (this._isMounted && (d && d.length > 0)) {\r\n                await this.setStateAsync({firstLevelData: d, dataExist: true});\r\n\r\n                this.prepareFirstLevelData();\r\n\r\n            } else {\r\n                this.setStateAsync({dataExist: false})\r\n            }\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n            this.setStateAsync({dataExist: false})\r\n        });\r\n\r\n    }\r\n\r\n    async getDataByAggregSite(id) {\r\n\r\n        const {token} = this.props;\r\n\r\n        this.restApi.callApi('ranSecond', {\r\n            selectedNode: id,\r\n            token\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologySecondLevelViewData;\r\n\r\n            if (d.length > 0) await this.prepareSecondLevelData(d, id);\r\n\r\n            this.props.setModal();\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n    }\r\n\r\n    prepareFirstLevelData() {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, type, Icons) {\r\n\r\n            if (type === 'AGGREGATE_SITE') {\r\n                labels.push(id);\r\n            }\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                type: type,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                size: 25,\r\n                image: Icons.getIconForNode(type)\r\n            })\r\n        }\r\n\r\n        this.state.firstLevelData.map((item) => {\r\n\r\n            const indexA = nodes.findIndex(data => data.id === item.NODE_A);\r\n            if (indexA < 0) {\r\n                pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\r\n            }\r\n\r\n            const indexB = nodes.findIndex(data => data.id === item.NODE_B);\r\n            if (indexB < 0) {\r\n                pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\r\n            }\r\n\r\n            edges.push({\r\n                from: item.NODE_A,\r\n                to: item.NODE_B\r\n            });\r\n        });\r\n\r\n        // this row for store the first state of graph data.\r\n        // Once we select a node, it will turn to red font, others will stay black.\r\n        this.unformatedData = {nodes, edges};\r\n\r\n        // once the data is ready to show, redux is updating.\r\n        this.props.setTopologyFirstLevel({\r\n            nodes,\r\n            edges\r\n        });\r\n\r\n        this.setState({dropdownLabels: labels.sort()});\r\n\r\n    }\r\n\r\n    prepareSecondLevelData(data, aggregSite) {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, Icons) {\r\n\r\n            const radioIcon = Icons.getIconForNode('RADIO_SITE');\r\n            const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\r\n\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                size: 25,\r\n                image: id === aggregSite ? aggregIcon : radioIcon\r\n            })\r\n\r\n            if (id !== aggregSite) labels.push(id);\r\n        }\r\n\r\n        if (data) {\r\n            data.map((item) => {\r\n\r\n                const indexA = nodes.findIndex(data => data.id === item.A_SITE);\r\n                if (indexA < 0) {\r\n                    pushItem(item.A_SITE, this.Icons);\r\n                }\r\n\r\n                const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\r\n                if (indexB < 0) {\r\n                    pushItem(item.Z_SITE, this.Icons);\r\n                }\r\n\r\n                edges.push({\r\n                    from: item.A_SITE,\r\n                    to: item.Z_SITE\r\n                });\r\n            });\r\n\r\n            // this row for store the first state of graph data.\r\n            // Once we select a node, it will turn to red font, others will stay black.\r\n            this.unformatedDataSecondLevel = {nodes, edges};\r\n\r\n            // set the second level topology diagram.\r\n            // It will update the redux and it trigger to rerender of modal window.\r\n            this.props.setTopologySecondLevel({\r\n                nodes,\r\n                edges\r\n            });\r\n\r\n            // set the secondLevel topology view dropdown list\r\n            this.props.setTopologySecondLevelDropDown({\r\n                dropdownList: labels\r\n            })\r\n        }\r\n    }\r\n\r\n    async handleSelectAggregSite(selectedNodeId) {\r\n\r\n        let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\r\n\r\n        if (newGraph) {\r\n            newGraph.nodes.map((node) => {\r\n                if (node.id === selectedNodeId) {\r\n                    node.font = {color: 'red', size: this.props.fontSize};\r\n                    node.size = 40;\r\n                }\r\n            });\r\n            this.props.setTopologyFirstLevel(newGraph);\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const {language, maximize, contentCSS, graph} = this.props;\r\n        const diagramAreaIdLevelOne = 'diagramLevel1';\r\n        const diagramAreaIdLevelTwo = 'diagramLevel2';\r\n\r\n        if (language !== null) {\r\n            return (\r\n                <>\r\n                    <Header/>\r\n                    <div className=\"row h-100\">\r\n                        <Sidebar maximize={maximize}/>\r\n\r\n                        <div className={contentCSS}>\r\n\r\n                            <Toolbar wrapper={'card toolbar mt-2'}\r\n                                     labels={this.state.dropdownLabels}\r\n                                     handleAggregSiteChange={this.handleSelectAggregSite.bind(this)}\r\n                                     handleRegionChange={this.getDataByRegion.bind(this)}\r\n                                     topologyLevel={1}\r\n                                     diagramAreaId={diagramAreaIdLevelOne}\r\n                                     snapshotFileName={this.fileName}\r\n                            />\r\n\r\n                            <Card id={diagramAreaIdLevelOne} className={'mt-1 fixedCard'}>\r\n                                <CardBody>\r\n                                    <h4 className={'topologyViewHeader'}>{language.ranTopology}</h4>\r\n\r\n                                    {(this.state.dataExist && graph) &&\r\n                                    <TopologyDiagram\r\n                                        id={'diagramLevel1'}\r\n                                        height={'95%'}\r\n                                        graph={graph}\r\n                                        events={this.events}/>\r\n                                    }\r\n\r\n                                    {!this.state.dataExist &&\r\n                                    <EmptyDataset page={'ran'} showButton={true}/>\r\n                                    }\r\n                                </CardBody>\r\n                            </Card>\r\n                        </div>\r\n                    </div>\r\n                    <ModalTemplate diagramAreaId={diagramAreaIdLevelTwo} />\r\n                </>\r\n            )\r\n        } else {\r\n            return (<></>);\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        token: state.token,\r\n        region: state.region,\r\n        language: state.language,\r\n        maximize: state.maximize,\r\n        contentCSS: state.contentCSS,\r\n        graph: state.topologyFirstLevel,\r\n        fontSize: state.topologySelectedNodeFontSize,\r\n        authUser: state.user\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setModal: () => dispatch(modalToggle()),\r\n        setModalTitle: (content) => dispatch(modalTitle(content)),\r\n        setTopologyFirstLevel: (graph) => dispatch(setTopologyFirstLevel(graph)),\r\n        setTopologySecondLevel: (graph) => dispatch(setTopologySecondLevel(graph)),\r\n        setTopologySecondLevelDropDown: (labels) => dispatch(setTopologySecondLevelDropdownLabels(labels))\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);"]},"metadata":{},"sourceType":"module"}