{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{connect}from\"react-redux\";import{Modal,ModalHeader,ModalBody}from'reactstrap';import{modalImportToggle,spinnerToggle}from\"../redux/actions\";import FileUploadProgress from'react-fileupload-progress';import XLSX from\"xlsx\";import{make_cols}from\"./MakeColumns\";import{SheetJSFT}from'./types';var styles={progressWrapper:{height:'25px',marginTop:'10px',marginBottom:'10px',width:'100%',float:'left',overflow:'hidden',backgroundColor:'#f5f5f5',borderRadius:'4px',WebkitBoxShadow:'inset 0 1px 2px rgba(0,0,0,.1)',boxShadow:'inset 0 1px 2px rgba(0,0,0,.1)'},progressBar:{float:'left',width:'0',height:'100%',fontSize:'12px',lineHeight:'20px',color:'#fff',textAlign:'center',backgroundColor:'#5cb85c',WebkitBoxShadow:'inset 0 -1px 0 rgba(0,0,0,.15)',boxShadow:'inset 0 -1px 0 rgba(0,0,0,.15)',WebkitTransition:'width .6s ease',Otransition:'width .6s ease',transition:'width .6s ease'},cancelButton:{marginTop:'5px',WebkitAppearance:'none',padding:0,cursor:'pointer',background:'0 0',border:0,float:'left',fontSize:'21px',fontWeight:700,lineHeight:1,color:'#000',textShadow:'0 1px 0 #fff',filter:'alpha(opacity=20)',opacity:'.2'},bslabel:{display:'inline-block',maxWidth:'100%',marginBottom:'5px',fontWeight:700},bsHelp:{display:'block',marginTop:'5px',marginBottom:'10px',color:'#737373'},bsButton:{padding:'1px 5px',fontSize:'12px',lineHeight:'1.5',borderRadius:'3px',color:'#fff',backgroundColor:'#337ab7',borderColor:'#2e6da4',display:'inline-block',marginBottom:0,fontWeight:400,textAlign:'center',whiteSpace:'nowrap',verticalAlign:'middle',touchAction:'manipulation',cursor:'pointer',WebkitUserSelect:'none',MozUserSelect:'none',msUserSelect:'none',userSelect:'none',backgroundImage:'none',border:'1px solid transparent'}};var ModalImportTemplate=/*#__PURE__*/function(_React$Component){_inherits(ModalImportTemplate,_React$Component);function ModalImportTemplate(props){var _this;_classCallCheck(this,ModalImportTemplate);_this=_possibleConstructorReturn(this,_getPrototypeOf(ModalImportTemplate).call(this,props));_this.triggerInputFile=function(){return _this.fileInput.click();};_this.state={file:{},data:[],cols:[],fileJSON:{},loading:true,isUploadDisabled:true,isValidateDisabled:true,uploadHasError:true,uploadProgress:0,showProgress:false};_this.showProgress=false;_this.handleFile=_this.handleFile.bind(_assertThisInitialized(_this));_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));return _this;}_createClass(ModalImportTemplate,[{key:\"handleChange\",value:function handleChange(e){this.chosenFile.innerText=e.target.files[0].name;var files=e.target.files;this.setState({isUploadDisabled:false});if(files&&files[0])this.setState({file:files[0]});}},{key:\"handleFile\",value:function handleFile(){var _this2=this;/* Boilerplate to set up FileReader */this.setState({showProgress:true});this.props.setSpinner();try{var reader=new FileReader();var rABS=!!reader.readAsBinaryString;reader.onload=function(e){/* Parse data */var bstr=e.target.result;var wb=XLSX.read(bstr,{type:rABS?'binary':'array',bookVBA:true});/* Get first worksheet */var wsname=wb.SheetNames[0];var ws=wb.Sheets[wsname];/* Convert array of arrays */var data=XLSX.utils.sheet_to_json(ws);/* Update state */_this2.setState({data:data,cols:make_cols(ws['!ref'])},function(){_this2.state.fileJSON=JSON.stringify(_this2.state.data,null,2);console.log(_this2.state.fileJSON);});_this2.setState({isValidateDisabled:false,uploadHasError:false,uploadProgress:100});_this2.props.setSpinner();};if(rABS){reader.readAsBinaryString(this.state.file);}else{reader.readAsArrayBuffer(this.state.file);};}catch(e){this.setState({isValidateDisabled:true,uploadHasError:true,uploadProgress:100});this.props.setSpinner();}}},{key:\"toggle\",value:function toggle(){this.props.setModalImport();}},{key:\"customFormRenderer\",//json to txt\nvalue:function customFormRenderer(onSubmit){var _this3=this;var language=this.props.language;return React.createElement(\"form\",{id:\"customForm\",style:{marginBottom:'15px'}},React.createElement(\"div\",{className:'row'},React.createElement(\"div\",{className:'col-2'},React.createElement(\"button\",{type:\"button\",className:'btn btn-primary btn-block',onClick:this.triggerInputFile},language.import),React.createElement(\"input\",_defineProperty({ref:function ref(fileInput){return _this3.fileInput=fileInput;},style:{display:'block'},type:\"file\",id:\"file\",accept:SheetJSFT,onChange:this.handleChange,hidden:true,name:\"file\"},\"id\",\"exampleInputFile\"))),React.createElement(\"div\",{className:'col-10'},React.createElement(\"p\",{ref:function ref(chosenFile){return _this3.chosenFile=chosenFile;},style:styles.bsHelp},language.noFileChosen))),React.createElement(\"div\",{className:'row'},React.createElement(\"div\",{className:'col-2 mt-4'},React.createElement(\"button\",{type:\"button\",className:'btn btn-secondary btn-block',onClick:this.handleFile,disabled:this.state.isUploadDisabled},language.upload)),React.createElement(\"div\",{className:'col-10'},React.createElement(\"div\",{ref:function ref(uploadProgressBar){return _this3.uploadProgressBar=uploadProgressBar;},className:'mt-3'},this.state.showProgress&&this.customProgressRenderer(this.state.uploadProgress,this.state.uploadHasError)))),React.createElement(\"hr\",null),React.createElement(\"div\",{className:'row'},React.createElement(\"div\",{className:'col-4'},\" \"),React.createElement(\"div\",{className:'col-4 mt-4'},React.createElement(\"button\",{type:\"button\",ref:function ref(sendBackend){return _this3.sendBackend=sendBackend;},hidden:this.state.isValidateDisabled,className:'btn btn-success btn-block',onClick:onSubmit},language.validate)),React.createElement(\"div\",{className:'col-4'},React.createElement(\"div\",null,this.c))));}},{key:\"formGetter\",value:function formGetter(){return this.state.fileJSON;}},{key:\"customProgressRenderer\",value:function customProgressRenderer(progress,hasError,cancelHandler){if(hasError||progress>-1){var barStyle=Object.assign({},styles.progressBar);barStyle.width=progress+'%';var message=React.createElement(\"span\",null,barStyle.width);if(hasError){barStyle.backgroundColor='#d9534f';message=React.createElement(\"span\",{style:{'color':'#a94442'}},\"Failed to upload ...\");}if(!hasError&&progress===100){message=React.createElement(\"span\",null,\"Done\");}return React.createElement(\"div\",null,React.createElement(\"div\",{style:styles.progressWrapper},React.createElement(\"div\",{style:barStyle})),React.createElement(\"div\",{className:'alert alert-info mt-2',style:{'clear':'left'}},message));}else{return;}}},{key:\"render\",value:function render(){var _this4=this;var language=this.props.language;if(language){return React.createElement(Modal,{isOpen:this.props.open,size:'lg',centered:true},React.createElement(ModalHeader,{toggle:this.toggle.bind(this)},language.importDataMatrixFile),React.createElement(ModalBody,null,React.createElement(FileUploadProgress,{key:\"ex2\",url:\"http://localhost:3000/api/upload\",method:\"post\",onProgress:function onProgress(e,request,progress){console.log('progress',e,request,progress);_this4.props.setSpinner();},onLoad:function onLoad(e,request){console.log('load',e,request);_this4.props.setSpinner();},onError:function onError(e,request){console.log('error',e,request);_this4.props.setSpinner();},onAbort:function onAbort(e,request){console.log('abort',e,request);_this4.props.setSpinner();},formGetter:this.formGetter.bind(this),formRenderer:this.customFormRenderer.bind(this),progressRenderer:this.customProgressRenderer.bind(this)})));}else{return React.createElement(React.Fragment,null);}}}]);return ModalImportTemplate;}(React.Component);function mapStateToProps(state){return{open:state.modalImportToggle,import:state.import,language:state.language};}function mapDispatchToProps(dispatch){return{setModalImport:function setModalImport(){return dispatch(modalImportToggle());},setSpinner:function setSpinner(){return dispatch(spinnerToggle());}};}export default connect(mapStateToProps,mapDispatchToProps)(ModalImportTemplate);","map":{"version":3,"sources":["C:/Users/ezerdon/Desktop/INWI/svn reps/E2E_Topology/E2ETopologyFrontend/src/src/components/ModalImport.jsx"],"names":["React","connect","Modal","ModalHeader","ModalBody","modalImportToggle","spinnerToggle","FileUploadProgress","XLSX","make_cols","SheetJSFT","styles","progressWrapper","height","marginTop","marginBottom","width","float","overflow","backgroundColor","borderRadius","WebkitBoxShadow","boxShadow","progressBar","fontSize","lineHeight","color","textAlign","WebkitTransition","Otransition","transition","cancelButton","WebkitAppearance","padding","cursor","background","border","fontWeight","textShadow","filter","opacity","bslabel","display","maxWidth","bsHelp","bsButton","borderColor","whiteSpace","verticalAlign","touchAction","WebkitUserSelect","MozUserSelect","msUserSelect","userSelect","backgroundImage","ModalImportTemplate","props","triggerInputFile","fileInput","click","state","file","data","cols","fileJSON","loading","isUploadDisabled","isValidateDisabled","uploadHasError","uploadProgress","showProgress","handleFile","bind","handleChange","e","chosenFile","innerText","target","files","name","setState","setSpinner","reader","FileReader","rABS","readAsBinaryString","onload","bstr","result","wb","read","type","bookVBA","wsname","SheetNames","ws","Sheets","utils","sheet_to_json","JSON","stringify","console","log","readAsArrayBuffer","setModalImport","onSubmit","language","import","noFileChosen","upload","uploadProgressBar","customProgressRenderer","sendBackend","validate","c","progress","hasError","cancelHandler","barStyle","Object","assign","message","open","toggle","importDataMatrixFile","request","formGetter","customFormRenderer","Component","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport {Modal, ModalHeader, ModalBody} from 'reactstrap';\r\nimport {modalImportToggle, spinnerToggle} from \"../redux/actions\";\r\nimport FileUploadProgress from 'react-fileupload-progress';\r\nimport XLSX from \"xlsx\";\r\nimport {make_cols} from \"./MakeColumns\";\r\nimport {SheetJSFT} from './types';\r\n\r\n\r\nconst styles = {\r\n    progressWrapper: {\r\n        height: '25px',\r\n        marginTop: '10px',\r\n        marginBottom: '10px',\r\n        width: '100%',\r\n        float: 'left',\r\n        overflow: 'hidden',\r\n        backgroundColor: '#f5f5f5',\r\n        borderRadius: '4px',\r\n        WebkitBoxShadow: 'inset 0 1px 2px rgba(0,0,0,.1)',\r\n        boxShadow: 'inset 0 1px 2px rgba(0,0,0,.1)'\r\n    },\r\n    progressBar: {\r\n        float: 'left',\r\n        width: '0',\r\n        height: '100%',\r\n        fontSize: '12px',\r\n        lineHeight: '20px',\r\n        color: '#fff',\r\n        textAlign: 'center',\r\n        backgroundColor: '#5cb85c',\r\n        WebkitBoxShadow: 'inset 0 -1px 0 rgba(0,0,0,.15)',\r\n        boxShadow: 'inset 0 -1px 0 rgba(0,0,0,.15)',\r\n        WebkitTransition: 'width .6s ease',\r\n        Otransition: 'width .6s ease',\r\n        transition: 'width .6s ease'\r\n    },\r\n    cancelButton: {\r\n        marginTop: '5px',\r\n        WebkitAppearance: 'none',\r\n        padding: 0,\r\n        cursor: 'pointer',\r\n        background: '0 0',\r\n        border: 0,\r\n        float: 'left',\r\n        fontSize: '21px',\r\n        fontWeight: 700,\r\n        lineHeight: 1,\r\n        color: '#000',\r\n        textShadow: '0 1px 0 #fff',\r\n        filter: 'alpha(opacity=20)',\r\n        opacity: '.2'\r\n    },\r\n\r\n    bslabel: {\r\n        display: 'inline-block',\r\n        maxWidth: '100%',\r\n        marginBottom: '5px',\r\n        fontWeight: 700\r\n    },\r\n\r\n    bsHelp: {\r\n        display: 'block',\r\n        marginTop: '5px',\r\n        marginBottom: '10px',\r\n        color: '#737373'\r\n    },\r\n\r\n    bsButton: {\r\n        padding: '1px 5px',\r\n        fontSize: '12px',\r\n        lineHeight: '1.5',\r\n        borderRadius: '3px',\r\n        color: '#fff',\r\n        backgroundColor: '#337ab7',\r\n        borderColor: '#2e6da4',\r\n        display: 'inline-block',\r\n        marginBottom: 0,\r\n        fontWeight: 400,\r\n        textAlign: 'center',\r\n        whiteSpace: 'nowrap',\r\n        verticalAlign: 'middle',\r\n        touchAction: 'manipulation',\r\n        cursor: 'pointer',\r\n        WebkitUserSelect: 'none',\r\n        MozUserSelect: 'none',\r\n        msUserSelect: 'none',\r\n        userSelect: 'none',\r\n        backgroundImage: 'none',\r\n        border: '1px solid transparent'\r\n    }\r\n};\r\n\r\n\r\nclass ModalImportTemplate extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            file: {},\r\n            data: [],\r\n            cols: [],\r\n            fileJSON: {},\r\n            loading: true,\r\n            isUploadDisabled: true,\r\n            isValidateDisabled: true,\r\n            uploadHasError: true,\r\n            uploadProgress: 0,\r\n            showProgress: false\r\n        }\r\n        this.showProgress = false;\r\n\r\n        this.handleFile = this.handleFile.bind(this);\r\n        this.handleChange = this.handleChange.bind(this);\r\n    }\r\n\r\n\r\n    handleChange(e) {\r\n        this.chosenFile.innerText = e.target.files[0].name;\r\n        const files = e.target.files;\r\n        this.setState({\r\n            isUploadDisabled: false\r\n        })\r\n        if (files && files[0]) this.setState({file: files[0]});\r\n    };\r\n\r\n    handleFile() {\r\n        /* Boilerplate to set up FileReader */\r\n        this.setState({\r\n            showProgress: true\r\n        })\r\n        this.props.setSpinner();\r\n        try {\r\n\r\n            const reader = new FileReader();\r\n            const rABS = !!reader.readAsBinaryString;\r\n            reader.onload = (e) => {\r\n                /* Parse data */\r\n                const bstr = e.target.result;\r\n                const wb = XLSX.read(bstr, {type: rABS ? 'binary' : 'array', bookVBA: true});\r\n                /* Get first worksheet */\r\n                const wsname = wb.SheetNames[0];\r\n                const ws = wb.Sheets[wsname];\r\n                /* Convert array of arrays */\r\n                const data = XLSX.utils.sheet_to_json(ws);\r\n                /* Update state */\r\n                this.setState({data: data, cols: make_cols(ws['!ref'])}, () => {\r\n                    this.state.fileJSON = JSON.stringify(this.state.data, null, 2);\r\n                    console.log(this.state.fileJSON);\r\n                });\r\n                this.setState({\r\n                    isValidateDisabled: false,\r\n                    uploadHasError: false,\r\n                    uploadProgress: 100\r\n                });\r\n                this.props.setSpinner();\r\n            };\r\n\r\n            if (rABS) {\r\n                reader.readAsBinaryString(this.state.file);\r\n            } else {\r\n                reader.readAsArrayBuffer(this.state.file);\r\n            }\r\n            ;\r\n\r\n        } catch (e) {\r\n            this.setState({\r\n                isValidateDisabled: true,\r\n                uploadHasError: true,\r\n                uploadProgress: 100\r\n            });\r\n            this.props.setSpinner();\r\n        }\r\n\r\n    }\r\n\r\n    toggle() {\r\n        this.props.setModalImport();\r\n    }\r\n\r\n    triggerInputFile = () => this.fileInput.click();\r\n//json to txt\r\n\r\n    customFormRenderer(onSubmit) {\r\n        const {language} = this.props;\r\n        return (\r\n            <form id='customForm' style={{marginBottom: '15px'}}>\r\n                <div className={'row'}>\r\n                    <div className={'col-2'}>\r\n                        <button type=\"button\" className={'btn btn-primary btn-block'}\r\n                                onClick={this.triggerInputFile}>{language.import}</button>\r\n                        <input ref={fileInput => this.fileInput = fileInput} style={{display: 'block'}} type=\"file\" id=\"file\"\r\n                               accept={SheetJSFT} onChange={this.handleChange} hidden={true} name='file' id=\"exampleInputFile\"/>\r\n                    </div>\r\n                    <div className={'col-10'}>\r\n                        <p ref={chosenFile => this.chosenFile = chosenFile} style={styles.bsHelp}>{language.noFileChosen}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={'row'}>\r\n                    <div className={'col-2 mt-4'}>\r\n                        <button type=\"button\" className={'btn btn-secondary btn-block'} onClick={this.handleFile}\r\n                                disabled={this.state.isUploadDisabled}>{language.upload}</button>\r\n                    </div>\r\n                    <div className={'col-10'}>\r\n                        <div ref={uploadProgressBar => this.uploadProgressBar = uploadProgressBar} className={'mt-3'}>\r\n                            {this.state.showProgress &&\r\n                            this.customProgressRenderer(this.state.uploadProgress, this.state.uploadHasError)\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <hr/>\r\n                <div className={'row'}>\r\n                    <div className={'col-4'}> </div>\r\n                    <div className={'col-4 mt-4'}>\r\n                        <button type=\"button\" ref={sendBackend => this.sendBackend = sendBackend}\r\n                                hidden={this.state.isValidateDisabled} className={'btn btn-success btn-block'}\r\n                                onClick={onSubmit}>{language.validate}</button>\r\n                    </div>\r\n                    <div className={'col-4'}>\r\n                        <div>\r\n                            {this.c}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    formGetter() {\r\n        return this.state.fileJSON;\r\n    }\r\n\r\n    customProgressRenderer(progress, hasError, cancelHandler) {\r\n        if (hasError || progress > -1) {\r\n            let barStyle = Object.assign({}, styles.progressBar);\r\n            barStyle.width = progress + '%';\r\n\r\n            let message = (<span>{barStyle.width}</span>);\r\n            if (hasError) {\r\n                barStyle.backgroundColor = '#d9534f';\r\n                message = (<span style={{'color': '#a94442'}}>Failed to upload ...</span>);\r\n            }\r\n            if (!hasError && progress === 100) {\r\n                message = (<span>Done</span>);\r\n            }\r\n\r\n            return (\r\n                <div>\r\n                    <div style={styles.progressWrapper}>\r\n                        <div style={barStyle}></div>\r\n                    </div>\r\n                    <div className={'alert alert-info mt-2'} style={{'clear': 'left'}}>\r\n                        {message}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } else {\r\n            return;\r\n        }\r\n    }\r\n\r\n\r\n    render() {\r\n        const {language} = this.props;\r\n        if (language) {\r\n            return (\r\n                <Modal isOpen={this.props.open} size={'lg'} centered={true}>\r\n                    <ModalHeader toggle={this.toggle.bind(this)}>{language.importDataMatrixFile}</ModalHeader>\r\n                    <ModalBody>\r\n                        <FileUploadProgress key='ex2' url='http://localhost:3000/api/upload' method='post'\r\n                                            onProgress={(e, request, progress) => {\r\n                                                console.log('progress', e, request, progress);\r\n                                                this.props.setSpinner();\r\n                                            }}\r\n                                            onLoad={(e, request) => {\r\n                                                console.log('load', e, request);\r\n                                                this.props.setSpinner();\r\n                                            }}\r\n                                            onError={(e, request) => {\r\n                                                console.log('error', e, request);\r\n                                                this.props.setSpinner();\r\n                                            }}\r\n                                            onAbort={(e, request) => {\r\n                                                console.log('abort', e, request);\r\n                                                this.props.setSpinner();\r\n                                            }}\r\n                                            formGetter={this.formGetter.bind(this)}\r\n                                            formRenderer={this.customFormRenderer.bind(this)}\r\n                                            progressRenderer={this.customProgressRenderer.bind(this)}\r\n\r\n                        />\r\n                    </ModalBody>\r\n\r\n                </Modal>\r\n            )\r\n        } else {\r\n            return (<></>)\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        open: state.modalImportToggle,\r\n        import: state.import,\r\n        language: state.language\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setModalImport: () => dispatch(modalImportToggle()),\r\n        setSpinner: () => dispatch(spinnerToggle()),\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ModalImportTemplate);"]},"metadata":{},"sourceType":"module"}