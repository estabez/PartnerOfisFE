{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\src\\\\views\\\\Ran.jsx\";\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport Toolbar from '../components/TopologyToolbar';\nimport Header from \"../components/Header\";\nimport Sidebar from \"../components/Sidebar\";\nimport ModalTemplate from '../components/Modal';\nimport TopologyDiagram from '../components/TopologyDiagram';\nimport { modalToggle, modalTitle, setTopologyFirstLevel, setTopologySecondLevel, setTopologySecondLevelDropdownLabels } from \"../redux/actions\";\nimport IconModule from '../IconModule';\nimport RestApiModule from '../RestApiModule';\n\nclass Ran extends React.Component {\n  constructor(props) {\n    super(props);\n    this.events = {\n      doubleClick: event => {\n        const nodes = event.nodes;\n        const nodeID = nodes[0];\n\n        if (nodeID) {\n          // type must be aggreg_site\n          const node = this.props.graph.nodes.find(item => {\n            return item.id === nodeID;\n          });\n\n          if (node.type === 'AGGREGATE_SITE') {\n            this.getDataByAggregSite(nodeID);\n            this.props.setModalTitle(nodeID);\n          }\n        }\n      }\n      /*afterDrawing: (e) => {\r\n          console.log(e);\r\n      }*/\n\n    };\n    this.Icons = new IconModule();\n    this.state = {\n      firstLevelData: null,\n      dropdownLabels: null\n    };\n    this.unformatedData = null;\n    this.unformatedDataSecondLevel = null;\n    this.restApi = new RestApiModule();\n  }\n\n  async componentDidMount() {\n    await this.getDataByRegion('Agadir');\n  }\n\n  setStateAsync(state) {\n    return new Promise(resolve => {\n      this.setState(state, resolve);\n    });\n  }\n\n  getDataByRegion(region) {\n    this.restApi.callApi('ranFirst', {\n      region,\n      token: \"FQl65eASqnHaYSxumlMP53mU0Tc3ovh1Mas2QHdd4CZY2XfP0qtZlGMq7vtiY1m3\"\n    }).then(async response => {\n      const d = response.RANTopologyFirstLevelViewData;\n      await this.setStateAsync({\n        firstLevelData: d\n      });\n      this.prepareFirstLevelData();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  async getDataByAggregSite(id) {\n    this.restApi.callApi('ranSecond', {\n      selectedNode: id,\n      token: \"FQl65eASqnHaYSxumlMP53mU0Tc3ovh1Mas2QHdd4CZY2XfP0qtZlGMq7vtiY1m3\"\n    }).then(async response => {\n      const d = response.RANTopologySecondLevelViewData;\n      if (d.length > 0) await this.prepareSecondLevelData(d, id);\n      this.props.setModal();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  prepareFirstLevelData() {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, type, Icons) {\n      if (type === 'AGGREGATE_SITE') {\n        labels.push(id);\n      }\n\n      nodes.push({\n        id: id,\n        label: id,\n        type: type,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        image: Icons.getIconForNode(type)\n      });\n    }\n\n    this.state.firstLevelData.map(item => {\n      const indexA = nodes.findIndex(data => data.id === item.NODE_A);\n\n      if (indexA < 0) {\n        pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\n      }\n\n      const indexB = nodes.findIndex(data => data.id === item.NODE_B);\n\n      if (indexB < 0) {\n        pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\n      }\n\n      edges.push({\n        from: item.NODE_A,\n        to: item.NODE_B\n      });\n    }); // this row for store the first state of graph data.\n    // Once we select a node, it will turn to red font, others will stay black.\n\n    this.unformatedData = {\n      nodes,\n      edges\n    }; // once the data is ready to show, redux is updating.\n\n    this.props.setTopologyFirstLevel({\n      nodes,\n      edges\n    });\n    this.setState({\n      dropdownLabels: labels.sort()\n    });\n  }\n\n  prepareSecondLevelData(data, aggregSite) {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, Icons) {\n      const radioIcon = Icons.getIconForNode('RADIO_SITE');\n      const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\n      nodes.push({\n        id: id,\n        label: id,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        image: id === aggregSite ? aggregIcon : radioIcon\n      });\n      if (id !== aggregSite) labels.push(id);\n    }\n\n    if (data) {\n      data.map(item => {\n        const indexA = nodes.findIndex(data => data.id === item.A_SITE);\n\n        if (indexA < 0) {\n          pushItem(item.A_SITE, this.Icons);\n        }\n\n        const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\n\n        if (indexB < 0) {\n          pushItem(item.Z_SITE, this.Icons);\n        }\n\n        edges.push({\n          from: item.A_SITE,\n          to: item.Z_SITE\n        });\n      }); // this row for store the first state of graph data.\n      // Once we select a node, it will turn to red font, others will stay black.\n\n      this.unformatedDataSecondLevel = {\n        nodes,\n        edges\n      }; // set the second level topology diagram.\n      // It will update the redux and it trigger to rerender of modal window.\n\n      this.props.setTopologySecondLevel({\n        nodes,\n        edges\n      }); // set the secondLevel topology view dropdown list\n\n      this.props.setTopologySecondLevelDropDown({\n        dropdownList: labels\n      });\n    }\n  }\n\n  async handleSelectAggregSite(selectedNodeId) {\n    let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\n\n    if (newGraph) {\n      newGraph.nodes.map(node => {\n        if (node.id === selectedNodeId) {\n          node.font = {\n            color: 'red',\n            size: this.props.fontSize\n          };\n        }\n      });\n      console.log(newGraph);\n      this.props.setTopologyFirstLevel(newGraph);\n    }\n  }\n\n  render() {\n    const _this$props = this.props,\n          language = _this$props.language,\n          maximize = _this$props.maximize,\n          contentCSS = _this$props.contentCSS,\n          graph = _this$props.graph;\n    const diagramAreaIdLevelOne = 'diagramLevel1';\n    const diagramAreaIdLevelTwo = 'diagramLevel2';\n\n    if (graph !== null && language !== null) {\n      return React.createElement(React.Fragment, null, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row h-100\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(Sidebar, {\n        maximize: maximize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: contentCSS,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, React.createElement(Toolbar, {\n        wrapper: 'card mt-3',\n        labels: this.state.dropdownLabels,\n        handleAggregSiteChange: this.handleSelectAggregSite.bind(this),\n        handleRegionChange: this.getDataByRegion.bind(this),\n        topologyLevel: 1,\n        diagramAreaId: diagramAreaIdLevelOne,\n        snapshotFileName: 'RanTopologyFirstLevel.png',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: diagramAreaIdLevelOne,\n        className: 'card mt-3 fixedCard',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: 'topologyViewHeader',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, language.ranTopology), React.createElement(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"card-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }, React.createElement(TopologyDiagram, {\n        id: 'diagramLevel1',\n        graph: graph,\n        events: this.events,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }))))), React.createElement(ModalTemplate, {\n        diagramAreaId: diagramAreaIdLevelTwo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }));\n    } else {\n      return React.createElement(React.Fragment, null);\n    }\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    serverPath: state.serverPath,\n    language: state.language,\n    maximize: state.maximize,\n    contentCSS: state.contentCSS,\n    graph: state.topologyFirstLevel,\n    fontSize: state.topologySelectedNodeFontSize\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    setModal: () => dispatch(modalToggle()),\n    setModalTitle: content => dispatch(modalTitle(content)),\n    setTopologyFirstLevel: graph => dispatch(setTopologyFirstLevel(graph)),\n    setTopologySecondLevel: graph => dispatch(setTopologySecondLevel(graph)),\n    setTopologySecondLevelDropDown: labels => dispatch(setTopologySecondLevelDropdownLabels(labels))\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);","map":{"version":3,"sources":["C:/Users/ezerdon/Desktop/INWI/svn reps/E2E_Topology/E2ETopologyFrontend/src/src/views/Ran.jsx"],"names":["React","connect","Toolbar","Header","Sidebar","ModalTemplate","TopologyDiagram","modalToggle","modalTitle","setTopologyFirstLevel","setTopologySecondLevel","setTopologySecondLevelDropdownLabels","IconModule","RestApiModule","Ran","Component","constructor","props","events","doubleClick","event","nodes","nodeID","node","graph","find","item","id","type","getDataByAggregSite","setModalTitle","Icons","state","firstLevelData","dropdownLabels","unformatedData","unformatedDataSecondLevel","restApi","componentDidMount","getDataByRegion","setStateAsync","Promise","resolve","setState","region","callApi","token","then","response","d","RANTopologyFirstLevelViewData","prepareFirstLevelData","catch","error","console","log","selectedNode","RANTopologySecondLevelViewData","length","prepareSecondLevelData","setModal","edges","labels","pushItem","push","label","shape","font","color","size","image","getIconForNode","map","indexA","findIndex","data","NODE_A","NODE_A_TYPE","indexB","NODE_B","NODE_B_TYPE","from","to","sort","aggregSite","radioIcon","aggregIcon","A_SITE","Z_SITE","setTopologySecondLevelDropDown","dropdownList","handleSelectAggregSite","selectedNodeId","newGraph","JSON","parse","stringify","fontSize","render","language","maximize","contentCSS","diagramAreaIdLevelOne","diagramAreaIdLevelTwo","bind","ranTopology","mapStateToProps","serverPath","topologyFirstLevel","topologySelectedNodeFontSize","mapDispatchToProps","dispatch","content"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,OAAR,QAAsB,aAAtB;AAEA,OAAOC,OAAP,MAAoB,+BAApB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,aAAP,MAA0B,qBAA1B;AACA,OAAOC,eAAP,MAA4B,+BAA5B;AACA,SACIC,WADJ,EACiBC,UADjB,EAEIC,qBAFJ,EAGIC,sBAHJ,EAIIC,oCAJJ,QAKO,kBALP;AAOA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,aAAP,MAA0B,kBAA1B;;AAEA,MAAMC,GAAN,SAAkBd,KAAK,CAACe,SAAxB,CAAkC;AAE9BC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;AADe,SAgBnBC,MAhBmB,GAgBV;AACLC,MAAAA,WAAW,EAAGC,KAAD,IAAW;AAAA,cACbC,KADa,GACJD,KADI,CACbC,KADa;AAEpB,cAAMC,MAAM,GAAGD,KAAK,CAAC,CAAD,CAApB;;AAEA,YAAIC,MAAJ,EAAY;AACR;AACA,gBAAMC,IAAI,GAAG,KAAKN,KAAL,CAAWO,KAAX,CAAiBH,KAAjB,CAAuBI,IAAvB,CAA6BC,IAAD,IAAU;AAC/C,mBAAOA,IAAI,CAACC,EAAL,KAAYL,MAAnB;AACH,WAFY,CAAb;;AAGA,cAAIC,IAAI,CAACK,IAAL,KAAc,gBAAlB,EAAoC;AAChC,iBAAKC,mBAAL,CAAyBP,MAAzB;AAEA,iBAAKL,KAAL,CAAWa,aAAX,CAAyBR,MAAzB;AAEH;AACJ;AACJ;AACD;;;;AAlBK,KAhBU;AAGf,SAAKS,KAAL,GAAa,IAAInB,UAAJ,EAAb;AAEA,SAAKoB,KAAL,GAAa;AACTC,MAAAA,cAAc,EAAE,IADP;AAETC,MAAAA,cAAc,EAAE;AAFP,KAAb;AAKA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,yBAAL,GAAiC,IAAjC;AAEA,SAAKC,OAAL,GAAe,IAAIxB,aAAJ,EAAf;AACH;;AAyBD,QAAMyB,iBAAN,GAA0B;AAEtB,UAAM,KAAKC,eAAL,CAAqB,QAArB,CAAN;AACH;;AAEDC,EAAAA,aAAa,CAACR,KAAD,EAAQ;AACjB,WAAO,IAAIS,OAAJ,CAAaC,OAAD,IAAa;AAC5B,WAAKC,QAAL,CAAcX,KAAd,EAAqBU,OAArB;AACH,KAFM,CAAP;AAGH;;AAEDH,EAAAA,eAAe,CAACK,MAAD,EAAS;AAEpB,SAAKP,OAAL,CAAaQ,OAAb,CAAqB,UAArB,EAAiC;AAC7BD,MAAAA,MAD6B;AAE7BE,MAAAA,KAAK,EAAE;AAFsB,KAAjC,EAIGC,IAJH,CAIQ,MAAOC,QAAP,IAAoB;AAExB,YAAMC,CAAC,GAAGD,QAAQ,CAACE,6BAAnB;AAEA,YAAM,KAAKV,aAAL,CAAmB;AAACP,QAAAA,cAAc,EAAEgB;AAAjB,OAAnB,CAAN;AAEA,WAAKE,qBAAL;AAEH,KAZD,EAYGC,KAZH,CAYUC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACH,KAdD;AAeH;;AAED,QAAMxB,mBAAN,CAA0BF,EAA1B,EAA8B;AAE1B,SAAKU,OAAL,CAAaQ,OAAb,CAAqB,WAArB,EAAkC;AAC9BW,MAAAA,YAAY,EAAE7B,EADgB;AAE9BmB,MAAAA,KAAK,EAAE;AAFuB,KAAlC,EAIGC,IAJH,CAIQ,MAAOC,QAAP,IAAoB;AAExB,YAAMC,CAAC,GAAGD,QAAQ,CAACS,8BAAnB;AAEA,UAAIR,CAAC,CAACS,MAAF,GAAW,CAAf,EAAkB,MAAM,KAAKC,sBAAL,CAA4BV,CAA5B,EAA+BtB,EAA/B,CAAN;AAElB,WAAKV,KAAL,CAAW2C,QAAX;AAEH,KAZD,EAYGR,KAZH,CAYUC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACH,KAdD;AAeH;;AAEDF,EAAAA,qBAAqB,GAAG;AAEpB,QAAI9B,KAAK,GAAG,EAAZ;AAAA,QAAgBwC,KAAK,GAAG,EAAxB;AAAA,QAA4BC,MAAM,GAAG,EAArC;;AAEA,aAASC,QAAT,CAAkBpC,EAAlB,EAAsBC,IAAtB,EAA4BG,KAA5B,EAAmC;AAE/B,UAAIH,IAAI,KAAK,gBAAb,EAA+B;AAC3BkC,QAAAA,MAAM,CAACE,IAAP,CAAYrC,EAAZ;AACH;;AACDN,MAAAA,KAAK,CAAC2C,IAAN,CAAW;AACPrC,QAAAA,EAAE,EAAEA,EADG;AAEPsC,QAAAA,KAAK,EAAEtC,EAFA;AAGPC,QAAAA,IAAI,EAAEA,IAHC;AAIPsC,QAAAA,KAAK,EAAE,OAJA;AAKPC,QAAAA,IAAI,EAAE;AAACC,UAAAA,KAAK,EAAE,OAAR;AAAiBC,UAAAA,IAAI,EAAE;AAAvB,SALC;AAMPC,QAAAA,KAAK,EAAEvC,KAAK,CAACwC,cAAN,CAAqB3C,IAArB;AANA,OAAX;AAQH;;AAED,SAAKI,KAAL,CAAWC,cAAX,CAA0BuC,GAA1B,CAA+B9C,IAAD,IAAU;AAEpC,YAAM+C,MAAM,GAAGpD,KAAK,CAACqD,SAAN,CAAgBC,IAAI,IAAIA,IAAI,CAAChD,EAAL,KAAYD,IAAI,CAACkD,MAAzC,CAAf;;AACA,UAAIH,MAAM,GAAG,CAAb,EAAgB;AACZV,QAAAA,QAAQ,CAACrC,IAAI,CAACkD,MAAN,EAAclD,IAAI,CAACmD,WAAnB,EAAgC,KAAK9C,KAArC,CAAR;AACH;;AAED,YAAM+C,MAAM,GAAGzD,KAAK,CAACqD,SAAN,CAAgBC,IAAI,IAAIA,IAAI,CAAChD,EAAL,KAAYD,IAAI,CAACqD,MAAzC,CAAf;;AACA,UAAID,MAAM,GAAG,CAAb,EAAgB;AACZf,QAAAA,QAAQ,CAACrC,IAAI,CAACqD,MAAN,EAAcrD,IAAI,CAACsD,WAAnB,EAAgC,KAAKjD,KAArC,CAAR;AACH;;AAED8B,MAAAA,KAAK,CAACG,IAAN,CAAW;AACPiB,QAAAA,IAAI,EAAEvD,IAAI,CAACkD,MADJ;AAEPM,QAAAA,EAAE,EAAExD,IAAI,CAACqD;AAFF,OAAX;AAIH,KAhBD,EAnBoB,CAqCpB;AACA;;AACA,SAAK5C,cAAL,GAAsB;AAACd,MAAAA,KAAD;AAAQwC,MAAAA;AAAR,KAAtB,CAvCoB,CAyCpB;;AACA,SAAK5C,KAAL,CAAWR,qBAAX,CAAiC;AAC7BY,MAAAA,KAD6B;AAE7BwC,MAAAA;AAF6B,KAAjC;AAKA,SAAKlB,QAAL,CAAc;AAACT,MAAAA,cAAc,EAAE4B,MAAM,CAACqB,IAAP;AAAjB,KAAd;AAEH;;AAEDxB,EAAAA,sBAAsB,CAACgB,IAAD,EAAOS,UAAP,EAAmB;AAErC,QAAI/D,KAAK,GAAG,EAAZ;AAAA,QAAgBwC,KAAK,GAAG,EAAxB;AAAA,QAA4BC,MAAM,GAAG,EAArC;;AAEA,aAASC,QAAT,CAAkBpC,EAAlB,EAAsBI,KAAtB,EAA6B;AAEzB,YAAMsD,SAAS,GAAGtD,KAAK,CAACwC,cAAN,CAAqB,YAArB,CAAlB;AACA,YAAMe,UAAU,GAAGvD,KAAK,CAACwC,cAAN,CAAqB,gBAArB,CAAnB;AAEAlD,MAAAA,KAAK,CAAC2C,IAAN,CAAW;AACPrC,QAAAA,EAAE,EAAEA,EADG;AAEPsC,QAAAA,KAAK,EAAEtC,EAFA;AAGPuC,QAAAA,KAAK,EAAE,OAHA;AAIPC,QAAAA,IAAI,EAAE;AAACC,UAAAA,KAAK,EAAE,OAAR;AAAiBC,UAAAA,IAAI,EAAE;AAAvB,SAJC;AAKPC,QAAAA,KAAK,EAAE3C,EAAE,KAAKyD,UAAP,GAAoBE,UAApB,GAAiCD;AALjC,OAAX;AAQA,UAAI1D,EAAE,KAAKyD,UAAX,EAAuBtB,MAAM,CAACE,IAAP,CAAYrC,EAAZ;AAC1B;;AAED,QAAIgD,IAAJ,EAAU;AACNA,MAAAA,IAAI,CAACH,GAAL,CAAU9C,IAAD,IAAU;AAEf,cAAM+C,MAAM,GAAGpD,KAAK,CAACqD,SAAN,CAAgBC,IAAI,IAAIA,IAAI,CAAChD,EAAL,KAAYD,IAAI,CAAC6D,MAAzC,CAAf;;AACA,YAAId,MAAM,GAAG,CAAb,EAAgB;AACZV,UAAAA,QAAQ,CAACrC,IAAI,CAAC6D,MAAN,EAAc,KAAKxD,KAAnB,CAAR;AACH;;AAED,cAAM+C,MAAM,GAAGzD,KAAK,CAACqD,SAAN,CAAgBC,IAAI,IAAIA,IAAI,CAAChD,EAAL,KAAYD,IAAI,CAAC8D,MAAzC,CAAf;;AACA,YAAIV,MAAM,GAAG,CAAb,EAAgB;AACZf,UAAAA,QAAQ,CAACrC,IAAI,CAAC8D,MAAN,EAAc,KAAKzD,KAAnB,CAAR;AACH;;AAED8B,QAAAA,KAAK,CAACG,IAAN,CAAW;AACPiB,UAAAA,IAAI,EAAEvD,IAAI,CAAC6D,MADJ;AAEPL,UAAAA,EAAE,EAAExD,IAAI,CAAC8D;AAFF,SAAX;AAIH,OAhBD,EADM,CAmBN;AACA;;AACA,WAAKpD,yBAAL,GAAiC;AAACf,QAAAA,KAAD;AAAQwC,QAAAA;AAAR,OAAjC,CArBM,CAuBN;AACA;;AACA,WAAK5C,KAAL,CAAWP,sBAAX,CAAkC;AAC9BW,QAAAA,KAD8B;AAE9BwC,QAAAA;AAF8B,OAAlC,EAzBM,CA8BN;;AACA,WAAK5C,KAAL,CAAWwE,8BAAX,CAA0C;AACtCC,QAAAA,YAAY,EAAE5B;AADwB,OAA1C;AAGH;AACJ;;AAED,QAAM6B,sBAAN,CAA6BC,cAA7B,EAA6C;AAEzC,QAAIC,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAK7D,cAApB,CAAX,CAAf;;AAEA,QAAI0D,QAAJ,EAAc;AACVA,MAAAA,QAAQ,CAACxE,KAAT,CAAemD,GAAf,CAAoBjD,IAAD,IAAU;AACzB,YAAIA,IAAI,CAACI,EAAL,KAAYiE,cAAhB,EAAgC;AAC5BrE,UAAAA,IAAI,CAAC4C,IAAL,GAAY;AAACC,YAAAA,KAAK,EAAE,KAAR;AAAeC,YAAAA,IAAI,EAAE,KAAKpD,KAAL,CAAWgF;AAAhC,WAAZ;AACH;AACJ,OAJD;AAKA3C,MAAAA,OAAO,CAACC,GAAR,CAAYsC,QAAZ;AACA,WAAK5E,KAAL,CAAWR,qBAAX,CAAiCoF,QAAjC;AACH;AACJ;;AAEDK,EAAAA,MAAM,GAAG;AAAA,wBAC2C,KAAKjF,KADhD;AAAA,UACEkF,QADF,eACEA,QADF;AAAA,UACYC,QADZ,eACYA,QADZ;AAAA,UACsBC,UADtB,eACsBA,UADtB;AAAA,UACkC7E,KADlC,eACkCA,KADlC;AAEL,UAAM8E,qBAAqB,GAAG,eAA9B;AACA,UAAMC,qBAAqB,GAAG,eAA9B;;AAEA,QAAI/E,KAAK,KAAK,IAAV,IAAkB2E,QAAQ,KAAK,IAAnC,EAAyC;AACrC,aACI,0CACI,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAS,QAAA,QAAQ,EAAEC,QAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAK,QAAA,SAAS,EAAEC,UAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAS,QAAA,OAAO,EAAE,WAAlB;AACS,QAAA,MAAM,EAAE,KAAKrE,KAAL,CAAWE,cAD5B;AAES,QAAA,sBAAsB,EAAE,KAAKyD,sBAAL,CAA4Ba,IAA5B,CAAiC,IAAjC,CAFjC;AAGS,QAAA,kBAAkB,EAAE,KAAKjE,eAAL,CAAqBiE,IAArB,CAA0B,IAA1B,CAH7B;AAIS,QAAA,aAAa,EAAE,CAJxB;AAKS,QAAA,aAAa,EAAEF,qBALxB;AAMS,QAAA,gBAAgB,EAAE,2BAN3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAUI;AAAK,QAAA,EAAE,EAAEA,qBAAT;AAAiC,QAAA,SAAS,EAAE,qBAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAO,QAAA,SAAS,EAAE,oBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAyCH,QAAQ,CAACM,WAAlD,CADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,EAGI;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,eAAD;AACI,QAAA,EAAE,EAAE,eADR;AAEI,QAAA,KAAK,EAAEjF,KAFX;AAGI,QAAA,MAAM,EAAE,KAAKN,MAHjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAHJ,CAVJ,CAFJ,CAFJ,EA0BI,oBAAC,aAAD;AAAe,QAAA,aAAa,EAAEqF,qBAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA1BJ,CADJ;AA8BH,KA/BD,MA+BO;AACH,aAAQ,yCAAR;AACH;AACJ;;AA5P6B;;AA+PlC,SAASG,eAAT,CAAyB1E,KAAzB,EAAgC;AAC5B,SAAO;AACH2E,IAAAA,UAAU,EAAE3E,KAAK,CAAC2E,UADf;AAEHR,IAAAA,QAAQ,EAAEnE,KAAK,CAACmE,QAFb;AAGHC,IAAAA,QAAQ,EAAEpE,KAAK,CAACoE,QAHb;AAIHC,IAAAA,UAAU,EAAErE,KAAK,CAACqE,UAJf;AAKH7E,IAAAA,KAAK,EAAEQ,KAAK,CAAC4E,kBALV;AAMHX,IAAAA,QAAQ,EAAEjE,KAAK,CAAC6E;AANb,GAAP;AAQH;;AAED,SAASC,kBAAT,CAA4BC,QAA5B,EAAsC;AAClC,SAAO;AACHnD,IAAAA,QAAQ,EAAE,MAAMmD,QAAQ,CAACxG,WAAW,EAAZ,CADrB;AAEHuB,IAAAA,aAAa,EAAGkF,OAAD,IAAaD,QAAQ,CAACvG,UAAU,CAACwG,OAAD,CAAX,CAFjC;AAGHvG,IAAAA,qBAAqB,EAAGe,KAAD,IAAWuF,QAAQ,CAACtG,qBAAqB,CAACe,KAAD,CAAtB,CAHvC;AAIHd,IAAAA,sBAAsB,EAAGc,KAAD,IAAWuF,QAAQ,CAACrG,sBAAsB,CAACc,KAAD,CAAvB,CAJxC;AAKHiE,IAAAA,8BAA8B,EAAG3B,MAAD,IAAYiD,QAAQ,CAACpG,oCAAoC,CAACmD,MAAD,CAArC;AALjD,GAAP;AAOH;;AAED,eAAe7D,OAAO,CAACyG,eAAD,EAAkBI,kBAAlB,CAAP,CAA6ChG,GAA7C,CAAf","sourcesContent":["import React from 'react';\r\nimport {connect} from \"react-redux\";\r\n\r\nimport Toolbar from '../components/TopologyToolbar'\r\nimport Header from \"../components/Header\";\r\nimport Sidebar from \"../components/Sidebar\";\r\nimport ModalTemplate from '../components/Modal'\r\nimport TopologyDiagram from '../components/TopologyDiagram'\r\nimport {\r\n    modalToggle, modalTitle,\r\n    setTopologyFirstLevel,\r\n    setTopologySecondLevel,\r\n    setTopologySecondLevelDropdownLabels\r\n} from \"../redux/actions\";\r\n\r\nimport IconModule from '../IconModule';\r\nimport RestApiModule from '../RestApiModule'\r\n\r\nclass Ran extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.Icons = new IconModule();\r\n\r\n        this.state = {\r\n            firstLevelData: null,\r\n            dropdownLabels: null,\r\n        }\r\n\r\n        this.unformatedData = null\r\n        this.unformatedDataSecondLevel = null\r\n\r\n        this.restApi = new RestApiModule();\r\n    }\r\n\r\n    events = {\r\n        doubleClick: (event) => {\r\n            const {nodes} = event;\r\n            const nodeID = nodes[0];\r\n\r\n            if (nodeID) {\r\n                // type must be aggreg_site\r\n                const node = this.props.graph.nodes.find((item) => {\r\n                    return item.id === nodeID\r\n                });\r\n                if (node.type === 'AGGREGATE_SITE') {\r\n                    this.getDataByAggregSite(nodeID);\r\n\r\n                    this.props.setModalTitle(nodeID);\r\n\r\n                }\r\n            }\r\n        },\r\n        /*afterDrawing: (e) => {\r\n            console.log(e);\r\n        }*/\r\n    };\r\n\r\n    async componentDidMount() {\r\n\r\n        await this.getDataByRegion('Agadir');\r\n    }\r\n\r\n    setStateAsync(state) {\r\n        return new Promise((resolve) => {\r\n            this.setState(state, resolve)\r\n        });\r\n    }\r\n\r\n    getDataByRegion(region) {\r\n\r\n        this.restApi.callApi('ranFirst', {\r\n            region,\r\n            token: \"FQl65eASqnHaYSxumlMP53mU0Tc3ovh1Mas2QHdd4CZY2XfP0qtZlGMq7vtiY1m3\"\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologyFirstLevelViewData;\r\n\r\n            await this.setStateAsync({firstLevelData: d});\r\n\r\n            this.prepareFirstLevelData();\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n    }\r\n\r\n    async getDataByAggregSite(id) {\r\n\r\n        this.restApi.callApi('ranSecond', {\r\n            selectedNode: id,\r\n            token: \"FQl65eASqnHaYSxumlMP53mU0Tc3ovh1Mas2QHdd4CZY2XfP0qtZlGMq7vtiY1m3\"\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologySecondLevelViewData;\r\n\r\n            if (d.length > 0) await this.prepareSecondLevelData(d, id);\r\n\r\n            this.props.setModal();\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n    }\r\n\r\n    prepareFirstLevelData() {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, type, Icons) {\r\n\r\n            if (type === 'AGGREGATE_SITE') {\r\n                labels.push(id);\r\n            }\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                type: type,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                image: Icons.getIconForNode(type)\r\n            })\r\n        }\r\n\r\n        this.state.firstLevelData.map((item) => {\r\n\r\n            const indexA = nodes.findIndex(data => data.id === item.NODE_A);\r\n            if (indexA < 0) {\r\n                pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\r\n            }\r\n\r\n            const indexB = nodes.findIndex(data => data.id === item.NODE_B);\r\n            if (indexB < 0) {\r\n                pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\r\n            }\r\n\r\n            edges.push({\r\n                from: item.NODE_A,\r\n                to: item.NODE_B\r\n            });\r\n        });\r\n\r\n        // this row for store the first state of graph data.\r\n        // Once we select a node, it will turn to red font, others will stay black.\r\n        this.unformatedData = {nodes, edges};\r\n\r\n        // once the data is ready to show, redux is updating.\r\n        this.props.setTopologyFirstLevel({\r\n            nodes,\r\n            edges\r\n        });\r\n\r\n        this.setState({dropdownLabels: labels.sort()});\r\n\r\n    }\r\n\r\n    prepareSecondLevelData(data, aggregSite) {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, Icons) {\r\n\r\n            const radioIcon = Icons.getIconForNode('RADIO_SITE');\r\n            const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\r\n\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                image: id === aggregSite ? aggregIcon : radioIcon\r\n            })\r\n\r\n            if (id !== aggregSite) labels.push(id);\r\n        }\r\n\r\n        if (data) {\r\n            data.map((item) => {\r\n\r\n                const indexA = nodes.findIndex(data => data.id === item.A_SITE);\r\n                if (indexA < 0) {\r\n                    pushItem(item.A_SITE, this.Icons);\r\n                }\r\n\r\n                const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\r\n                if (indexB < 0) {\r\n                    pushItem(item.Z_SITE, this.Icons);\r\n                }\r\n\r\n                edges.push({\r\n                    from: item.A_SITE,\r\n                    to: item.Z_SITE\r\n                });\r\n            });\r\n\r\n            // this row for store the first state of graph data.\r\n            // Once we select a node, it will turn to red font, others will stay black.\r\n            this.unformatedDataSecondLevel = {nodes, edges};\r\n\r\n            // set the second level topology diagram.\r\n            // It will update the redux and it trigger to rerender of modal window.\r\n            this.props.setTopologySecondLevel({\r\n                nodes,\r\n                edges\r\n            });\r\n\r\n            // set the secondLevel topology view dropdown list\r\n            this.props.setTopologySecondLevelDropDown({\r\n                dropdownList: labels\r\n            })\r\n        }\r\n    }\r\n\r\n    async handleSelectAggregSite(selectedNodeId) {\r\n\r\n        let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\r\n\r\n        if (newGraph) {\r\n            newGraph.nodes.map((node) => {\r\n                if (node.id === selectedNodeId) {\r\n                    node.font = {color: 'red', size: this.props.fontSize}\r\n                }\r\n            });\r\n            console.log(newGraph);\r\n            this.props.setTopologyFirstLevel(newGraph);\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const {language, maximize, contentCSS, graph} = this.props;\r\n        const diagramAreaIdLevelOne = 'diagramLevel1';\r\n        const diagramAreaIdLevelTwo = 'diagramLevel2';\r\n\r\n        if (graph !== null && language !== null) {\r\n            return (\r\n                <>\r\n                    <Header/>\r\n                    <div className=\"row h-100\">\r\n                        <Sidebar maximize={maximize}/>\r\n                        <div className={contentCSS}>\r\n                            <Toolbar wrapper={'card mt-3'}\r\n                                     labels={this.state.dropdownLabels}\r\n                                     handleAggregSiteChange={this.handleSelectAggregSite.bind(this)}\r\n                                     handleRegionChange={this.getDataByRegion.bind(this)}\r\n                                     topologyLevel={1}\r\n                                     diagramAreaId={diagramAreaIdLevelOne}\r\n                                     snapshotFileName={'RanTopologyFirstLevel.png'}\r\n                            />\r\n\r\n                            <div id={diagramAreaIdLevelOne}  className={'card mt-3 fixedCard'}>\r\n                                <label className={'topologyViewHeader'}>{language.ranTopology}</label>\r\n                                <hr />\r\n                                <div className=\"card-body\">\r\n                                    <TopologyDiagram\r\n                                        id={'diagramLevel1'}\r\n                                        graph={graph}\r\n                                        events={this.events}/>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <ModalTemplate diagramAreaId={diagramAreaIdLevelTwo} />\r\n                </>\r\n            )\r\n        } else {\r\n            return (<></>);\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        serverPath: state.serverPath,\r\n        language: state.language,\r\n        maximize: state.maximize,\r\n        contentCSS: state.contentCSS,\r\n        graph: state.topologyFirstLevel,\r\n        fontSize: state.topologySelectedNodeFontSize\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setModal: () => dispatch(modalToggle()),\r\n        setModalTitle: (content) => dispatch(modalTitle(content)),\r\n        setTopologyFirstLevel: (graph) => dispatch(setTopologyFirstLevel(graph)),\r\n        setTopologySecondLevel: (graph) => dispatch(setTopologySecondLevel(graph)),\r\n        setTopologySecondLevelDropDown: (labels) => dispatch(setTopologySecondLevelDropdownLabels(labels))\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);"]},"metadata":{},"sourceType":"module"}