{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ezerdon\\\\Desktop\\\\INWI\\\\svn reps\\\\E2E_Topology\\\\E2ETopologyFrontend\\\\src\\\\src\\\\views\\\\Ran.jsx\";\nimport React from 'react';\nimport { connect } from \"react-redux\";\nimport Toolbar from '../components/TopologyToolbar';\nimport Header from \"../components/Header\";\nimport Sidebar from \"../components/Sidebar\";\nimport ModalTemplate from '../components/Modal';\nimport TopologyDiagram from '../components/TopologyDiagram';\nimport { modalToggle, modalTitle, setTopologyFirstLevel, setTopologySecondLevel, setTopologySecondLevelDropdownLabels } from \"../redux/actions\";\nimport IconModule from '../IconModule';\nimport RestApiModule from '../RestApiModule';\n\nclass Ran extends React.Component {\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n    this.events = {\n      doubleClick: event => {\n        const nodes = event.nodes;\n        const nodeID = nodes[0];\n\n        if (nodeID) {\n          // type must be aggreg_site\n          const node = this.props.graph.nodes.find(item => {\n            return item.id === nodeID;\n          });\n\n          if (node.type === 'AGGREGATE_SITE') {\n            this.getDataByAggregSite(nodeID);\n            this.props.setModalTitle(nodeID);\n          }\n        }\n      }\n      /*afterDrawing: (e) => {\r\n          console.log(e);\r\n      }*/\n\n    };\n    this.Icons = new IconModule();\n    this.state = {\n      firstLevelData: null,\n      dropdownLabels: null\n    };\n    this.unformatedData = null;\n    this.unformatedDataSecondLevel = null;\n    this.restApi = new RestApiModule();\n    this.today = new Date();\n    this.todayDate = '_' + (this.today.getMonth() + 1) + '-' + this.today.getDate() + '-' + this.today.getFullYear();\n    this.fileName = 'RanTopology' + this.todayDate + '.png';\n  }\n\n  async componentDidMount() {\n    this._isMounted = true;\n    await this.getDataByRegion();\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  setStateAsync(state) {\n    return new Promise(resolve => {\n      this.setState(state, resolve);\n    });\n  }\n\n  getDataByRegion() {\n    const _this$props = this.props,\n          token = _this$props.token,\n          region = _this$props.region;\n    this.restApi.callApi('ranFirst', {\n      token,\n      region\n    }).then(async response => {\n      const d = response.RANTopologyFirstLevelViewData;\n\n      if (this._isMounted) {\n        await this.setStateAsync({\n          firstLevelData: d\n        });\n        this.prepareFirstLevelData();\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  async getDataByAggregSite(id) {\n    const token = this.props.token;\n    this.restApi.callApi('ranSecond', {\n      selectedNode: id,\n      token\n    }).then(async response => {\n      const d = response.RANTopologySecondLevelViewData;\n      if (d.length > 0) await this.prepareSecondLevelData(d, id);\n      this.props.setModal();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  prepareFirstLevelData() {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, type, Icons) {\n      if (type === 'AGGREGATE_SITE') {\n        labels.push(id);\n      }\n\n      nodes.push({\n        id: id,\n        label: id,\n        type: type,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        image: Icons.getIconForNode(type)\n      });\n    }\n\n    this.state.firstLevelData.map(item => {\n      const indexA = nodes.findIndex(data => data.id === item.NODE_A);\n\n      if (indexA < 0) {\n        pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\n      }\n\n      const indexB = nodes.findIndex(data => data.id === item.NODE_B);\n\n      if (indexB < 0) {\n        pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\n      }\n\n      edges.push({\n        from: item.NODE_A,\n        to: item.NODE_B\n      });\n    }); // this row for store the first state of graph data.\n    // Once we select a node, it will turn to red font, others will stay black.\n\n    this.unformatedData = {\n      nodes,\n      edges\n    }; // once the data is ready to show, redux is updating.\n\n    this.props.setTopologyFirstLevel({\n      nodes,\n      edges\n    });\n    this.setState({\n      dropdownLabels: labels.sort()\n    });\n  }\n\n  prepareSecondLevelData(data, aggregSite) {\n    let nodes = [],\n        edges = [],\n        labels = [];\n\n    function pushItem(id, Icons) {\n      const radioIcon = Icons.getIconForNode('RADIO_SITE');\n      const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\n      nodes.push({\n        id: id,\n        label: id,\n        shape: 'image',\n        font: {\n          color: 'black',\n          size: '13'\n        },\n        image: id === aggregSite ? aggregIcon : radioIcon\n      });\n      if (id !== aggregSite) labels.push(id);\n    }\n\n    if (data) {\n      data.map(item => {\n        const indexA = nodes.findIndex(data => data.id === item.A_SITE);\n\n        if (indexA < 0) {\n          pushItem(item.A_SITE, this.Icons);\n        }\n\n        const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\n\n        if (indexB < 0) {\n          pushItem(item.Z_SITE, this.Icons);\n        }\n\n        edges.push({\n          from: item.A_SITE,\n          to: item.Z_SITE\n        });\n      }); // this row for store the first state of graph data.\n      // Once we select a node, it will turn to red font, others will stay black.\n\n      this.unformatedDataSecondLevel = {\n        nodes,\n        edges\n      }; // set the second level topology diagram.\n      // It will update the redux and it trigger to rerender of modal window.\n\n      this.props.setTopologySecondLevel({\n        nodes,\n        edges\n      }); // set the secondLevel topology view dropdown list\n\n      this.props.setTopologySecondLevelDropDown({\n        dropdownList: labels\n      });\n    }\n  }\n\n  async handleSelectAggregSite(selectedNodeId) {\n    let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\n\n    if (newGraph) {\n      newGraph.nodes.map(node => {\n        if (node.id === selectedNodeId) {\n          node.font = {\n            color: 'red',\n            size: this.props.fontSize\n          };\n        }\n      });\n      this.props.setTopologyFirstLevel(newGraph);\n    }\n  }\n\n  render() {\n    const _this$props2 = this.props,\n          language = _this$props2.language,\n          maximize = _this$props2.maximize,\n          contentCSS = _this$props2.contentCSS,\n          graph = _this$props2.graph;\n    const diagramAreaIdLevelOne = 'diagramLevel1';\n    const diagramAreaIdLevelTwo = 'diagramLevel2';\n\n    if (graph !== null && language !== null) {\n      return React.createElement(React.Fragment, null, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row h-100\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }, React.createElement(Sidebar, {\n        maximize: maximize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: contentCSS,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, React.createElement(Toolbar, {\n        wrapper: 'card toolbar mt-2',\n        labels: this.state.dropdownLabels,\n        handleAggregSiteChange: this.handleSelectAggregSite.bind(this),\n        handleRegionChange: this.getDataByRegion.bind(this),\n        topologyLevel: 1,\n        diagramAreaId: diagramAreaIdLevelOne,\n        snapshotFileName: this.fileName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: diagramAreaIdLevelOne,\n        className: 'card mt-1 fixedCard',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"card-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270\n        },\n        __self: this\n      }, React.createElement(\"h4\", {\n        className: 'topologyViewHeader',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, language.ranTopology), React.createElement(TopologyDiagram, {\n        id: 'diagramLevel1',\n        height: '95%',\n        graph: graph,\n        events: this.events,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }))))), React.createElement(ModalTemplate, {\n        diagramAreaId: diagramAreaIdLevelTwo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }));\n    } else {\n      return React.createElement(React.Fragment, null);\n    }\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    token: state.token,\n    region: state.region,\n    language: state.language,\n    maximize: state.maximize,\n    contentCSS: state.contentCSS,\n    graph: state.topologyFirstLevel,\n    fontSize: state.topologySelectedNodeFontSize\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    setModal: () => dispatch(modalToggle()),\n    setModalTitle: content => dispatch(modalTitle(content)),\n    setTopologyFirstLevel: graph => dispatch(setTopologyFirstLevel(graph)),\n    setTopologySecondLevel: graph => dispatch(setTopologySecondLevel(graph)),\n    setTopologySecondLevelDropDown: labels => dispatch(setTopologySecondLevelDropdownLabels(labels))\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);","map":{"version":3,"sources":["C:/Users/ezerdon/Desktop/INWI/svn reps/E2E_Topology/E2ETopologyFrontend/src/src/views/Ran.jsx"],"names":["React","connect","Toolbar","Header","Sidebar","ModalTemplate","TopologyDiagram","modalToggle","modalTitle","setTopologyFirstLevel","setTopologySecondLevel","setTopologySecondLevelDropdownLabels","IconModule","RestApiModule","Ran","Component","constructor","props","_isMounted","events","doubleClick","event","nodes","nodeID","node","graph","find","item","id","type","getDataByAggregSite","setModalTitle","Icons","state","firstLevelData","dropdownLabels","unformatedData","unformatedDataSecondLevel","restApi","today","Date","todayDate","getMonth","getDate","getFullYear","fileName","componentDidMount","getDataByRegion","componentWillUnmount","setStateAsync","Promise","resolve","setState","token","region","callApi","then","response","d","RANTopologyFirstLevelViewData","prepareFirstLevelData","catch","error","console","log","selectedNode","RANTopologySecondLevelViewData","length","prepareSecondLevelData","setModal","edges","labels","pushItem","push","label","shape","font","color","size","image","getIconForNode","map","indexA","findIndex","data","NODE_A","NODE_A_TYPE","indexB","NODE_B","NODE_B_TYPE","from","to","sort","aggregSite","radioIcon","aggregIcon","A_SITE","Z_SITE","setTopologySecondLevelDropDown","dropdownList","handleSelectAggregSite","selectedNodeId","newGraph","JSON","parse","stringify","fontSize","render","language","maximize","contentCSS","diagramAreaIdLevelOne","diagramAreaIdLevelTwo","bind","ranTopology","mapStateToProps","topologyFirstLevel","topologySelectedNodeFontSize","mapDispatchToProps","dispatch","content"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {connect} from \"react-redux\";\r\n\r\nimport Toolbar from '../components/TopologyToolbar'\r\nimport Header from \"../components/Header\";\r\nimport Sidebar from \"../components/Sidebar\";\r\nimport ModalTemplate from '../components/Modal'\r\nimport TopologyDiagram from '../components/TopologyDiagram'\r\nimport {\r\n    modalToggle, modalTitle,\r\n    setTopologyFirstLevel,\r\n    setTopologySecondLevel,\r\n    setTopologySecondLevelDropdownLabels\r\n} from \"../redux/actions\";\r\n\r\nimport IconModule from '../IconModule';\r\nimport RestApiModule from '../RestApiModule'\r\n\r\nclass Ran extends React.Component {\r\n    _isMounted = false;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.Icons = new IconModule();\r\n\r\n        this.state = {\r\n            firstLevelData: null,\r\n            dropdownLabels: null,\r\n        }\r\n\r\n        this.unformatedData = null\r\n        this.unformatedDataSecondLevel = null\r\n\r\n        this.restApi = new RestApiModule();\r\n\r\n        this.today = new Date();\r\n        this.todayDate = '_' + (this.today.getMonth()+1) + '-' + this.today.getDate() + '-' + this.today.getFullYear();\r\n        this.fileName = 'RanTopology' + this.todayDate + '.png';\r\n    }\r\n\r\n    events = {\r\n        doubleClick: (event) => {\r\n            const {nodes} = event;\r\n            const nodeID = nodes[0];\r\n\r\n            if (nodeID) {\r\n                // type must be aggreg_site\r\n                const node = this.props.graph.nodes.find((item) => {\r\n                    return item.id === nodeID\r\n                });\r\n                if (node.type === 'AGGREGATE_SITE') {\r\n                    this.getDataByAggregSite(nodeID);\r\n\r\n                    this.props.setModalTitle(nodeID);\r\n\r\n                }\r\n            }\r\n        },\r\n        /*afterDrawing: (e) => {\r\n            console.log(e);\r\n        }*/\r\n    };\r\n\r\n    async componentDidMount() {\r\n\r\n        this._isMounted = true;\r\n        await this.getDataByRegion();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this._isMounted = false;\r\n    }\r\n\r\n    setStateAsync(state) {\r\n        return new Promise((resolve) => {\r\n            this.setState(state, resolve)\r\n        });\r\n    }\r\n\r\n    getDataByRegion() {\r\n\r\n        const {token, region} = this.props;\r\n\r\n        this.restApi.callApi('ranFirst', {\r\n            token,\r\n            region\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologyFirstLevelViewData;\r\n\r\n            if (this._isMounted) {\r\n                await this.setStateAsync({firstLevelData: d});\r\n\r\n                this.prepareFirstLevelData();\r\n            }\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n\r\n    }\r\n\r\n    async getDataByAggregSite(id) {\r\n\r\n        const {token} = this.props;\r\n\r\n        this.restApi.callApi('ranSecond', {\r\n            selectedNode: id,\r\n            token\r\n\r\n        }).then(async (response) => {\r\n\r\n            const d = response.RANTopologySecondLevelViewData;\r\n\r\n            if (d.length > 0) await this.prepareSecondLevelData(d, id);\r\n\r\n            this.props.setModal();\r\n\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n    }\r\n\r\n    prepareFirstLevelData() {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, type, Icons) {\r\n\r\n            if (type === 'AGGREGATE_SITE') {\r\n                labels.push(id);\r\n            }\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                type: type,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                image: Icons.getIconForNode(type)\r\n            })\r\n        }\r\n\r\n        this.state.firstLevelData.map((item) => {\r\n\r\n            const indexA = nodes.findIndex(data => data.id === item.NODE_A);\r\n            if (indexA < 0) {\r\n                pushItem(item.NODE_A, item.NODE_A_TYPE, this.Icons);\r\n            }\r\n\r\n            const indexB = nodes.findIndex(data => data.id === item.NODE_B);\r\n            if (indexB < 0) {\r\n                pushItem(item.NODE_B, item.NODE_B_TYPE, this.Icons);\r\n            }\r\n\r\n            edges.push({\r\n                from: item.NODE_A,\r\n                to: item.NODE_B\r\n            });\r\n        });\r\n\r\n        // this row for store the first state of graph data.\r\n        // Once we select a node, it will turn to red font, others will stay black.\r\n        this.unformatedData = {nodes, edges};\r\n\r\n        // once the data is ready to show, redux is updating.\r\n        this.props.setTopologyFirstLevel({\r\n            nodes,\r\n            edges\r\n        });\r\n\r\n        this.setState({dropdownLabels: labels.sort()});\r\n\r\n    }\r\n\r\n    prepareSecondLevelData(data, aggregSite) {\r\n\r\n        let nodes = [], edges = [], labels = [];\r\n\r\n        function pushItem(id, Icons) {\r\n\r\n            const radioIcon = Icons.getIconForNode('RADIO_SITE');\r\n            const aggregIcon = Icons.getIconForNode('AGGREGATE_SITE');\r\n\r\n            nodes.push({\r\n                id: id,\r\n                label: id,\r\n                shape: 'image',\r\n                font: {color: 'black', size: '13'},\r\n                image: id === aggregSite ? aggregIcon : radioIcon\r\n            })\r\n\r\n            if (id !== aggregSite) labels.push(id);\r\n        }\r\n\r\n        if (data) {\r\n            data.map((item) => {\r\n\r\n                const indexA = nodes.findIndex(data => data.id === item.A_SITE);\r\n                if (indexA < 0) {\r\n                    pushItem(item.A_SITE, this.Icons);\r\n                }\r\n\r\n                const indexB = nodes.findIndex(data => data.id === item.Z_SITE);\r\n                if (indexB < 0) {\r\n                    pushItem(item.Z_SITE, this.Icons);\r\n                }\r\n\r\n                edges.push({\r\n                    from: item.A_SITE,\r\n                    to: item.Z_SITE\r\n                });\r\n            });\r\n\r\n            // this row for store the first state of graph data.\r\n            // Once we select a node, it will turn to red font, others will stay black.\r\n            this.unformatedDataSecondLevel = {nodes, edges};\r\n\r\n            // set the second level topology diagram.\r\n            // It will update the redux and it trigger to rerender of modal window.\r\n            this.props.setTopologySecondLevel({\r\n                nodes,\r\n                edges\r\n            });\r\n\r\n            // set the secondLevel topology view dropdown list\r\n            this.props.setTopologySecondLevelDropDown({\r\n                dropdownList: labels\r\n            })\r\n        }\r\n    }\r\n\r\n    async handleSelectAggregSite(selectedNodeId) {\r\n\r\n        let newGraph = JSON.parse(JSON.stringify(this.unformatedData));\r\n\r\n        if (newGraph) {\r\n            newGraph.nodes.map((node) => {\r\n                if (node.id === selectedNodeId) {\r\n                    node.font = {color: 'red', size: this.props.fontSize}\r\n                }\r\n            });\r\n            this.props.setTopologyFirstLevel(newGraph);\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const {language, maximize, contentCSS, graph} = this.props;\r\n        const diagramAreaIdLevelOne = 'diagramLevel1';\r\n        const diagramAreaIdLevelTwo = 'diagramLevel2';\r\n\r\n        if (graph !== null && language !== null) {\r\n            return (\r\n                <>\r\n                    <Header/>\r\n                    <div className=\"row h-100\">\r\n                        <Sidebar maximize={maximize}/>\r\n                        <div className={contentCSS}>\r\n                            <Toolbar wrapper={'card toolbar mt-2'}\r\n                                     labels={this.state.dropdownLabels}\r\n                                     handleAggregSiteChange={this.handleSelectAggregSite.bind(this)}\r\n                                     handleRegionChange={this.getDataByRegion.bind(this)}\r\n                                     topologyLevel={1}\r\n                                     diagramAreaId={diagramAreaIdLevelOne}\r\n                                     snapshotFileName={this.fileName}\r\n                            />\r\n\r\n                            <div id={diagramAreaIdLevelOne} className={'card mt-1 fixedCard'}>\r\n                                <div className=\"card-body\">\r\n                                    <h4 className={'topologyViewHeader'}>{language.ranTopology}</h4>\r\n                                    <TopologyDiagram\r\n                                        id={'diagramLevel1'}\r\n                                        height={'95%'}\r\n                                        graph={graph}\r\n                                        events={this.events}/>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <ModalTemplate diagramAreaId={diagramAreaIdLevelTwo} />\r\n                </>\r\n            )\r\n        } else {\r\n            return (<></>);\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        token: state.token,\r\n        region: state.region,\r\n        language: state.language,\r\n        maximize: state.maximize,\r\n        contentCSS: state.contentCSS,\r\n        graph: state.topologyFirstLevel,\r\n        fontSize: state.topologySelectedNodeFontSize\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        setModal: () => dispatch(modalToggle()),\r\n        setModalTitle: (content) => dispatch(modalTitle(content)),\r\n        setTopologyFirstLevel: (graph) => dispatch(setTopologyFirstLevel(graph)),\r\n        setTopologySecondLevel: (graph) => dispatch(setTopologySecondLevel(graph)),\r\n        setTopologySecondLevelDropDown: (labels) => dispatch(setTopologySecondLevelDropdownLabels(labels))\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Ran);"]},"metadata":{},"sourceType":"module"}